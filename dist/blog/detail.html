<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1,maximum-scale=2,viewport-fit=cover"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="renderer" content="webkit"><title> - JiangKingåšå®¢</title><meta name="description" content="é˜…è¯»JiangKingåšå®¢ä¸Šçš„ã€Šundefinedã€‹ï¼Œæ¢ç´¢æ›´å¤šæŠ€æœ¯å†…å®¹"><meta name="keywords" content=", undefined, åšå®¢, JiangKing"><meta name="author" content="JiangKing"><meta property="og:title" content="undefined - JiangKingåšå®¢"><meta property="og:description" content="é˜…è¯»JiangKingåšå®¢ä¸Šçš„ã€Šundefinedã€‹ï¼Œæ¢ç´¢æ›´å¤šæŠ€æœ¯å†…å®¹"><meta property="og:type" content="article"><meta property="og:url" content="https://jiangking.com/blog/undefined.html"><meta property="article:published_time" content="undefined"><meta property="article:author" content="JiangKing"><meta name="theme-color" content="#0f0f23"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><link rel="preload" href="/css/blog.css" as="style"><link rel="stylesheet" href="/css/blog.css"><link rel="stylesheet" href="/css/blog/comment-fixes.css"><script src="/js/api-config.js"></script><script src="/js/auth.js"></script><script src="/js/blog.js"></script><style>/* èµ›åšæœ‹å…‹é£æ ¼å˜é‡ */
:root {
  --primary: #6366f1;
  --primary-dark: #4f46e5;
  --secondary: #8b5cf6;
  --accent: #ec4899;
  --success: #10b981;
  --warning: #f59e0b;
  --danger: #ef4444;
  --dark: #0f0f23;
  --light: #f8fafc;
  --glass: rgba(255, 255, 255, 0.1);
  --glass-border: rgba(255, 255, 255, 0.2);
  --neon-glow: 0 0 20px rgba(99, 102, 241, 0.8);
  --text: #e2e8f0;
  --text-muted: rgba(226, 232, 240, 0.6);
}

/* äº®è‰²æ¨¡å¼å˜é‡ */
.light-mode {
  --dark: #f8fafc;
  --light: #0f0f23;
  --text: #1e293b;
  --text-muted: rgba(30, 41, 59, 0.7);
  --glass: rgba(0, 0, 0, 0.05);
  --glass-border: rgba(0, 0, 0, 0.1);
}

.light-mode .dynamic-bg {
  background: linear-gradient(45deg, #f8fafc, #e2e8f0, #f8fafc);
}

.light-mode .grid-bg {
  background-image: 
    linear-gradient(rgba(99, 102, 241, 0.1) 1px, transparent 1px),
    linear-gradient(90deg, rgba(99, 102, 241, 0.1) 1px, transparent 1px);
}

/* æŒ‰é’®æ¿€æ´»çŠ¶æ€æ ·å¼ */
.action-btn.active {
  color: var(--accent);
  background: rgba(99, 102, 241, 0.2);
  box-shadow: 0 0 10px rgba(99, 102, 241, 0.4);
  transform: translateY(-3px);
}

/* æ”¶è—æŒ‰é’®åŠ¨ç”» */
.bookmark-animation {
  animation: bookmark-pulse 0.5s ease-out;
}

@keyframes bookmark-pulse {
  0% { transform: scale(1); }
  50% { transform: scale(1.3); }
  100% { transform: scale(1); }
}

body {
  font-family: 'Helvetica Neue', 'Microsoft Yahei', -apple-system, sans-serif;
  background: var(--dark);
  color: var(--text);
  line-height: 1.6;
  margin: 0;
  padding: 0;
}

/* åŠ¨æ€èƒŒæ™¯ */
.dynamic-bg {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -2;
  background: linear-gradient(45deg, #0f0f23, #1a1a3e, #0f0f23);
  background-size: 400% 400%;
  animation: gradientShift 15s ease infinite;
}

@keyframes gradientShift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* ç½‘æ ¼èƒŒæ™¯ */
.grid-bg {
  position: fixed;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  z-index: -1;
  background-image: 
    linear-gradient(rgba(99, 102, 241, 0.1) 1px, transparent 1px),
    linear-gradient(90deg, rgba(99, 102, 241, 0.1) 1px, transparent 1px);
  background-size: 50px 50px;
}

/* é¼ æ ‡è·Ÿéšå…‰æ•ˆ */
.cursor-glow {
  position: fixed;
  width: 400px;
  height: 400px;
  border-radius: 50%;
  background: radial-gradient(circle, rgba(99, 102, 241, 0.1) 0%, transparent 70%);
  pointer-events: none;
  transform: translate(-50%, -50%);
  z-index: -1;
  transition: opacity 0.3s;
}

/* è¿›åº¦æ¡ */
.progress-bar {
  position: fixed;
  top: 0;
  left: 0;
  height: 3px;
  background: linear-gradient(90deg, var(--primary), var(--accent));
  z-index: 1000;
  width: 0%;
  transition: width 0.2s;
}

.image-container {
  margin: 20px 0;
  text-align: center;
  position: relative;
}

.image-container img {
  max-width: 100%;
  min-height: 150px;
  border-radius: 8px;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
  border: 1px solid var(--glass-border);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.image-container img:hover {
  transform: translateY(-5px);
  box-shadow: 0 15px 30px rgba(99, 102, 241, 0.4);
}

/* ç‰¹æ®Šæ ·å¼ç”¨äºSVGå›¾ç‰‡ */
.image-container img.svg-image {
  background-color: rgba(255, 255, 255, 0.05);
  padding: 10px;
  border: 1px solid rgba(99, 102, 241, 0.3);
}

.image-container img.error {
  border: 1px dashed var(--danger);
  background-color: rgba(239, 68, 68, 0.1);
}

/* é¡¶éƒ¨å¯¼èˆª */
.top-nav {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 15px 20px;
  background: rgba(15, 15, 35, 0.8);
  backdrop-filter: blur(10px);
  z-index: 100;
  border-bottom: 1px solid var(--glass-border);
}

.nav-left {
  display: flex;
  align-items: center;
  gap: 15px;
}

.back-btn {
  color: var(--text);
  text-decoration: none;
  font-size: 1.5rem;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  background: rgba(99, 102, 241, 0.2);
  border: 1px solid rgba(99, 102, 241, 0.3);
  transition: all 0.3s;
}

.back-btn:hover {
  background: rgba(99, 102, 241, 0.4);
  transform: scale(1.1);
}

.site-title {
  font-size: 1.2rem;
  margin: 0;
  background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.nav-right {
  display: flex;
  gap: 10px;
}

.nav-btn {
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid var(--glass-border);
  border-radius: 8px;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  transition: all 0.3s;
  font-size: 1.2rem;
}

.nav-btn:hover {
  background: rgba(99, 102, 241, 0.2);
  transform: translateY(-2px);
}

/* ç”¨æˆ·åŒºåŸŸæ ·å¼ */
.user-area-container {
  display: flex;
  align-items: center;
  margin-right: 15px;
}

.user-area-guest {
  display: flex;
  gap: 10px;
}

.login-btn, .register-btn {
  padding: 8px 15px;
  border-radius: 6px;
  border: none;
  font-size: 0.9rem;
  cursor: pointer;
  transition: all 0.3s;
}

.login-btn {
  background: transparent;
  color: var(--text);
  border: 1px solid var(--glass-border);
}

.login-btn:hover {
  background: rgba(255, 255, 255, 0.1);
  transform: translateY(-2px);
}

.register-btn {
  background: linear-gradient(135deg, var(--primary), var(--primary-dark));
  color: white;
  box-shadow: 0 4px 10px rgba(99, 102, 241, 0.3);
}

.register-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 15px rgba(99, 102, 241, 0.4);
}

.user-area-user {
  position: relative;
}

.hidden {
  display: none !important;
}

.user-dropdown {
  position: relative;
}

.user-info {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 5px 10px;
  border-radius: 20px;
  background: rgba(99, 102, 241, 0.1);
  border: 1px solid rgba(99, 102, 241, 0.2);
  cursor: pointer;
  transition: all 0.3s;
}

.user-info:hover {
  background: rgba(99, 102, 241, 0.2);
  transform: translateY(-2px);
}

.avatar-placeholder {
  width: 30px;
  height: 30px;
  border-radius: 50%;
  background: linear-gradient(135deg, var(--primary), var(--secondary));
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
  font-size: 1rem;
}

.user-avatar {
  width: 30px;
  height: 30px;
  border-radius: 50%;
  object-fit: cover;
}

.username {
  font-size: 0.9rem;
  color: var(--text);
}

.dropdown-menu {
  position: absolute;
  top: 100%;
  right: 0;
  width: 200px;
  background: rgba(15, 15, 35, 0.9);
  backdrop-filter: blur(10px);
  border-radius: 8px;
  border: 1px solid var(--glass-border);
  box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
  margin-top: 10px;
  opacity: 0;
  visibility: hidden;
  transform: translateY(-10px);
  transition: all 0.3s;
  z-index: 100;
}

.dropdown-menu.show {
  opacity: 1;
  visibility: visible;
  transform: translateY(0);
}

.dropdown-arrow {
  position: absolute;
  top: -8px;
  right: 20px;
  width: 16px;
  height: 16px;
  background: rgba(15, 15, 35, 0.9);
  transform: rotate(45deg);
  border-top: 1px solid var(--glass-border);
  border-left: 1px solid var(--glass-border);
}

.dropdown-list {
  list-style: none;
  padding: 10px 0;
}

.dropdown-item {
  padding: 0;
}

.dropdown-link {
  display: block;
  padding: 10px 15px;
  color: var(--text);
  text-decoration: none;
  transition: all 0.2s;
}

.dropdown-link:hover {
  background: rgba(99, 102, 241, 0.1);
  color: var(--primary);
}

.divider {
  border-top: 1px solid var(--glass-border);
  margin: 5px 0;
}

.logout-btn {
  width: 100%;
  text-align: left;
  padding: 10px 15px;
  background: transparent;
  border: none;
  color: var(--danger);
  cursor: pointer;
  transition: all 0.2s;
}

.logout-btn:hover {
  background: rgba(239, 68, 68, 0.1);
}

/* å›¾æ ‡æ ·å¼ */
.icon {
  font-family: 'Material Icons';
  font-weight: normal;
  font-style: normal;
  font-size: 24px;
  line-height: 1;
  letter-spacing: normal;
  text-transform: none;
  display: inline-block;
  white-space: nowrap;
  word-wrap: normal;
  direction: ltr;
  -webkit-font-feature-settings: 'liga';
  -webkit-font-smoothing: antialiased;
}

.icon-user:before {
  content: 'ğŸ‘¤';
}

/* æ–‡ç« å¤´éƒ¨ */
.article-header {
  position: relative;
  padding: 120px 40px 60px;
  overflow: hidden;
  background: linear-gradient(to bottom, rgba(15, 15, 35, 0) 0%, var(--dark) 100%);
}

.header-bg {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  z-index: -1;
  opacity: 0.4;
}

.header-content {
  position: relative;
  z-index: 1;
  max-width: 900px;
  margin: 0 auto;
}

.article-title {
  font-size: 2.5rem;
  margin-bottom: 20px;
  color: var(--text);
  font-weight: 800;
  text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
  animation: glow 2s ease-in-out infinite alternate;
}

@keyframes glow {
  from { text-shadow: 0 0 5px rgba(99, 102, 241, 0.5); }
  to { text-shadow: 0 0 15px rgba(99, 102, 241, 0.8), 0 0 25px rgba(236, 72, 153, 0.6); }
}

.article-meta {
  display: flex;
  gap: 20px;
  flex-wrap: wrap;
  color: var(--text-muted);
  margin-bottom: 20px;
}

.meta-item {
  display: flex;
  align-items: center;
  gap: 5px;
  font-size: 0.9rem;
}

.meta-icon {
  font-size: 1rem;
}

/* æ–‡ç« å®¹å™¨ */
.article-container {
  max-width: 900px;
  margin: 0 auto;
  padding: 30px 40px;
  background: rgba(15, 15, 35, 0.5);
  backdrop-filter: blur(10px);
  border: 1px solid var(--glass-border);
  border-radius: 16px;
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
}

.article-content {
  color: var(--text);
  font-size: 1.1rem;
  line-height: 1.8;
}

/* æ–‡ç« å†…å®¹é£æ ¼ */
.article-content h1,
.article-content h2,
.article-content h3,
.article-content h4,
.article-content h5,
.article-content h6 {
  margin-top: 1.5em;
  margin-bottom: 0.8em;
  color: #fff;
}

.article-content h2 {
  font-size: 1.8rem;
  border-bottom: 2px solid rgba(99, 102, 241, 0.3);
  padding-bottom: 10px;
}

.article-content h3 {
  font-size: 1.5rem;
  color: var(--primary);
}

.article-content p {
  margin: 1.2em 0;
}

.article-content a {
  color: var(--secondary);
  text-decoration: none;
  border-bottom: 1px dashed rgba(139, 92, 246, 0.5);
  transition: all 0.2s;
}

.article-content a:hover {
  color: var(--accent);
  border-color: var(--accent);
}

.article-content blockquote {
  border-left: 4px solid var(--secondary);
  padding-left: 20px;
  margin-left: 0;
  color: var(--text-muted);
  font-style: italic;
}

.article-content code {
  font-family: Monaco, Consolas, 'Courier New', monospace;
  background: rgba(15, 15, 35, 0.6);
  padding: 3px 6px;
  border-radius: 4px;
  font-size: 0.9em;
  border: 1px solid rgba(99, 102, 241, 0.2);
  color: var(--accent);
}

.article-content pre {
  background: rgba(15, 15, 35, 0.8);
  padding: 20px;
  border-radius: 8px;
  overflow-x: auto;
  border: 1px solid var(--primary-dark);
  box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
}

.article-content pre code {
  background: none;
  padding: 0;
  border: none;
  color: var(--text);
}

/* æ–‡ç« æ ‡ç­¾ */
.article-tags {
  margin-top: 40px;
  padding-top: 20px;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}

.tag {
  padding: 6px 16px;
  background: rgba(99, 102, 241, 0.2);
  border: 1px solid var(--primary);
  border-radius: 20px;
  font-size: 13px;
  color: var(--primary);
  transition: all 0.3s;
  text-decoration: none;
  display: flex;
  align-items: center;
  position: relative;
  overflow: hidden;
}

.tag:hover {
  background: var(--primary);
  color: #fff;
  transform: translateY(-2px);
  box-shadow: 0 5px 15px rgba(99, 102, 241, 0.4);
}

/* ä½œè€…ä¿¡æ¯ */
.author-info {
  margin-top: 40px;
  padding: 20px;
  background: rgba(99, 102, 241, 0.1);
  border: 1px solid rgba(99, 102, 241, 0.2);
  border-radius: 16px;
  display: flex;
  align-items: center;
  gap: 20px;
}

.author-avatar {
  width: 80px;
  height: 80px;
  border-radius: 50%;
  overflow: hidden;
  border: 2px solid var(--primary);
  box-shadow: 0 0 15px rgba(99, 102, 241, 0.5);
}

.author-avatar img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.author-details h4 {
  margin: 0 0 5px;
  font-size: 1.2rem;
  color: #fff;
}

.author-bio {
  color: var(--text-muted);
  margin: 0;
  font-size: 0.9rem;
}

/* ç›¸å…³æ–‡ç«  */
.related-posts {
  margin-top: 40px;
}

.section-title {
  font-size: 1.5rem;
  margin-bottom: 20px;
  color: #fff;
  position: relative;
  padding-left: 15px;
}

.section-title::before {
  content: '';
  position: absolute;
  left: 0;
  top: 8px;
  height: 20px;
  width: 4px;
  background: linear-gradient(to bottom, var(--primary), var(--accent));
  border-radius: 2px;
}

.related-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
  gap: 20px;
}

/* ç§»åŠ¨ç«¯ä¼˜åŒ–æ ·å¼ */
@media (max-width: 768px) {
  .article-header {
    padding: 80px 15px 30px;
  }
  
  .article-title {
    font-size: 1.8rem;
    line-height: 1.3;
  }
  
  .article-meta {
    flex-wrap: wrap;
    gap: 8px;
  }
  
  .article-container {
    padding: 20px 15px;
    margin: 0 10px;
    border-radius: 12px;
  }
  
  .author-info {
    flex-direction: column;
    text-align: center;
    padding: 15px;
  }
  
  .related-grid {
    grid-template-columns: 1fr;
  }
}

/* åº•éƒ¨æ“ä½œæ  */
.article-actions {
  position: fixed;
  bottom: 30px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  align-items: center;
  gap: 15px;
  background: rgba(15, 15, 35, 0.8);
  border: 1px solid var(--glass-border);
  backdrop-filter: blur(10px);
  padding: 12px 25px;
  border-radius: 50px;
  box-shadow: 0 5px 25px rgba(0, 0, 0, 0.3);
  z-index: 90;
}

.action-btn {
  background: none;
  border: none;
  color: var(--text);
  font-size: 1.2rem;
  cursor: pointer;
  width: 40px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
  transition: all 0.2s;
}

.action-btn:hover {
  background: rgba(99, 102, 241, 0.2);
  transform: translateY(-3px);
}

.action-divider {
  width: 1px;
  height: 25px;
  background: var(--glass-border);
}

/* ç›®å½•å¯¼èˆªå·²åˆ é™¤ */

/* è¯„è®ºåŒºæ ·å¼ */
.comments-section {
  margin-top: 50px;
  padding: 30px 0;
  border-top: 1px solid rgba(255, 255, 255, 0.1);
  display: none; /* é»˜è®¤éšè— */
}

.comments-section.active {
  display: block;
}

.comments-container {
  max-width: 800px;
  margin: 0 auto;
}

.comments-title {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 20px;
  font-size: 1.5rem;
  color: #fff;
}

.comment-count {
  font-size: 1rem;
  color: var(--text-muted);
}

.comment-form-container {
  display: flex;
  gap: 15px;
  margin-bottom: 30px;
}

.comment-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  overflow: hidden;
  flex-shrink: 0;
  border: 1px solid var(--glass-border);
}

.comment-avatar img {
  width: 100%;
  height: 100%;
  object-fit: cover;
}

.comment-form {
  flex: 1;
  display: flex;
  flex-direction: column;
}

.comment-input {
  width: 100%;
  padding: 12px 15px;
  border-radius: 8px;
  background: rgba(255, 255, 255, 0.05);
  border: 1px solid var(--glass-border);
  color: var(--text);
  resize: vertical;
  font-family: inherit;
  font-size: 0.95rem;
  margin-bottom: 10px;
  transition: border-color 0.3s;
}

.comment-input:focus {
  outline: none;
  border-color: var(--primary);
  box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
}

.comment-form-actions {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}

.comment-cancel-btn,
.comment-submit-btn {
  padding: 8px 16px;
  border-radius: 6px;
  font-size: 0.9rem;
  cursor: pointer;
  transition: all 0.2s;
}

.comment-cancel-btn {
  background: transparent;
  border: 1px solid var(--glass-border);
  color: var(--text-muted);
}

.comment-cancel-btn:hover {
  background: rgba(255, 255, 255, 0.05);
}

.comment-submit-btn {
  background: var(--primary);
  border: none;
  color: white;
}

.comment-submit-btn:hover {
  background: var(--primary-dark);
  transform: translateY(-2px);
}

.comment-submit-btn:disabled {
  background: rgba(99, 102, 241, 0.5);
  cursor: not-allowed;
  transform: none;
}

.comments-list {
  margin-bottom: 20px;
}

.comment-item {
  display: flex;
  gap: 15px;
  margin-bottom: 25px;
  position: relative;
}

.comment-content {
  flex: 1;
}

.comment-header {
  display: flex;
  justify-content: space-between;
  margin-bottom: 5px;
}

.comment-author {
  font-weight: 600;
  color: #fff;
}

.comment-date {
  font-size: 0.85rem;
  color: var(--text-muted);
}

.comment-text {
  color: var(--text);
  line-height: 1.6;
  margin-bottom: 8px;
}

.comment-actions {
  display: flex;
  gap: 15px;
}

.comment-action {
  font-size: 0.85rem;
  color: var(--text-muted);
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 5px;
  transition: color 0.2s;
}

.comment-action:hover {
  color: var(--primary);
}

.load-more-comments {
  text-align: center;
}

.load-more-btn {
  background: rgba(99, 102, 241, 0.1);
  border: 1px solid rgba(99, 102, 241, 0.3);
  color: var(--primary);
  padding: 8px 20px;
  border-radius: 20px;
  font-size: 0.9rem;
  cursor: pointer;
  transition: all 0.2s;
}

.load-more-btn:hover {
  background: rgba(99, 102, 241, 0.2);
  transform: translateY(-2px);
}

/* è¯„è®ºå›å¤æ ·å¼ */
.comment-replies {
  margin-left: 55px;
  margin-top: 15px;
}

.reply-form {
  margin-left: 55px;
  margin-top: 10px;
  display: none;
}

.reply-form.active {
  display: flex;
}

/* ç§»åŠ¨ç«¯é€‚é… */
@media (max-width: 768px) {
  .comment-form-container {
    flex-direction: column;
    gap: 10px;
  }
  
  .comment-avatar {
    align-self: flex-start;
  }
  
  .comment-replies {
    margin-left: 20px;
  }
  
  .reply-form {
    margin-left: 20px;
  }
}

@media (max-width: 768px) {
  .article-actions {
    padding: 8px 15px;
    bottom: 15px;
  }
  
  .action-btn {
    width: 36px;
    height: 36px;
  }
}

/* éšè—è¯­è¨€åˆ‡æ¢å™¨ */
.language-switcher {
  display: none !important;
}</style></head><body><div class="dynamic-bg"></div><div class="grid-bg"></div><div class="cursor-glow" id="cursorGlow"></div><div class="progress-bar" id="progressBar"></div><header class="top-nav" role="banner"><div class="nav-left"><a class="back-btn" href="/blog/" title="è¿”å›é¦–é¡µ" aria-label="è¿”å›åšå®¢é¦–é¡µ">â†</a><h3 class="site-title">JiangKing</h3></div><div class="nav-right"><!-- ç”¨æˆ·åŒºåŸŸ--><div class="user-area-container"><!-- æœªç™»å½•çŠ¶æ€--><div class="user-area-guest" id="guestArea"><button class="login-btn" id="loginBtn" type="button">ç™»å½•</button><button class="register-btn" id="registerBtn" type="button">æ³¨å†Œ</button></div><!-- å·²ç™»å½•çŠ¶æ€--><div class="user-area-user hidden" id="userArea"><div class="user-dropdown"><div class="user-info"><div class="avatar-placeholder"><i class="icon icon-user"></i></div><span class="username" id="usernameDisplay">ç”¨æˆ·å</span></div><div class="dropdown-menu hidden" id="userDropdown"><div class="dropdown-arrow"></div><ul class="dropdown-list"><li class="dropdown-item"><a class="dropdown-link" href="/user/profile">ä¸ªäººä¸­å¿ƒ</a></li><li class="dropdown-item"><a class="dropdown-link" href="/user/favorites">æˆ‘çš„æ”¶è—</a></li><li class="dropdown-item"><a class="dropdown-link" href="/user/settings">è´¦å·è®¾ç½®</a></li><li class="dropdown-item divider"></li><li class="dropdown-item"><button class="logout-btn" id="logoutBtn" type="button">é€€å‡ºç™»å½•</button></li></ul></div></div></div></div><button class="nav-btn" title="æš—è‰²æ¨¡å¼" aria-label="åˆ‡æ¢æš—è‰²æ¨¡å¼">ğŸŒ™</button></div></header><section class="article-header"><div class="header-bg"><canvas id="headerCanvas"></canvas></div><div class="header-content"><h1 class="article-title" itemprop="headline"></h1><div class="article-meta"><span class="meta-item"><span class="meta-icon">ğŸ‘¤</span><span itemprop="author"></span></span><span class="meta-item"><span class="meta-icon">ğŸ“…</span><time itemprop="datePublished"></time></span><span class="meta-item"><span class="meta-icon">â±ï¸</span><span>1 min read</span></span><span class="meta-item"><span class="meta-icon">ğŸ‘ï¸</span><span>1.2k</span></span></div></div></section><article class="article-container" itemscope itemtype="https://schema.org/BlogPosting"><meta itemprop="headline"><meta itemprop="author"><meta itemprop="datePublished"><div class="article-content" itemprop="articleBody"></div><section class="article-tags" role="contentinfo" aria-label="æ–‡ç« æ ‡ç­¾"></section><section class="author-info" itemscope itemtype="https://schema.org/Person"><div class="author-avatar"><img src="/assets/avatar.jpg" itemprop="image" loading="lazy"></div><div class="author-details"><h4 itemprop="name"></h4><p class="author-bio" itemprop="description">STDIN | Think >> /dev/Mindâœ¨ - ä¸“æ³¨äºæŠ€æœ¯åˆ†äº«ä¸æ€è€ƒ</p></div></section><section class="related-posts" aria-labelledby="related-posts-title"><h3 class="section-title" id="related-posts-title">ç›¸å…³æ–‡ç« </h3><div class="related-grid" role="feed" aria-label="ç›¸å…³æ–‡ç« åˆ—è¡¨"></div></section></article><div class="article-actions" role="toolbar" aria-label="æ–‡ç« æ“ä½œ"><button class="action-btn" id="likeBtn" title="ç‚¹èµ" aria-label="ç‚¹èµæ–‡ç« "><svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"></path></svg><span class="action-counter">0</span></button><button class="action-btn" id="commentBtn" title="è¯„è®º" aria-label="æŸ¥çœ‹æˆ–å‘è¡¨è¯„è®º"><svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M21 6h-2v9H6v2c0 .55.45 1 1 1h11l4 4V7c0-.55-.45-1-1-1zm-4 6V3c0-.55-.45-1-1-1H3c-.55 0-1 .45-1 1v14l4-4h10c.55 0 1-.45 1-1z"></path></svg><span class="action-counter">0</span></button><div class="action-divider"></div><button class="action-btn" id="shareBtn" title="åˆ†äº«" aria-label="åˆ†äº«æ–‡ç« "><svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z"></path></svg></button><button class="action-btn" id="topBtn" title="å›åˆ°é¡¶éƒ¨" aria-label="å›åˆ°é¡µé¢é¡¶éƒ¨"><svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6 1.41 1.41z"></path></svg></button></div><section class="comments-section" id="commentsSection" role="region" aria-label="è¯„è®ºåŒº"><div class="comments-container"><h3 class="comments-title"> <span>è¯„è®º</span><span class="comment-count">(0)</span></h3><div class="comment-form-container"><div class="comment-avatar"><img id="commentUserAvatar" src="/assets/placeholder-image.svg" alt="ç”¨æˆ·å¤´åƒ"></div><form class="comment-form" id="commentForm"><textarea class="comment-input" id="commentInput" placeholder="å†™ä¸‹ä½ çš„è¯„è®º..." rows="3" required></textarea><div class="comment-form-actions"><button class="comment-cancel-btn" id="commentCancelBtn" type="button">å–æ¶ˆ</button><button class="comment-submit-btn" id="commentSubmitBtn" type="submit">å‘å¸ƒè¯„è®º</button></div></form></div><div class="comments-list" id="commentsList"></div><div class="load-more-comments"><button class="load-more-btn" id="loadMoreCommentsBtn" type="button">åŠ è½½æ›´å¤šè¯„è®º</button></div></div></section><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "",
  "datePublished": "",
  "dateModified": "",
  "author": {
    "@type": "Person",
    "name": "JiangKing"
  },
  "publisher": {
    "@type": "Organization",
    "name": "JiangKingåšå®¢",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jiangking.com/assets/avatar.jpg"
    }
  },
  "description": "é˜…è¯»JiangKingåšå®¢ä¸Šçš„ã€Šundefinedã€‹ï¼Œæ¢ç´¢æ›´å¤šæŠ€æœ¯å†…å®¹",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://jiangking.com/blog/.html"
  }
}
</script><script>// é¡µé¢åŠ è½½å®Œæˆåæ‰§è¡Œ
document.addEventListener('DOMContentLoaded', function() {
  // åˆå§‹åŒ–ç”¨æˆ·ç•Œé¢
  initUserInterface();
  
  // è·å–æ–‡ç« ç»Ÿè®¡ä¿¡æ¯å’Œè¯„è®ºæ•°
  getArticleStats();
  
  // åˆå§‹åŒ–ç”¨æˆ·ç•Œé¢
  function initUserInterface() {
    // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦ç™»å½•
    if (window.ApiConfig && window.ApiConfig.user) {
      const isLoggedIn = window.ApiConfig.user.isLoggedIn();
      const guestArea = document.getElementById('guestArea');
      const userArea = document.getElementById('userArea');
      const usernameDisplay = document.getElementById('usernameDisplay');
      const userDropdown = document.getElementById('userDropdown');
      const userInfo = document.querySelector('.user-info');
      const loginBtn = document.getElementById('loginBtn');
      const registerBtn = document.getElementById('registerBtn');
      const logoutBtn = document.getElementById('logoutBtn');
      
      if (isLoggedIn) {
        // å·²ç™»å½•çŠ¶æ€
        if (guestArea) guestArea.classList.add('hidden');
        if (userArea) userArea.classList.remove('hidden');
        
        // æ˜¾ç¤ºç”¨æˆ·å
        const user = window.ApiConfig.user.getCurrentUserFromStorage();
        if (user && usernameDisplay) {
          usernameDisplay.textContent = user.username;
        }
        
        // ç»‘å®šç”¨æˆ·ä¸‹æ‹‰èœå•äº‹ä»¶
        if (userInfo) {
          userInfo.addEventListener('click', function() {
            if (userDropdown) {
              userDropdown.classList.toggle('show');
            }
          });
        }
        
        // ç»‘å®šç™»å‡ºäº‹ä»¶
        if (logoutBtn) {
          logoutBtn.addEventListener('click', function() {
            window.ApiConfig.user.logout().then(() => {
              window.location.reload();
            });
          });
        }
      } else {
        // æœªç™»å½•çŠ¶æ€
        if (guestArea) guestArea.classList.remove('hidden');
        if (userArea) userArea.classList.add('hidden');
        
        // ç»‘å®šç™»å½•æŒ‰é’®äº‹ä»¶
        if (loginBtn) {
          loginBtn.addEventListener('click', function() {
            showLoginModal();
          });
        }
        
        // ç»‘å®šæ³¨å†ŒæŒ‰é’®äº‹ä»¶
        if (registerBtn) {
          registerBtn.addEventListener('click', function() {
            showLoginModal();
            // åˆ‡æ¢åˆ°æ³¨å†Œè¡¨å•
            const authModal = document.getElementById('inline-auth-modal');
            if (authModal) {
              const loginForm = authModal.querySelector('#inline-login-form');
              const registerForm = authModal.querySelector('#inline-register-form');
              const loginTitle = authModal.querySelector('#inline-login-title');
              const registerTitle = authModal.querySelector('#inline-register-title');
              
              if (loginForm) loginForm.style.display = 'none';
              if (registerForm) registerForm.style.display = 'block';
              if (loginTitle) loginTitle.style.display = 'none';
              if (registerTitle) registerTitle.style.display = 'block';
            }
          });
        }
      }
      
      // ç‚¹å‡»å¤–éƒ¨å…³é—­ç”¨æˆ·ä¸‹æ‹‰èœå•
      document.addEventListener('click', function(e) {
        if (userDropdown && userDropdown.classList.contains('show')) {
          if (!e.target.closest('.user-dropdown')) {
            userDropdown.classList.remove('show');
          }
        }
      });
    }
  }
  console.log('å¼€å§‹å¤„ç†å›¾ç‰‡æ˜¾ç¤ºé—®é¢˜');
  
  // æ£€æµ‹æµè§ˆå™¨æ˜¯å¦æ”¯æŒwebpæ ¼å¼
  function checkWebpSupport() {
    const canvas = document.createElement('canvas');
    if (!canvas.getContext || !canvas.getContext('2d')) {
      return false;
    }
    
    return canvas.toDataURL('image/webp').indexOf('data:image/webp') === 0;
  }
  
  const supportsWebp = checkWebpSupport();
  console.log('æµè§ˆå™¨æ”¯æŒwebpæ ¼å¼:', supportsWebp);

  // 1. å¤„ç†ç›´æ¥æ˜¾ç¤ºä¸ºæ–‡æœ¬çš„å›¾ç‰‡URL (657bf33bfbf478066fd24f11b0eb95f7.webp)
  const allElements = document.querySelectorAll('.article-content *');
  allElements.forEach(el => {
    // æ£€æŸ¥æ˜¯å¦ä¸ºçº¯æ–‡æœ¬å…ƒç´ ä¸”æ–‡æœ¬å†…å®¹åƒå›¾ç‰‡URL
    const content = el.textContent ? el.textContent.trim() : '';
    if (content && (
        content.match(/[a-f0-9]{32}\.webp$/i) ||
        content.match(/\.(webp|jpg|png|gif|jpeg)$/i)
      ) &&
      el.childNodes.length === 1 &&
      el.childNodes[0].nodeType === Node.TEXT_NODE) {
      
      console.log('æ‰¾åˆ°å¯èƒ½æ˜¯å›¾ç‰‡URLçš„æ–‡æœ¬:', content);
      
      // åˆ›å»ºå›¾ç‰‡å®¹å™¨å’Œå›¾ç‰‡å…ƒç´ 
      const imgContainer = document.createElement('div');
      imgContainer.className = 'image-container';
      
      const img = document.createElement('img');
      
      // å°è¯•æ„é€ æ­£ç¡®çš„å›¾ç‰‡è·¯å¾„
      if (content.startsWith('/')) {
        // å·²ç»æ˜¯ç›¸å¯¹è·¯å¾„
        img.src = content;
      } else if (content.match(/[a-f0-9]{32}\.webp$/i) || content.endsWith('.webp')) {
        // çœ‹èµ·æ¥åƒæ˜¯åœ¨å½“å‰æ–‡ç« ç›®å½•ä¸‹çš„webpå›¾ç‰‡
        const articleId = window.location.pathname.split('/').pop().replace('.html', '');
        img.src = `/blog/images/${articleId}/${content}`;
      } else {
        // é»˜è®¤ä½¿ç”¨å ä½å›¾
        img.src = '/assets/placeholder-image.svg';
      }
      
      // æ·»åŠ é”™è¯¯å¤„ç†
      img.alt = 'æ–‡ç« å›¾ç‰‡';
      img.setAttribute('data-original-text', content);
      img.onerror = function() {
        this.onerror = null;
        this.src = '/assets/placeholder-image.svg';
        this.classList.add('error');
      };
      
      imgContainer.appendChild(img);
      
      // æ›¿æ¢å…ƒç´ 
      el.parentNode.replaceChild(imgContainer, el);
    }
  });
  
  // 2. æ£€æŸ¥å›¾ç‰‡å®¹å™¨å†…å®¹
  const imageContainers = document.querySelectorAll('.image-container');
  console.log('æ‰¾åˆ°å›¾ç‰‡å®¹å™¨:', imageContainers.length);
  
  imageContainers.forEach((container) => {
    // æ£€æŸ¥å®¹å™¨æ˜¯å¦åªæœ‰æ–‡æœ¬å†…å®¹
    if (!container.querySelector('img') && container.textContent.trim()) {
      const content = container.textContent.trim();
      console.log('å›¾ç‰‡å®¹å™¨å†…åªæœ‰æ–‡æœ¬:', content);
      
      // æ¸…ç©ºå®¹å™¨
      container.innerHTML = '';
      
      // åˆ›å»ºå›¾ç‰‡å…ƒç´ 
      const img = document.createElement('img');
      
      // å°è¯•æ„é€ æ­£ç¡®çš„å›¾ç‰‡è·¯å¾„
      if (content.match(/[a-f0-9]{32}\.webp$/i) || content.endsWith('.webp')) {
        // webpå›¾ç‰‡
        const articleId = window.location.pathname.split('/').pop().replace('.html', '');
        img.src = `/blog/images/${articleId}/${content}`;
      } else {
        // ä½¿ç”¨å ä½å›¾
        img.src = '/assets/placeholder-image.svg';
      }
      
      // æ·»åŠ é”™è¯¯å¤„ç†
      img.alt = 'æ–‡ç« å›¾ç‰‡';
      img.setAttribute('data-text-content', content);
      img.onerror = function() {
        this.onerror = null;
        this.src = '/assets/placeholder-image.svg';
        this.classList.add('error');
      };
      
      // æ·»åŠ åˆ°å®¹å™¨
      container.appendChild(img);
    }
  });
  
  // 3. å¤„ç†æ‰€æœ‰å›¾ç‰‡åŠ è½½é”™è¯¯
  const images = document.querySelectorAll('img');
  console.log('æ‰¾åˆ°å›¾ç‰‡å…ƒç´ :', images.length);
  
  images.forEach((img) => {
    // æ£€æŸ¥æ˜¯å¦ä¸ºSVGå›¾ç‰‡
    if (img.src.toLowerCase().endsWith('.svg')) {
      console.log('æ£€æµ‹åˆ°SVGå›¾ç‰‡:', img.src);
      img.classList.add('svg-image');
      // SVGå›¾ç‰‡ä¸éœ€è¦é”™è¯¯å¤„ç†
      return;
    }
    
    if (img.complete && img.naturalHeight === 0) {
      // å·²ç»åŠ è½½å¤±è´¥çš„å›¾ç‰‡
      console.log('å›¾ç‰‡å·²åŠ è½½å¤±è´¥:', img.src);
      img.classList.add('error');
      
      // å¦‚æœä¸æ˜¯å ä½å›¾ï¼Œåˆ™æ›¿æ¢ä¸ºå ä½å›¾
      if (!img.src.includes('placeholder-image')) {
        img.setAttribute('data-failed-src', img.src);
        img.src = '/assets/placeholder-image.svg';
        img.classList.add('svg-image'); // æ·»åŠ SVGç±»
      }
    } else {
      // æ·»åŠ åŠ è½½é”™è¯¯å¤„ç†
      img.addEventListener('error', function() {
        console.log('å›¾ç‰‡åŠ è½½å¤±è´¥:', this.src);
        this.classList.add('error');
        
        // å¦‚æœä¸æ˜¯å ä½å›¾ï¼Œåˆ™æ›¿æ¢ä¸ºå ä½å›¾
        if (!this.src.includes('placeholder-image')) {
          this.setAttribute('data-failed-src', this.src);
          this.src = '/assets/placeholder-image.svg';
          this.classList.add('svg-image'); // æ·»åŠ SVGç±»
        }
      });
    }
  });
  
  // é¼ æ ‡è·Ÿéšå…‰æ•ˆ
  setupCursorGlow();
  
  // ç›®å½•åŠŸèƒ½å·²åˆ é™¤
  
  // æ·»åŠ é˜…è¯»è¿›åº¦æ¡
  setupProgressBar();
  
  // è®¾ç½®æ–‡ç« å¤´éƒ¨æ•ˆæœ
  setupHeaderEffect();
  
  // æ·»åŠ ä»£ç é«˜äº®
  highlightCodeBlocks();
  
  // ç›®å½•æŒ‰é’®å·²åˆ é™¤
  
  // åˆå§‹åŒ–å³ä¸Šè§’å¯¼èˆªæŒ‰é’®åŠŸèƒ½
  const darkModeBtn = document.querySelector('.nav-btn[title="æš—è‰²æ¨¡å¼"]');
  if (darkModeBtn) {
    darkModeBtn.addEventListener('click', function() {
      document.body.classList.toggle('light-mode');
      const isDarkMode = !document.body.classList.contains('light-mode');
      localStorage.setItem('darkMode', isDarkMode ? 'true' : 'false');
      this.innerHTML = isDarkMode ? 'ğŸŒ™' : 'â˜€ï¸';
    });
    
    // ä»localStorageæ¢å¤æš—è‰²æ¨¡å¼çŠ¶æ€
    const isDarkMode = localStorage.getItem('darkMode') !== 'false';
    if (!isDarkMode) {
      document.body.classList.add('light-mode');
      darkModeBtn.innerHTML = 'â˜€ï¸';
    }
  }
  
  // å³ä¸Šè§’åˆ†äº«æŒ‰é’®
  const navShareBtn = document.querySelector('.nav-btn[title="åˆ†äº«"]');
  if (navShareBtn) {
    navShareBtn.addEventListener('click', function() {
      if (navigator.share) {
        navigator.share({
          title: document.title,
          url: window.location.href,
          text: document.querySelector('meta[name="description"]')?.content || document.title
        }).catch(error => {
          console.log('åˆ†äº«å¤±è´¥:', error);
          showShareDialog();
        });
      } else {
        showShareDialog();
      }
    });
  }
  
  // åº•éƒ¨æ“ä½œæŒ‰é’®åŠŸèƒ½
  setupActionButtons();
});

// æ»šåŠ¨åˆ°é¡¶éƒ¨
function scrollToTop() {
  window.scrollTo({ top: 0, behavior: 'smooth' });
}

// è®¾ç½®é¼ æ ‡è·Ÿéšå…‰æ•ˆ
function setupCursorGlow() {
  const cursorGlow = document.getElementById('cursorGlow');
  if (!cursorGlow) return;
  
  let mouseX = 0, mouseY = 0;
  let currentX = 0, currentY = 0;

  document.addEventListener('mousemove', (e) => {
    mouseX = e.clientX;
    mouseY = e.clientY;
  });

  function animateCursor() {
    currentX += (mouseX - currentX) * 0.1;
    currentY += (mouseY - currentY) * 0.1;
    
    cursorGlow.style.left = currentX + 'px';
    cursorGlow.style.top = currentY + 'px';
    
    requestAnimationFrame(animateCursor);
  }
  animateCursor();
}

// è®¾ç½®é˜…è¯»è¿›åº¦æ¡
function setupProgressBar() {
  const progressBar = document.getElementById('progressBar');
  
  window.addEventListener('scroll', () => {
    const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
    const scrollHeight = document.documentElement.scrollHeight || document.body.scrollHeight;
    const clientHeight = document.documentElement.clientHeight || window.innerHeight;
    
    const scrollPercentage = (scrollTop / (scrollHeight - clientHeight)) * 100;
    progressBar.style.width = scrollPercentage + '%';
  });
}

// ç›®å½•åŠŸèƒ½å·²åˆ é™¤

// è®¾ç½®æ–‡ç« å¤´éƒ¨æ•ˆæœ
function setupHeaderEffect() {
  const canvas = document.getElementById('headerCanvas');
  if (!canvas) return;
  
  const ctx = canvas.getContext('2d');
  canvas.width = window.innerWidth;
  canvas.height = 300;
  
  const particlesArray = [];
  
  // åˆ›å»ºç²’å­
  class Particle {
    constructor() {
      this.x = Math.random() * canvas.width;
      this.y = Math.random() * canvas.height;
      this.size = Math.random() * 2 + 0.5;
      this.speedX = Math.random() * 2 - 1;
      this.speedY = Math.random() * 2 - 1;
      this.color = `rgba(${99 + Math.random() * 30}, ${102 + Math.random() * 20}, ${241 + Math.random() * 14}, ${Math.random() * 0.5 + 0.2})`;
    }
    
    update() {
      this.x += this.speedX * 0.5;
      this.y += this.speedY * 0.5;
      
      if (this.size > 0.1) this.size -= 0.01;
      
      if (this.x < 0 || this.x > canvas.width) this.speedX *= -1;
      if (this.y < 0 || this.y > canvas.height) this.speedY *= -1;
    }
    
    draw() {
      ctx.fillStyle = this.color;
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
      ctx.fill();
    }
  }
  
  // åˆå§‹åŒ–ç²’å­
  function init() {
    for (let i = 0; i < 100; i++) {
      particlesArray.push(new Particle());
    }
  }
  
  // åŠ¨ç”»å¾ªç¯
  function animate() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    for (let i = 0; i < particlesArray.length; i++) {
      particlesArray[i].update();
      particlesArray[i].draw();
    }
    
    requestAnimationFrame(animate);
  }
  
  init();
  animate();
}

// ä»£ç é«˜äº®ï¼ˆç®€æ˜“ç‰ˆï¼‰
function highlightCodeBlocks() {
  const codeBlocks = document.querySelectorAll('pre code');
  
  codeBlocks.forEach(block => {
    // ç®€å•çš„è¯­æ³•é«˜äº®
    const text = block.innerHTML;
    
    // é«˜äº®å…³é”®å­—
    const keywordsList = ['function', 'return', 'if', 'else', 'for', 'while', 'var', 'let', 'const', 'class', 'import', 'export', 'from', 'await', 'async', 'try', 'catch'];
    const keywords = new RegExp(`\\b(${keywordsList.join('|')})\\b`, 'g');
    
    // é«˜äº®å­—ç¬¦ä¸²
    const strings = /(".*?"|'.*?'|`.*?`)/g;
    
    // é«˜äº®æ³¨é‡Š
    const comments = /(\/\/.*|\/\*[\s\S]*?\*\/)/g;
    
    // åº”ç”¨é«˜äº®
    let highlighted = text
      .replace(comments, '<span style="color: #6b7280;">$1</span>')
      .replace(strings, '<span style="color: #ec4899;">$1</span>')
      .replace(keywords, '<span style="color: #8b5cf6;">$1</span>');
      
    block.innerHTML = highlighted;
  });
}

// æ˜¾ç¤ºåˆ†äº«å¯¹è¯æ¡†
function showShareDialog() {
  alert('å·²å¤åˆ¶é“¾æ¥åˆ°å‰ªè´´æ¿ï¼Œå¿«å»åˆ†äº«å§ï¼');
  // å¤åˆ¶é“¾æ¥
  const textArea = document.createElement('textarea');
  textArea.value = window.location.href;
  textArea.style.position = 'fixed';
  textArea.style.opacity = '0';
  document.body.appendChild(textArea);
  textArea.focus();
  textArea.select();
  
  try {
    document.execCommand('copy');
  } catch (err) {
    console.error('å¤åˆ¶å¤±è´¥:', err);
  }
  
  document.body.removeChild(textArea);
}

// åœ¨å½“å‰é¡µé¢å†…å®ç°åŠŸèƒ½æŒ‰é’®
function setupActionButtons() {
  // åˆå§‹åŒ–è¯„è®ºåŠŸèƒ½
  initComments();
  
  // æ˜¾ç¤ºæ¶ˆæ¯æç¤º
  function showToast(message) {
    let toast = document.getElementById('toast');
    if (!toast) {
      toast = document.createElement('div');
      toast.id = 'toast';
      toast.className = 'toast';
      toast.style.position = 'fixed';
      toast.style.bottom = '30px';
      toast.style.left = '50%';
      toast.style.transform = 'translateX(-50%)';
      toast.style.background = 'rgba(99, 102, 241, 0.9)';
      toast.style.color = 'white';
      toast.style.padding = '12px 20px';
      toast.style.borderRadius = '8px';
      toast.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.2)';
      toast.style.transition = 'all 0.3s ease-in-out';
      toast.style.zIndex = '9999';
      toast.style.opacity = '0';
      document.body.appendChild(toast);
    }
    
    toast.textContent = message;
    toast.style.opacity = '1';
    
    setTimeout(() => {
      toast.style.opacity = '0';
    }, 3000);
  }
  
  // ä»localStorageè¯»å–ç”¨æˆ·äº’åŠ¨è®°å½•
  const userInteractions = JSON.parse(localStorage.getItem('blogInteractions') || '{}');
  const articleInteractions = userInteractions[articleId] || {
    liked: false,
    commentCount: 0,
    likeCount: 0
  };
  
  // ç‚¹èµåŠŸèƒ½
  const likeBtn = document.getElementById('likeBtn');
  if (likeBtn) {
    const likeCounter = likeBtn.querySelector('.action-counter');
    
    // ä»æœåŠ¡å™¨è·å–æ–‡ç« ç»Ÿè®¡ä¿¡æ¯
    async function loadArticleStats() {
      try {
        // ä½¿ç”¨ApiConfigè·å–æ–‡ç« ç»Ÿè®¡ä¿¡æ¯
        if (!window.ApiConfig || !window.ApiConfig.article) {
          likeCounter.textContent = '0';
          return;
        }
        
        const data = await window.ApiConfig.article.getArticleStats(articleId);
        
        // æ›´æ–°UI
        likeCounter.textContent = data.likeCount || 0;
        
        // è®¾ç½®ç”¨æˆ·çš„ç‚¹èµçŠ¶æ€
        if (data.hasLiked) {
          likeBtn.classList.add('active');
          articleInteractions.liked = true;
        } else {
          likeBtn.classList.remove('active');
          articleInteractions.liked = false;
        }
        
        // æ›´æ–°ç”¨æˆ·äº¤äº’è®°å½•
        userInteractions[articleId] = articleInteractions;
        localStorage.setItem('blogInteractions', JSON.stringify(userInteractions));
      } catch (error) {
        console.error('åŠ è½½æ–‡ç« ç»Ÿè®¡ä¿¡æ¯å¤±è´¥:', error);
        likeCounter.textContent = '0';
      }
    }
    
    // åŠ è½½ç»Ÿè®¡ä¿¡æ¯
    loadArticleStats();
    
    likeBtn.addEventListener('click', async function() {
      console.log('ç‚¹èµæŒ‰é’®è¢«ç‚¹å‡»');
      
      // é˜²æ­¢é‡å¤ç‚¹å‡»
      if (this.disabled) return;
      this.disabled = true;
      
      try {
        // æ£€æŸ¥ApiConfigæ˜¯å¦å¯ç”¨
        if (!window.ApiConfig || !window.ApiConfig.article) {
          console.error('ApiConfigæœªåˆå§‹åŒ–æˆ–ä¸å¯ç”¨');
          showToast('ç³»ç»Ÿé”™è¯¯ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
          return;
        }
        
        // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
        if (!window.ApiConfig.user.isLoggedIn()) {
          console.log('ç”¨æˆ·æœªç™»å½•ï¼Œæ˜¾ç¤ºç™»å½•æ¨¡æ€æ¡†');
          showToast('è¯·å…ˆç™»å½•åå†ç‚¹èµ');
          
          // å°è¯•æ˜¾ç¤ºç™»å½•æ¨¡æ€æ¡†
          showLoginModal();
          return;
        }
        
        console.log('è°ƒç”¨ApiConfigç‚¹èµæ¥å£, æ–‡ç« ID:', articleId);
        
        // è°ƒç”¨ApiConfigçš„ç‚¹èµæ–¹æ³•
        const data = await window.ApiConfig.article.likeArticle(articleId);
        console.log('ç‚¹èµæ¥å£è¿”å›æ•°æ®:', data);
        
        // æ ¹æ®æœåŠ¡å™¨è¿”å›æ›´æ–°UI
        if (data.action === 'liked') {
          this.classList.add('active');
          articleInteractions.liked = true;
          showToast('æ„Ÿè°¢ç‚¹èµ â¤ï¸');
          
          // ç‚¹èµåŠ¨ç”»
          const heart = document.createElement('span');
          heart.innerHTML = 'â¤ï¸';
          heart.style.position = 'absolute';
          heart.style.top = '50%';
          heart.style.left = '50%';
          heart.style.fontSize = '18px';
          heart.style.transform = 'translate(-50%, -50%)';
          heart.style.pointerEvents = 'none';
          heart.style.opacity = '1';
          heart.style.transition = 'all 0.5s';
          this.appendChild(heart);
          
          setTimeout(() => {
            heart.style.opacity = '0';
            heart.style.transform = 'translate(-50%, -100px)';
            setTimeout(() => heart.remove(), 500);
          }, 50);
        } else if (data.action === 'unliked') {
          this.classList.remove('active');
          articleInteractions.liked = false;
          showToast('å·²å–æ¶ˆç‚¹èµ');
        }
        
        // æ›´æ–°ç‚¹èµæ•°
        likeCounter.textContent = data.likeCount || 0;
        
        // æ›´æ–°ç”¨æˆ·äº¤äº’è®°å½•
        userInteractions[articleId] = articleInteractions;
        localStorage.setItem('blogInteractions', JSON.stringify(userInteractions));
        
      } catch (error) {
        console.error('ç‚¹èµè¯·æ±‚å¤±è´¥:', error);
        
        // å¤„ç†é”™è¯¯
        if (error.status === 401) {
          console.log('è®¤è¯å¤±è´¥(401)ï¼Œéœ€è¦ç™»å½•');
          showToast('è¯·å…ˆç™»å½•åå†ç‚¹èµ');
          
          // å°è¯•æ˜¾ç¤ºç™»å½•æ¨¡æ€æ¡†
          showLoginModal();
        } else {
          showToast('æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
        }
      } finally {
        // æ¢å¤æŒ‰é’®çŠ¶æ€
        this.disabled = false;
      }
    });
  }
  
  // æ”¶è—åŠŸèƒ½å·²ç§»é™¤
  
  // è¯„è®ºåŠŸèƒ½
  const commentBtn = document.getElementById('commentBtn');
  if (commentBtn) {
    commentBtn.addEventListener('click', function() {
      toggleCommentSection();
    });
  }
  
  // åˆ†äº«åŠŸèƒ½
  const shareBtn = document.getElementById('shareBtn');
  if (shareBtn) {
    console.log('æ‰¾åˆ°åˆ†äº«æŒ‰é’®');
    shareBtn.addEventListener('click', function() {
      console.log('åˆ†äº«æŒ‰é’®è¢«ç‚¹å‡»');
      if (navigator.share) {
        // ä½¿ç”¨åŸç”Ÿåˆ†äº«API
        navigator.share({
          title: document.title,
          url: window.location.href,
          text: document.querySelector('meta[name="description"]')?.content || document.title
        }).catch(error => {
          console.log('åˆ†äº«å¤±è´¥:', error);
          showShareDialog();
        });
      } else {
        // é™çº§ä¸ºå¼¹å‡ºå¼åˆ†äº«å¯¹è¯æ¡†
        showShareDialog();
      }
    });
  }
  
  // å›åˆ°é¡¶éƒ¨åŠŸèƒ½
  const topBtn = document.getElementById('topBtn');
  if (topBtn) {
    console.log('æ‰¾åˆ°å›åˆ°é¡¶éƒ¨æŒ‰é’®');
    topBtn.addEventListener('click', function() {
      console.log('å›åˆ°é¡¶éƒ¨æŒ‰é’®è¢«ç‚¹å‡»');
      window.scrollTo({ top: 0, behavior: 'smooth' });
    });
  }
}

// è·å–å½“å‰æ–‡ç« IDï¼ˆå…¨å±€å˜é‡ï¼‰
const articleId = window.location.pathname.split('/').pop().replace('.html', '');

// è¯„è®ºåŒºåŠŸèƒ½
function toggleCommentSection() {
  const commentsSection = document.getElementById('commentsSection');
  if (!commentsSection) return;
  
  commentsSection.classList.toggle('active');
  
  // å¦‚æœè¯„è®ºåŒºè¢«æ‰“å¼€ï¼Œåˆ™åŠ è½½è¯„è®º
  if (commentsSection.classList.contains('active')) {
    loadComments();
    
    // æ»šåŠ¨åˆ°è¯„è®ºåŒº
    setTimeout(() => {
      commentsSection.scrollIntoView({ behavior: 'smooth' });
    }, 100);
  }
}

// åŠ è½½è¯„è®º
async function loadComments() {
  const commentsList = document.getElementById('commentsList');
  const commentCounter = document.querySelector('.comment-count');
  const loadMoreBtn = document.getElementById('loadMoreCommentsBtn');
  
  if (!commentsList) return;
  
  try {
    // æ˜¾ç¤ºåŠ è½½ä¸­çŠ¶æ€
    commentsList.innerHTML = '<div class="loading-comments">åŠ è½½è¯„è®ºä¸­...</div>';
    
    // æ£€æŸ¥APIæ˜¯å¦å¯ç”¨
    if (!window.ApiConfig || !window.ApiConfig.article) {
      commentsList.innerHTML = '<div class="no-comments">è¯„è®ºåŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•</div>';
      return;
    }
    
    // è°ƒç”¨APIè·å–è¯„è®º
    const comments = await window.ApiConfig.article.getComments(articleId, { page: 1, limit: 10 });
    
    // æ›´æ–°è¯„è®ºè®¡æ•°ï¼ˆåªæœ‰åœ¨æ²¡æœ‰å·²æ˜¾ç¤ºçš„è¯„è®ºæ•°æ—¶æ‰æ›´æ–°ï¼‰
    if (commentCounter && (!commentCounter.textContent || commentCounter.textContent === '(0)')) {
      commentCounter.textContent = `(${comments.total || 0})`;
    }
    
    // å¦‚æœæ²¡æœ‰æ›´å¤šè¯„è®ºï¼Œéšè—åŠ è½½æ›´å¤šæŒ‰é’®
    if (loadMoreBtn) {
      loadMoreBtn.style.display = comments.hasMore ? 'inline-block' : 'none';
    }
    
    // å¦‚æœæ²¡æœ‰è¯„è®º
    if (!comments.data || comments.data.length === 0) {
      commentsList.innerHTML = '<div class="no-comments">æš‚æ— è¯„è®ºï¼Œå¿«æ¥å‘è¡¨ç¬¬ä¸€æ¡è¯„è®ºå§ï¼</div>';
      return;
    }
    
    // æ¸²æŸ“è¯„è®º
    commentsList.innerHTML = '';
    comments.data.forEach(comment => {
      const commentElement = createCommentElement(comment);
      commentsList.appendChild(commentElement);
    });
  } catch (error) {
    console.error('åŠ è½½è¯„è®ºå¤±è´¥:', error);
    commentsList.innerHTML = '<div class="no-comments">è¯„è®ºåŠ è½½å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•</div>';
  }
}

// åˆ›å»ºè¯„è®ºå…ƒç´ 
function createCommentElement(comment) {
  const commentItem = document.createElement('div');
  commentItem.className = 'comment-item';
  commentItem.dataset.commentId = comment.id;
  
  // æ ¼å¼åŒ–æ—¥æœŸ
  const commentDate = new Date(comment.createdAt);
  const formattedDate = commentDate.toLocaleDateString('zh-CN', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
    hour: '2-digit',
    minute: '2-digit'
  });
  
  commentItem.innerHTML = `
    <div class="comment-avatar">
      <img src="${comment.user.avatar || '/assets/placeholder-image.svg'}" alt="${comment.user.username}" loading="lazy">
    </div>
    <div class="comment-content">
      <div class="comment-header">
        <span class="comment-author">${comment.user.username}</span>
        <span class="comment-date">${formattedDate}</span>
      </div>
      <div class="comment-text">${comment.content}</div>
      <div class="comment-actions">
        <button class="comment-action comment-like" data-comment-id="${comment.id}">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"></path>
          </svg>
          <span>${comment.likeCount || 0}</span>
        </button>
        <button class="comment-action comment-reply" data-comment-id="${comment.id}">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
            <path d="M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14l4 4V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"></path>
          </svg>
          å›å¤
        </button>
      </div>
      ${comment.replies && comment.replies.length > 0 ? 
        `<div class="comment-replies">
          ${comment.replies.map(reply => `
            <div class="comment-item reply-item" data-reply-id="${reply.id}">
              <div class="comment-avatar">
                <img src="${reply.user.avatar || '/assets/placeholder-image.svg'}" alt="${reply.user.username}" loading="lazy">
              </div>
              <div class="comment-content">
                <div class="comment-header">
                  <span class="comment-author">${reply.user.username}</span>
                  <span class="comment-date">${new Date(reply.createdAt).toLocaleDateString('zh-CN', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                  })}</span>
                </div>
                <div class="comment-text">${reply.content}</div>
                <div class="comment-actions">
                  <button class="comment-action comment-like" data-reply-id="${reply.id}">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"></path>
                    </svg>
                    <span>${reply.likeCount || 0}</span>
                  </button>
                </div>
              </div>
            </div>
          `).join('')}
        </div>` : ''
      }
    </div>
  `;
  
  // ç»‘å®šè¯„è®ºç‚¹èµäº‹ä»¶
  const likeBtn = commentItem.querySelector('.comment-like');
  if (likeBtn) {
    likeBtn.addEventListener('click', function() {
      likeComment(comment.id);
    });
  }
  
  // ç»‘å®šè¯„è®ºå›å¤äº‹ä»¶
  const replyBtn = commentItem.querySelector('.comment-reply');
  if (replyBtn) {
    replyBtn.addEventListener('click', function() {
      showReplyForm(comment.id);
    });
  }
  
  return commentItem;
}

// åˆå§‹åŒ–è¯„è®ºè¡¨å•
function initCommentForm() {
  const commentForm = document.getElementById('commentForm');
  const commentInput = document.getElementById('commentInput');
  const commentSubmitBtn = document.getElementById('commentSubmitBtn');
  const commentCancelBtn = document.getElementById('commentCancelBtn');
  const commentUserAvatar = document.getElementById('commentUserAvatar');
  
  if (!commentForm || !commentInput || !commentSubmitBtn || !commentCancelBtn) return;
  
  // è®¾ç½®ç”¨æˆ·å¤´åƒ
  if (commentUserAvatar && window.ApiConfig && window.ApiConfig.user) {
    const user = window.ApiConfig.user.getCurrentUserFromStorage();
    if (user && user.avatar) {
      commentUserAvatar.src = user.avatar;
    }
  }
  
  // ç›‘å¬è¾“å…¥å˜åŒ–ï¼Œç¦ç”¨/å¯ç”¨æäº¤æŒ‰é’®
  commentInput.addEventListener('input', function() {
    commentSubmitBtn.disabled = !this.value.trim();
  });
  
  // å–æ¶ˆæŒ‰é’®ç‚¹å‡»äº‹ä»¶
  commentCancelBtn.addEventListener('click', function() {
    commentInput.value = '';
    commentSubmitBtn.disabled = true;
  });
  
  // æäº¤è¯„è®º
  commentForm.addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const content = commentInput.value.trim();
    if (!content) return;
    
    // ç¦ç”¨æäº¤æŒ‰é’®
    commentSubmitBtn.disabled = true;
    commentSubmitBtn.textContent = 'å‘å¸ƒä¸­...';
    
    try {
      // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
      if (!window.ApiConfig || !window.ApiConfig.user || !window.ApiConfig.user.isLoggedIn()) {
        showToast('è¯·å…ˆç™»å½•åå†å‘è¡¨è¯„è®º');
        showLoginModal();
        return;
      }
      
      // è°ƒç”¨APIå‘è¡¨è¯„è®º
      const response = await window.ApiConfig.article.addComment(articleId, { content });
      
      // æ¸…ç©ºè¾“å…¥æ¡†
      commentInput.value = '';
      
      // é‡æ–°åŠ è½½è¯„è®º
      loadComments();
      
      // æ˜¾ç¤ºæˆåŠŸæç¤º
      showToast('è¯„è®ºå‘å¸ƒæˆåŠŸ');
    } catch (error) {
      console.error('å‘è¡¨è¯„è®ºå¤±è´¥:', error);
      
      // å¤„ç†é”™è¯¯
      if (error.status === 401) {
        showToast('è¯·å…ˆç™»å½•åå†å‘è¡¨è¯„è®º');
        showLoginModal();
      } else {
        showToast('è¯„è®ºå‘å¸ƒå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
      }
    } finally {
      // æ¢å¤æŒ‰é’®çŠ¶æ€
      commentSubmitBtn.disabled = false;
      commentSubmitBtn.textContent = 'å‘å¸ƒè¯„è®º';
    }
  });
}

// ç‚¹èµè¯„è®º
async function likeComment(commentId) {
  try {
    // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
    if (!window.ApiConfig || !window.ApiConfig.user || !window.ApiConfig.user.isLoggedIn()) {
      showToast('è¯·å…ˆç™»å½•åå†ç‚¹èµ');
      showLoginModal();
      return;
    }
    
    // è°ƒç”¨APIç‚¹èµè¯„è®º
    const response = await window.ApiConfig.article.likeComment(commentId);
    
    // æ›´æ–°UI
    const likeBtn = document.querySelector(`.comment-like[data-comment-id="${commentId}"]`);
    if (likeBtn) {
      const likeCount = likeBtn.querySelector('span');
      if (likeCount) {
        likeCount.textContent = response.likeCount || 0;
      }
      
      // æ ¹æ®ç‚¹èµçŠ¶æ€æ›´æ–°æ ·å¼
      if (response.action === 'liked') {
        likeBtn.classList.add('active');
        showToast('ç‚¹èµæˆåŠŸ');
      } else {
        likeBtn.classList.remove('active');
        showToast('å·²å–æ¶ˆç‚¹èµ');
      }
    }
  } catch (error) {
    console.error('ç‚¹èµè¯„è®ºå¤±è´¥:', error);
    
    // å¤„ç†é”™è¯¯
    if (error.status === 401) {
      showToast('è¯·å…ˆç™»å½•åå†ç‚¹èµ');
      showLoginModal();
    } else {
      showToast('æ“ä½œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
    }
  }
}

// æ˜¾ç¤ºå›å¤è¡¨å•
function showReplyForm(commentId) {
  // æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²ç™»å½•
  if (!window.ApiConfig || !window.ApiConfig.user || !window.ApiConfig.user.isLoggedIn()) {
    showToast('è¯·å…ˆç™»å½•åå†å›å¤');
    showLoginModal();
    return;
  }
  
  const commentItem = document.querySelector(`.comment-item[data-comment-id="${commentId}"]`);
  if (!commentItem) return;
  
  // æ£€æŸ¥æ˜¯å¦å·²æœ‰å›å¤è¡¨å•
  let replyForm = commentItem.querySelector('.reply-form');
  
  // å¦‚æœæ²¡æœ‰å›å¤è¡¨å•ï¼Œåˆ›å»ºä¸€ä¸ª
  if (!replyForm) {
    const user = window.ApiConfig.user.getCurrentUserFromStorage();
    
    replyForm = document.createElement('div');
    replyForm.className = 'reply-form';
    replyForm.innerHTML = `
      <div class="comment-avatar">
        <img src="${user && user.avatar ? user.avatar : '/assets/placeholder-image.svg'}" alt="ç”¨æˆ·å¤´åƒ">
      </div>
      <form class="comment-form reply-comment-form">
        <textarea class="comment-input reply-input" placeholder="å›å¤è¯„è®º..." rows="2" required></textarea>
        <div class="comment-form-actions">
          <button type="button" class="comment-cancel-btn reply-cancel-btn">å–æ¶ˆ</button>
          <button type="submit" class="comment-submit-btn reply-submit-btn">å›å¤</button>
        </div>
      </form>
    `;
    
    // æ·»åŠ åˆ°è¯„è®ºé¡¹
    commentItem.appendChild(replyForm);
    
    // ç»‘å®šå–æ¶ˆæŒ‰é’®äº‹ä»¶
    const cancelBtn = replyForm.querySelector('.reply-cancel-btn');
    if (cancelBtn) {
      cancelBtn.addEventListener('click', function() {
        replyForm.classList.remove('active');
      });
    }
    
    // ç»‘å®šæäº¤äº‹ä»¶
    const form = replyForm.querySelector('form');
    if (form) {
      form.addEventListener('submit', async function(e) {
        e.preventDefault();
        
        const input = this.querySelector('.reply-input');
        const submitBtn = this.querySelector('.reply-submit-btn');
        
        if (!input || !submitBtn) return;
        
        const content = input.value.trim();
        if (!content) return;
        
        // ç¦ç”¨æäº¤æŒ‰é’®
        submitBtn.disabled = true;
        submitBtn.textContent = 'å›å¤ä¸­...';
        
        try {
          // è°ƒç”¨APIå›å¤è¯„è®º
          const response = await window.ApiConfig.article.replyComment(commentId, { content });
          
          // æ¸…ç©ºè¾“å…¥æ¡†
          input.value = '';
          
          // éšè—å›å¤è¡¨å•
          replyForm.classList.remove('active');
          
          // é‡æ–°åŠ è½½è¯„è®º
          loadComments();
          
          // æ˜¾ç¤ºæˆåŠŸæç¤º
          showToast('å›å¤æˆåŠŸ');
        } catch (error) {
          console.error('å›å¤è¯„è®ºå¤±è´¥:', error);
          showToast('å›å¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
        } finally {
          // æ¢å¤æŒ‰é’®çŠ¶æ€
          submitBtn.disabled = false;
          submitBtn.textContent = 'å›å¤';
        }
      });
    }
  }
  
  // æ˜¾ç¤ºå›å¤è¡¨å•
  replyForm.classList.toggle('active');
  
  // èšç„¦è¾“å…¥æ¡†
  if (replyForm.classList.contains('active')) {
    const input = replyForm.querySelector('.reply-input');
    if (input) {
      setTimeout(() => input.focus(), 100);
    }
  }
}

// åˆå§‹åŒ–åŠ è½½æ›´å¤šè¯„è®ºæŒ‰é’®
function initLoadMoreComments() {
  const loadMoreBtn = document.getElementById('loadMoreCommentsBtn');
  if (!loadMoreBtn) return;
  
  let currentPage = 1;
  
  loadMoreBtn.addEventListener('click', async function() {
    // ç¦ç”¨æŒ‰é’®
    this.disabled = true;
    this.textContent = 'åŠ è½½ä¸­...';
    
    try {
      // åŠ è½½ä¸‹ä¸€é¡µè¯„è®º
      currentPage++;
      
      // è°ƒç”¨APIè·å–æ›´å¤šè¯„è®º
      const comments = await window.ApiConfig.article.getComments(articleId, { 
        page: currentPage, 
        limit: 10 
      });
      
      // å¦‚æœæ²¡æœ‰æ›´å¤šè¯„è®ºï¼Œéšè—åŠ è½½æ›´å¤šæŒ‰é’®
      if (!comments.hasMore) {
        this.style.display = 'none';
      }
      
      // æ·»åŠ è¯„è®ºåˆ°åˆ—è¡¨
      const commentsList = document.getElementById('commentsList');
      if (commentsList && comments.data && comments.data.length > 0) {
        comments.data.forEach(comment => {
          const commentElement = createCommentElement(comment);
          commentsList.appendChild(commentElement);
        });
      }
    } catch (error) {
      console.error('åŠ è½½æ›´å¤šè¯„è®ºå¤±è´¥:', error);
      showToast('åŠ è½½æ›´å¤šè¯„è®ºå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
    } finally {
      // æ¢å¤æŒ‰é’®çŠ¶æ€
      this.disabled = false;
      this.textContent = 'åŠ è½½æ›´å¤šè¯„è®º';
    }
  });
}

// åˆå§‹åŒ–è¯„è®ºåŠŸèƒ½
function initComments() {
  // åˆå§‹åŒ–è¯„è®ºè¡¨å•
  initCommentForm();
  
  // åˆå§‹åŒ–åŠ è½½æ›´å¤šè¯„è®ºæŒ‰é’®
  initLoadMoreComments();
}

// ç™»å½•æ¨¡æ€æ¡†åŠŸèƒ½
function showLoginModal() {
  console.log('æ˜¾ç¤ºç™»å½•æ¨¡æ€æ¡†');
  
  // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨æ¨¡æ€æ¡†
  let authModal = document.getElementById('inline-auth-modal');
  
  // å¦‚æœä¸å­˜åœ¨ï¼Œåˆ›å»ºä¸€ä¸ª
  if (!authModal) {
    // åˆ›å»ºåŸºç¡€æ¨¡æ€æ¡†ç»“æ„
    authModal = document.createElement('div');
    authModal.id = 'inline-auth-modal';
    authModal.className = 'modal';
    authModal.style.display = 'flex';
    authModal.style.position = 'fixed';
    authModal.style.top = '0';
    authModal.style.left = '0';
    authModal.style.width = '100%';
    authModal.style.height = '100%';
    authModal.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
    authModal.style.zIndex = '1000';
    authModal.style.overflow = 'auto';
    authModal.style.backdropFilter = 'blur(5px)';
    authModal.style.justifyContent = 'center';
    authModal.style.alignItems = 'center';
    
    // åˆ›å»ºæ¨¡æ€æ¡†å®¹å™¨
    const modalContainer = document.createElement('div');
    modalContainer.className = 'modal-container';
    modalContainer.style.width = '90%';
    modalContainer.style.maxWidth = '450px';
    modalContainer.style.background = 'linear-gradient(135deg, rgba(15, 15, 35, 0.95), rgba(30, 30, 60, 0.95))';
    modalContainer.style.borderRadius = '10px';
    modalContainer.style.boxShadow = '0 15px 25px rgba(0, 0, 0, 0.6)';
    modalContainer.style.border = '1px solid rgba(99, 102, 241, 0.3)';
    modalContainer.style.padding = '20px';
    modalContainer.style.margin = '20px';
    modalContainer.style.position = 'relative';
    modalContainer.style.overflow = 'hidden';
    
    // æ·»åŠ é¡¶éƒ¨æ¸å˜è¾¹æ¡†æ•ˆæœ
    modalContainer.innerHTML = `<div style="
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      height: 3px;
      background: linear-gradient(90deg, #6366f1, #8b5cf6);
      z-index: 1;
    "></div>`;
    
    // åˆ›å»ºæ¨¡æ€æ¡†å¤´éƒ¨
    const modalHeader = document.createElement('div');
    modalHeader.className = 'modal-header';
    modalHeader.style.display = 'flex';
    modalHeader.style.justifyContent = 'space-between';
    modalHeader.style.alignItems = 'center';
    modalHeader.style.marginBottom = '20px';
    modalHeader.style.paddingBottom = '10px';
    modalHeader.style.borderBottom = '1px solid rgba(255, 255, 255, 0.1)';
    
    // åˆ›å»ºæ ‡é¢˜å®¹å™¨
    const loginTitle = document.createElement('h3');
    loginTitle.id = 'inline-login-title';
    loginTitle.textContent = 'ç”¨æˆ·ç™»å½•';
    loginTitle.style.margin = '0';
    loginTitle.style.fontSize = '1.5rem';
    loginTitle.style.fontWeight = '600';
    loginTitle.style.background = 'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)';
    loginTitle.style.webkitBackgroundClip = 'text';
    loginTitle.style.webkitTextFillColor = 'transparent';
    loginTitle.style.backgroundClip = 'text';
    
    const registerTitle = document.createElement('h3');
    registerTitle.id = 'inline-register-title';
    registerTitle.textContent = 'ç”¨æˆ·æ³¨å†Œ';
    registerTitle.style.display = 'none';
    registerTitle.style.margin = '0';
    registerTitle.style.fontSize = '1.5rem';
    registerTitle.style.fontWeight = '600';
    registerTitle.style.background = 'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)';
    registerTitle.style.webkitBackgroundClip = 'text';
    registerTitle.style.webkitTextFillColor = 'transparent';
    registerTitle.style.backgroundClip = 'text';
    
    // åˆ›å»ºå…³é—­æŒ‰é’®
    const closeBtn = document.createElement('button');
    closeBtn.textContent = 'Ã—';
    closeBtn.style.background = 'none';
    closeBtn.style.border = 'none';
    closeBtn.style.color = 'rgba(255, 255, 255, 0.6)';
    closeBtn.style.fontSize = '1.5rem';
    closeBtn.style.cursor = 'pointer';
    closeBtn.style.transition = 'color 0.3s';
    closeBtn.addEventListener('mouseenter', () => {
      closeBtn.style.color = 'rgba(239, 68, 68, 1)';
    });
    closeBtn.addEventListener('mouseleave', () => {
      closeBtn.style.color = 'rgba(255, 255, 255, 0.6)';
    });
    closeBtn.addEventListener('click', () => {
      authModal.remove();
      document.body.style.overflow = ''; // æ¢å¤é¡µé¢æ»šåŠ¨
    });
    
    modalHeader.appendChild(loginTitle);
    modalHeader.appendChild(registerTitle);
    modalHeader.appendChild(closeBtn);
    
    // åˆ›å»ºæ¨¡æ€æ¡†ä¸»ä½“
    const modalBody = document.createElement('div');
    modalBody.className = 'modal-body';
    
    // åˆ›å»ºç™»å½•è¡¨å•
    const loginForm = document.createElement('form');
    loginForm.id = 'inline-login-form';
    
    // é‚®ç®±è¾“å…¥ç»„
    const loginEmailGroup = document.createElement('div');
    loginEmailGroup.style.marginBottom = '15px';
    
    const loginEmailLabel = document.createElement('label');
    loginEmailLabel.textContent = 'é‚®ç®±';
    loginEmailLabel.htmlFor = 'inline-login-email';
    loginEmailLabel.style.display = 'block';
    loginEmailLabel.style.marginBottom = '8px';
    loginEmailLabel.style.fontSize = '0.9rem';
    loginEmailLabel.style.color = 'rgba(255, 255, 255, 0.9)';
    loginEmailLabel.style.opacity = '0.8';
    
    const loginEmailInput = document.createElement('input');
    loginEmailInput.type = 'email';
    loginEmailInput.id = 'inline-login-email';
    loginEmailInput.placeholder = 'è¯·è¾“å…¥é‚®ç®±';
    loginEmailInput.required = true;
    loginEmailInput.style.width = '100%';
    loginEmailInput.style.padding = '12px 15px';
    loginEmailInput.style.background = 'rgba(255, 255, 255, 0.05)';
    loginEmailInput.style.border = '1px solid rgba(255, 255, 255, 0.1)';
    loginEmailInput.style.borderRadius = '5px';
    loginEmailInput.style.color = 'rgba(255, 255, 255, 0.9)';
    loginEmailInput.style.fontSize = '1rem';
    loginEmailInput.style.transition = 'all 0.3s';
    
    loginEmailGroup.appendChild(loginEmailLabel);
    loginEmailGroup.appendChild(loginEmailInput);
    
    // å¯†ç è¾“å…¥ç»„
    const loginPasswordGroup = document.createElement('div');
    loginPasswordGroup.style.marginBottom = '15px';
    
    const loginPasswordLabel = document.createElement('label');
    loginPasswordLabel.textContent = 'å¯†ç ';
    loginPasswordLabel.htmlFor = 'inline-login-password';
    loginPasswordLabel.style.display = 'block';
    loginPasswordLabel.style.marginBottom = '8px';
    loginPasswordLabel.style.fontSize = '0.9rem';
    loginPasswordLabel.style.color = 'rgba(255, 255, 255, 0.9)';
    loginPasswordLabel.style.opacity = '0.8';
    
    const loginPasswordInput = document.createElement('input');
    loginPasswordInput.type = 'password';
    loginPasswordInput.id = 'inline-login-password';
    loginPasswordInput.placeholder = 'è¯·è¾“å…¥å¯†ç ';
    loginPasswordInput.required = true;
    loginPasswordInput.style.width = '100%';
    loginPasswordInput.style.padding = '12px 15px';
    loginPasswordInput.style.background = 'rgba(255, 255, 255, 0.05)';
    loginPasswordInput.style.border = '1px solid rgba(255, 255, 255, 0.1)';
    loginPasswordInput.style.borderRadius = '5px';
    loginPasswordInput.style.color = 'rgba(255, 255, 255, 0.9)';
    loginPasswordInput.style.fontSize = '1rem';
    loginPasswordInput.style.transition = 'all 0.3s';
    
    loginPasswordGroup.appendChild(loginPasswordLabel);
    loginPasswordGroup.appendChild(loginPasswordInput);
    
    // æ“ä½œæŒ‰é’®ç»„
    const loginActionsGroup = document.createElement('div');
    loginActionsGroup.style.display = 'flex';
    loginActionsGroup.style.justifyContent = 'space-between';
    loginActionsGroup.style.alignItems = 'center';
    loginActionsGroup.style.marginTop = '25px';
    
    const loginBtn = document.createElement('button');
    loginBtn.type = 'submit';
    loginBtn.textContent = 'ç™»å½•';
    loginBtn.style.padding = '10px 20px';
    loginBtn.style.border = 'none';
    loginBtn.style.borderRadius = '5px';
    loginBtn.style.background = 'linear-gradient(135deg, #6366f1, #4f46e5)';
    loginBtn.style.color = 'white';
    loginBtn.style.fontWeight = '500';
    loginBtn.style.cursor = 'pointer';
    loginBtn.style.boxShadow = '0 4px 10px rgba(99, 102, 241, 0.3)';
    loginBtn.style.transition = 'all 0.3s';
    loginBtn.addEventListener('mouseenter', () => {
      loginBtn.style.transform = 'translateY(-2px)';
      loginBtn.style.boxShadow = '0 6px 15px rgba(99, 102, 241, 0.4)';
    });
    loginBtn.addEventListener('mouseleave', () => {
      loginBtn.style.transform = 'translateY(0)';
      loginBtn.style.boxShadow = '0 4px 10px rgba(99, 102, 241, 0.3)';
    });
    
    const switchToRegisterBtn = document.createElement('button');
    switchToRegisterBtn.type = 'button';
    switchToRegisterBtn.textContent = 'æ²¡æœ‰è´¦å·ï¼Ÿæ³¨å†Œ';
    switchToRegisterBtn.style.background = 'transparent';
    switchToRegisterBtn.style.border = 'none';
    switchToRegisterBtn.style.color = '#6366f1';
    switchToRegisterBtn.style.padding = '10px 0';
    switchToRegisterBtn.style.cursor = 'pointer';
    switchToRegisterBtn.addEventListener('mouseenter', () => {
      switchToRegisterBtn.style.textDecoration = 'underline';
    });
    switchToRegisterBtn.addEventListener('mouseleave', () => {
      switchToRegisterBtn.style.textDecoration = 'none';
    });
    switchToRegisterBtn.addEventListener('click', () => {
      // åˆ‡æ¢åˆ°æ³¨å†Œè¡¨å•
      loginForm.style.display = 'none';
      registerForm.style.display = 'block';
      loginTitle.style.display = 'none';
      registerTitle.style.display = 'block';
      errorContainer.style.display = 'none';
      errorMessage.textContent = '';
    });
    
    loginActionsGroup.appendChild(loginBtn);
    loginActionsGroup.appendChild(switchToRegisterBtn);
    
    loginForm.appendChild(loginEmailGroup);
    loginForm.appendChild(loginPasswordGroup);
    loginForm.appendChild(loginActionsGroup);
    
    // åˆ›å»ºæ³¨å†Œè¡¨å•
    const registerForm = document.createElement('form');
    registerForm.id = 'inline-register-form';
    registerForm.style.display = 'none';
    
    // ç”¨æˆ·åè¾“å…¥ç»„
    const regUsernameGroup = document.createElement('div');
    regUsernameGroup.style.marginBottom = '15px';
    
    const regUsernameLabel = document.createElement('label');
    regUsernameLabel.textContent = 'ç”¨æˆ·å';
    regUsernameLabel.htmlFor = 'inline-reg-username';
    regUsernameLabel.style.display = 'block';
    regUsernameLabel.style.marginBottom = '8px';
    regUsernameLabel.style.fontSize = '0.9rem';
    regUsernameLabel.style.color = 'rgba(255, 255, 255, 0.9)';
    regUsernameLabel.style.opacity = '0.8';
    
    const regUsernameInput = document.createElement('input');
    regUsernameInput.type = 'text';
    regUsernameInput.id = 'inline-reg-username';
    regUsernameInput.placeholder = 'è¯·è®¾ç½®ç”¨æˆ·å';
    regUsernameInput.required = true;
    regUsernameInput.style.width = '100%';
    regUsernameInput.style.padding = '12px 15px';
    regUsernameInput.style.background = 'rgba(255, 255, 255, 0.05)';
    regUsernameInput.style.border = '1px solid rgba(255, 255, 255, 0.1)';
    regUsernameInput.style.borderRadius = '5px';
    regUsernameInput.style.color = 'rgba(255, 255, 255, 0.9)';
    regUsernameInput.style.fontSize = '1rem';
    regUsernameInput.style.transition = 'all 0.3s';
    
    regUsernameGroup.appendChild(regUsernameLabel);
    regUsernameGroup.appendChild(regUsernameInput);
    
    // é‚®ç®±è¾“å…¥ç»„
    const regEmailGroup = document.createElement('div');
    regEmailGroup.style.marginBottom = '15px';
    
    const regEmailLabel = document.createElement('label');
    regEmailLabel.textContent = 'é‚®ç®±';
    regEmailLabel.htmlFor = 'inline-reg-email';
    regEmailLabel.style.display = 'block';
    regEmailLabel.style.marginBottom = '8px';
    regEmailLabel.style.fontSize = '0.9rem';
    regEmailLabel.style.color = 'rgba(255, 255, 255, 0.9)';
    regEmailLabel.style.opacity = '0.8';
    
    const regEmailInput = document.createElement('input');
    regEmailInput.type = 'email';
    regEmailInput.id = 'inline-reg-email';
    regEmailInput.placeholder = 'è¯·è¾“å…¥é‚®ç®±';
    regEmailInput.required = true;
    regEmailInput.style.width = '100%';
    regEmailInput.style.padding = '12px 15px';
    regEmailInput.style.background = 'rgba(255, 255, 255, 0.05)';
    regEmailInput.style.border = '1px solid rgba(255, 255, 255, 0.1)';
    regEmailInput.style.borderRadius = '5px';
    regEmailInput.style.color = 'rgba(255, 255, 255, 0.9)';
    regEmailInput.style.fontSize = '1rem';
    regEmailInput.style.transition = 'all 0.3s';
    
    regEmailGroup.appendChild(regEmailLabel);
    regEmailGroup.appendChild(regEmailInput);
    
    // å¯†ç è¾“å…¥ç»„
    const regPasswordGroup = document.createElement('div');
    regPasswordGroup.style.marginBottom = '15px';
    
    const regPasswordLabel = document.createElement('label');
    regPasswordLabel.textContent = 'å¯†ç ';
    regPasswordLabel.htmlFor = 'inline-reg-password';
    regPasswordLabel.style.display = 'block';
    regPasswordLabel.style.marginBottom = '8px';
    regPasswordLabel.style.fontSize = '0.9rem';
    regPasswordLabel.style.color = 'rgba(255, 255, 255, 0.9)';
    regPasswordLabel.style.opacity = '0.8';
    
    const regPasswordInput = document.createElement('input');
    regPasswordInput.type = 'password';
    regPasswordInput.id = 'inline-reg-password';
    regPasswordInput.placeholder = 'è¯·è®¾ç½®å¯†ç ';
    regPasswordInput.required = true;
    regPasswordInput.style.width = '100%';
    regPasswordInput.style.padding = '12px 15px';
    regPasswordInput.style.background = 'rgba(255, 255, 255, 0.05)';
    regPasswordInput.style.border = '1px solid rgba(255, 255, 255, 0.1)';
    regPasswordInput.style.borderRadius = '5px';
    regPasswordInput.style.color = 'rgba(255, 255, 255, 0.9)';
    regPasswordInput.style.fontSize = '1rem';
    regPasswordInput.style.transition = 'all 0.3s';
    
    regPasswordGroup.appendChild(regPasswordLabel);
    regPasswordGroup.appendChild(regPasswordInput);
    
    // ç¡®è®¤å¯†ç è¾“å…¥ç»„
    const regConfirmPasswordGroup = document.createElement('div');
    regConfirmPasswordGroup.style.marginBottom = '15px';
    
    const regConfirmPasswordLabel = document.createElement('label');
    regConfirmPasswordLabel.textContent = 'ç¡®è®¤å¯†ç ';
    regConfirmPasswordLabel.htmlFor = 'inline-reg-confirm-password';
    regConfirmPasswordLabel.style.display = 'block';
    regConfirmPasswordLabel.style.marginBottom = '8px';
    regConfirmPasswordLabel.style.fontSize = '0.9rem';
    regConfirmPasswordLabel.style.color = 'rgba(255, 255, 255, 0.9)';
    regConfirmPasswordLabel.style.opacity = '0.8';
    
    const regConfirmPasswordInput = document.createElement('input');
    regConfirmPasswordInput.type = 'password';
    regConfirmPasswordInput.id = 'inline-reg-confirm-password';
    regConfirmPasswordInput.placeholder = 'è¯·å†æ¬¡è¾“å…¥å¯†ç ';
    regConfirmPasswordInput.required = true;
    regConfirmPasswordInput.style.width = '100%';
    regConfirmPasswordInput.style.padding = '12px 15px';
    regConfirmPasswordInput.style.background = 'rgba(255, 255, 255, 0.05)';
    regConfirmPasswordInput.style.border = '1px solid rgba(255, 255, 255, 0.1)';
    regConfirmPasswordInput.style.borderRadius = '5px';
    regConfirmPasswordInput.style.color = 'rgba(255, 255, 255, 0.9)';
    regConfirmPasswordInput.style.fontSize = '1rem';
    regConfirmPasswordInput.style.transition = 'all 0.3s';
    
    regConfirmPasswordGroup.appendChild(regConfirmPasswordLabel);
    regConfirmPasswordGroup.appendChild(regConfirmPasswordInput);
    
    // æ“ä½œæŒ‰é’®ç»„
    const regActionsGroup = document.createElement('div');
    regActionsGroup.style.display = 'flex';
    regActionsGroup.style.justifyContent = 'space-between';
    regActionsGroup.style.alignItems = 'center';
    regActionsGroup.style.marginTop = '25px';
    
    const registerBtn = document.createElement('button');
    registerBtn.type = 'submit';
    registerBtn.textContent = 'æ³¨å†Œ';
    registerBtn.style.padding = '10px 20px';
    registerBtn.style.border = 'none';
    registerBtn.style.borderRadius = '5px';
    registerBtn.style.background = 'linear-gradient(135deg, #6366f1, #4f46e5)';
    registerBtn.style.color = 'white';
    registerBtn.style.fontWeight = '500';
    registerBtn.style.cursor = 'pointer';
    registerBtn.style.boxShadow = '0 4px 10px rgba(99, 102, 241, 0.3)';
    registerBtn.style.transition = 'all 0.3s';
    registerBtn.addEventListener('mouseenter', () => {
      registerBtn.style.transform = 'translateY(-2px)';
      registerBtn.style.boxShadow = '0 6px 15px rgba(99, 102, 241, 0.4)';
    });
    registerBtn.addEventListener('mouseleave', () => {
      registerBtn.style.transform = 'translateY(0)';
      registerBtn.style.boxShadow = '0 4px 10px rgba(99, 102, 241, 0.3)';
    });
    
    const switchToLoginBtn = document.createElement('button');
    switchToLoginBtn.type = 'button';
    switchToLoginBtn.textContent = 'å·²æœ‰è´¦å·ï¼Ÿç™»å½•';
    switchToLoginBtn.style.background = 'transparent';
    switchToLoginBtn.style.border = 'none';
    switchToLoginBtn.style.color = '#6366f1';
    switchToLoginBtn.style.padding = '10px 0';
    switchToLoginBtn.style.cursor = 'pointer';
    switchToLoginBtn.addEventListener('mouseenter', () => {
      switchToLoginBtn.style.textDecoration = 'underline';
    });
    switchToLoginBtn.addEventListener('mouseleave', () => {
      switchToLoginBtn.style.textDecoration = 'none';
    });
    switchToLoginBtn.addEventListener('click', () => {
      // åˆ‡æ¢åˆ°ç™»å½•è¡¨å•
      registerForm.style.display = 'none';
      loginForm.style.display = 'block';
      registerTitle.style.display = 'none';
      loginTitle.style.display = 'block';
      errorContainer.style.display = 'none';
      errorMessage.textContent = '';
    });
    
    regActionsGroup.appendChild(registerBtn);
    regActionsGroup.appendChild(switchToLoginBtn);
    
    registerForm.appendChild(regUsernameGroup);
    registerForm.appendChild(regEmailGroup);
    registerForm.appendChild(regPasswordGroup);
    registerForm.appendChild(regConfirmPasswordGroup);
    registerForm.appendChild(regActionsGroup);
    
    // åˆ›å»ºé”™è¯¯ä¿¡æ¯å®¹å™¨
    const errorContainer = document.createElement('div');
    errorContainer.style.marginTop = '15px';
    errorContainer.style.padding = '10px';
    errorContainer.style.borderRadius = '5px';
    errorContainer.style.background = 'rgba(239, 68, 68, 0.2)';
    errorContainer.style.border = '1px solid rgba(239, 68, 68, 0.3)';
    errorContainer.style.display = 'none';
    
    const errorMessage = document.createElement('p');
    errorMessage.style.color = 'rgb(252, 165, 165)';
    errorMessage.style.margin = '0';
    errorContainer.appendChild(errorMessage);
    
    // åˆ›å»ºæˆåŠŸä¿¡æ¯å®¹å™¨
    const successContainer = document.createElement('div');
    successContainer.style.marginTop = '15px';
    successContainer.style.padding = '10px';
    successContainer.style.borderRadius = '5px';
    successContainer.style.background = 'rgba(16, 185, 129, 0.2)';
    successContainer.style.border = '1px solid rgba(16, 185, 129, 0.3)';
    successContainer.style.display = 'none';
    
    const successMessage = document.createElement('p');
    successMessage.style.color = 'rgb(110, 231, 183)';
    successMessage.style.margin = '0';
    successContainer.appendChild(successMessage);
    
    modalBody.appendChild(loginForm);
    modalBody.appendChild(registerForm);
    modalBody.appendChild(errorContainer);
    modalBody.appendChild(successContainer);
    
    // åˆ›å»ºæ¨¡æ€æ¡†åº•éƒ¨
    const modalFooter = document.createElement('div');
    modalFooter.style.marginTop = '20px';
    modalFooter.style.paddingTop = '15px';
    modalFooter.style.borderTop = '1px solid rgba(255, 255, 255, 0.1)';
    modalFooter.style.textAlign = 'center';
    
    const copyright = document.createElement('p');
    copyright.textContent = 'Â© æ±Ÿæ™¯åšå®¢. ä¿æŠ¤æ‚¨çš„è´¦å·ä¿¡æ¯å®‰å…¨';
    copyright.style.fontSize = '0.8rem';
    copyright.style.color = 'rgba(255, 255, 255, 0.5)';
    modalFooter.appendChild(copyright);
    
    // ç»„è£…æ¨¡æ€æ¡†
    modalContainer.appendChild(modalHeader);
    modalContainer.appendChild(modalBody);
    modalContainer.appendChild(modalFooter);
    authModal.appendChild(modalContainer);
    document.body.appendChild(authModal);
    document.body.style.overflow = 'hidden'; // é˜²æ­¢é¡µé¢æ»šåŠ¨
    
    // ç»‘å®šç™»å½•è¡¨å•æäº¤äº‹ä»¶
    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const email = loginEmailInput.value.trim();
      const password = loginPasswordInput.value.trim();
      
      // è¡¨å•éªŒè¯
      if (!email || !password) {
        errorMessage.textContent = 'é‚®ç®±å’Œå¯†ç ä¸èƒ½ä¸ºç©º';
        errorContainer.style.display = 'block';
        return;
      }
      
      // éšè—é”™è¯¯ä¿¡æ¯
      errorContainer.style.display = 'none';
      
      try {
        // ç¦ç”¨ç™»å½•æŒ‰é’®
        loginBtn.disabled = true;
        loginBtn.style.opacity = '0.7';
        loginBtn.textContent = 'ç™»å½•ä¸­...';
        
        // è°ƒç”¨ç™»å½•API
        if (window.ApiConfig && window.ApiConfig.user) {
          const response = await window.ApiConfig.user.login(email, password);
          
          // æ˜¾ç¤ºæˆåŠŸä¿¡æ¯
          successMessage.textContent = 'ç™»å½•æˆåŠŸï¼Œæ­£åœ¨è·³è½¬...';
          successContainer.style.display = 'block';
          
          // å»¶è¿Ÿå…³é—­æ¨¡æ€æ¡†
          setTimeout(() => {
            document.body.removeChild(authModal);
            document.body.style.overflow = ''; // æ¢å¤é¡µé¢æ»šåŠ¨
            
            // åˆ·æ–°å½“å‰é¡µé¢æˆ–è¿”å›ä¸Šä¸€é¡µ
            window.location.reload();
          }, 1000);
        } else {
          throw new Error('ApiConfigæœªåˆå§‹åŒ–');
        }
      } catch (error) {
        // å¯ç”¨ç™»å½•æŒ‰é’®
        loginBtn.disabled = false;
        loginBtn.style.opacity = '1';
        loginBtn.textContent = 'ç™»å½•';
        
        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        errorMessage.textContent = error.message || 'ç™»å½•å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•';
        errorContainer.style.display = 'block';
      }
    });
    
    // ç»‘å®šæ³¨å†Œè¡¨å•æäº¤äº‹ä»¶
    registerForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const username = regUsernameInput.value.trim();
      const email = regEmailInput.value.trim();
      const password = regPasswordInput.value.trim();
      const confirmPassword = regConfirmPasswordInput.value.trim();
      
      // è¡¨å•éªŒè¯
      if (!username || !email || !password || !confirmPassword) {
        errorMessage.textContent = 'æ‰€æœ‰å­—æ®µéƒ½æ˜¯å¿…å¡«çš„';
        errorContainer.style.display = 'block';
        return;
      }
      
      if (password !== confirmPassword) {
        errorMessage.textContent = 'ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´';
        errorContainer.style.display = 'block';
        return;
      }
      
      // é‚®ç®±æ ¼å¼éªŒè¯
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!emailRegex.test(email)) {
        errorMessage.textContent = 'è¯·è¾“å…¥æœ‰æ•ˆçš„é‚®ç®±åœ°å€';
        errorContainer.style.display = 'block';
        return;
      }
      
      // éšè—é”™è¯¯ä¿¡æ¯
      errorContainer.style.display = 'none';
      
      try {
        // ç¦ç”¨æ³¨å†ŒæŒ‰é’®
        registerBtn.disabled = true;
        registerBtn.style.opacity = '0.7';
        registerBtn.textContent = 'æ³¨å†Œä¸­...';
        
        // è°ƒç”¨æ³¨å†ŒAPI
        if (window.ApiConfig && window.ApiConfig.user) {
          const response = await window.ApiConfig.user.register({
            username,
            email,
            password
          });
          
          // æ˜¾ç¤ºæˆåŠŸä¿¡æ¯
          successMessage.textContent = 'æ³¨å†ŒæˆåŠŸï¼Œè¯·ç™»å½•';
          successContainer.style.display = 'block';
          
          // å»¶è¿Ÿåˆ‡æ¢åˆ°ç™»å½•è¡¨å•
          setTimeout(() => {
            registerForm.style.display = 'none';
            loginForm.style.display = 'block';
            registerTitle.style.display = 'none';
            loginTitle.style.display = 'block';
            successContainer.style.display = 'none';
            
            // é¢„å¡«å……é‚®ç®±
            loginEmailInput.value = email;
          }, 1500);
        } else {
          throw new Error('ApiConfigæœªåˆå§‹åŒ–');
        }
      } catch (error) {
        // å¯ç”¨æ³¨å†ŒæŒ‰é’®
        registerBtn.disabled = false;
        registerBtn.style.opacity = '1';
        registerBtn.textContent = 'æ³¨å†Œ';
        
        // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
        errorMessage.textContent = error.message || 'æ³¨å†Œå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•';
        errorContainer.style.display = 'block';
      }
    });
    
    // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
    authModal.addEventListener('click', (e) => {
      if (e.target === authModal) {
        document.body.removeChild(authModal);
        document.body.style.overflow = ''; // æ¢å¤é¡µé¢æ»šåŠ¨
      }
    });
    
    // æŒ‰ESCé”®å…³é—­
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && document.body.contains(authModal)) {
        document.body.removeChild(authModal);
        document.body.style.overflow = ''; // æ¢å¤é¡µé¢æ»šåŠ¨
      }
    });
  } else {
    // å¦‚æœå·²å­˜åœ¨ï¼Œæ˜¾ç¤ºå®ƒ
    authModal.style.display = 'flex';
    document.body.style.overflow = 'hidden'; // é˜²æ­¢é¡µé¢æ»šåŠ¨
  }
}

// è·å–æ–‡ç« ç»Ÿè®¡ä¿¡æ¯å’Œè¯„è®ºæ•°
async function getArticleStats() {
  try {
    // æ£€æŸ¥APIæ˜¯å¦å¯ç”¨
    if (!window.ApiConfig || !window.ApiConfig.article) {
      console.error('APIé…ç½®ä¸å¯ç”¨');
      return;
    }
    
    // è·å–è¯„è®ºæ•°
    getCommentCount();
    
    // è·å–æ–‡ç« ç»Ÿè®¡ä¿¡æ¯
    const stats = await window.ApiConfig.article.getArticleStats(articleId);
    
    // æ›´æ–°ç‚¹èµæ•°
    const likeCounter = document.querySelector('#likeBtn .action-counter');
    if (likeCounter && stats && stats.likes) {
      likeCounter.textContent = stats.likes;
    }
  } catch (error) {
    console.error('è·å–æ–‡ç« ç»Ÿè®¡ä¿¡æ¯å¤±è´¥:', error);
  }
}

// è·å–è¯„è®ºæ•°
async function getCommentCount() {
  try {
    // æ£€æŸ¥APIæ˜¯å¦å¯ç”¨
    if (!window.ApiConfig || !window.ApiConfig.article) {
      console.error('APIé…ç½®ä¸å¯ç”¨');
      return;
    }
    
    // è°ƒç”¨APIè·å–è¯„è®ºï¼ˆåªè·å–ç¬¬ä¸€é¡µï¼Œä¸»è¦æ˜¯ä¸ºäº†æ‹¿åˆ°æ€»æ•°ï¼‰
    const comments = await window.ApiConfig.article.getComments(articleId, { page: 1, limit: 1 });
    
    // æ›´æ–°è¯„è®ºè®¡æ•°
    const commentCounter = document.querySelector('#commentBtn .action-counter');
    const commentSectionCounter = document.querySelector('.comment-count');
    
    if (comments && typeof comments.total !== 'undefined') {
      // æ›´æ–°åº•éƒ¨æ“ä½œæ çš„è¯„è®ºè®¡æ•°
      if (commentCounter) {
        commentCounter.textContent = comments.total;
      }
      
      // æ›´æ–°è¯„è®ºåŒºçš„è¯„è®ºè®¡æ•°
      if (commentSectionCounter) {
        commentSectionCounter.textContent = `(${comments.total})`;
      }
    }
  } catch (error) {
    console.error('è·å–è¯„è®ºæ•°å¤±è´¥:', error);
  }
}</script></body></html>