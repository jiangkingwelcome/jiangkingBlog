<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1,maximum-scale=2,viewport-fit=cover">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="renderer" content="webkit">
    <title>公告 - JiangKing博客</title>
    <meta name="description" content="类型为Notice的文章将被显示为公告">
    <meta name="keywords" content=", 公告, 博客, JiangKing">
    <meta name="author" content="JiangKing">
    <meta property="og:title" content="公告 - JiangKing博客">
    <meta property="og:description" content="类型为Notice的文章将被显示为公告">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://jiangking.com/blog/9b67d175-990e-4f9c-994d-ed159d9f0ae7.html">
    <meta property="article:published_time" content="2021-07-02">
    <meta property="article:author" content="JiangKing">
    <meta name="theme-color" content="#0f0f23">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="preload" href="/css/blog.css" as="style">
    <link rel="stylesheet" href="/css/blog.css">
    <link rel="stylesheet" href="/css/blog/comment-fixes.css">
    <script src="/js/api-config.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/blog.js"></script>
    <style>
      /* 赛博朋克风格变量 */
      :root {
        --primary: #6366f1;
        --primary-dark: #4f46e5;
        --secondary: #8b5cf6;
        --accent: #ec4899;
        --success: #10b981;
        --warning: #f59e0b;
        --danger: #ef4444;
        --dark: #0f0f23;
        --light: #f8fafc;
        --glass: rgba(255, 255, 255, 0.1);
        --glass-border: rgba(255, 255, 255, 0.2);
        --neon-glow: 0 0 20px rgba(99, 102, 241, 0.8);
        --text: #e2e8f0;
        --text-muted: rgba(226, 232, 240, 0.6);
      }
      
      /* 亮色模式变量 */
      .light-mode {
        --dark: #f8fafc;
        --light: #0f0f23;
        --text: #1e293b;
        --text-muted: rgba(30, 41, 59, 0.7);
        --glass: rgba(0, 0, 0, 0.05);
        --glass-border: rgba(0, 0, 0, 0.1);
      }
      
      .light-mode .dynamic-bg {
        background: linear-gradient(45deg, #f8fafc, #e2e8f0, #f8fafc);
      }
      
      .light-mode .grid-bg {
        background-image: 
          linear-gradient(rgba(99, 102, 241, 0.1) 1px, transparent 1px),
          linear-gradient(90deg, rgba(99, 102, 241, 0.1) 1px, transparent 1px);
      }
      
      /* 按钮激活状态样式 */
      .action-btn.active {
        color: var(--accent);
        background: rgba(99, 102, 241, 0.2);
        box-shadow: 0 0 10px rgba(99, 102, 241, 0.4);
        transform: translateY(-3px);
      }
      
      /* 收藏按钮动画 */
      .bookmark-animation {
        animation: bookmark-pulse 0.5s ease-out;
      }
      
      @keyframes bookmark-pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.3); }
        100% { transform: scale(1); }
      }
      
      body {
        font-family: 'Helvetica Neue', 'Microsoft Yahei', -apple-system, sans-serif;
        background: var(--dark);
        color: var(--text);
        line-height: 1.6;
        margin: 0;
        padding: 0;
      }
      
      /* 动态背景 */
      .dynamic-bg {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -2;
        background: linear-gradient(45deg, #0f0f23, #1a1a3e, #0f0f23);
        background-size: 400% 400%;
        animation: gradientShift 15s ease infinite;
      }
      
      @keyframes gradientShift {
        0% { background-position: 0% 50%; }
        50% { background-position: 100% 50%; }
        100% { background-position: 0% 50%; }
      }
      
      /* 网格背景 */
      .grid-bg {
        position: fixed;
        width: 100%;
        height: 100%;
        top: 0;
        left: 0;
        z-index: -1;
        background-image: 
          linear-gradient(rgba(99, 102, 241, 0.1) 1px, transparent 1px),
          linear-gradient(90deg, rgba(99, 102, 241, 0.1) 1px, transparent 1px);
        background-size: 50px 50px;
      }
      
      /* 鼠标跟随光效 */
      .cursor-glow {
        position: fixed;
        width: 400px;
        height: 400px;
        border-radius: 50%;
        background: radial-gradient(circle, rgba(99, 102, 241, 0.1) 0%, transparent 70%);
        pointer-events: none;
        transform: translate(-50%, -50%);
        z-index: -1;
        transition: opacity 0.3s;
      }
      
      /* 进度条 */
      .progress-bar {
        position: fixed;
        top: 0;
        left: 0;
        height: 3px;
        background: linear-gradient(90deg, var(--primary), var(--accent));
        z-index: 1000;
        width: 0%;
        transition: width 0.2s;
      }
      
      .image-container {
        margin: 20px 0;
        text-align: center;
        position: relative;
      }
      
      .image-container img {
        max-width: 100%;
        min-height: 150px;
        border-radius: 8px;
        box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        border: 1px solid var(--glass-border);
        transition: transform 0.3s ease, box-shadow 0.3s ease;
      }
      
      .image-container img:hover {
        transform: translateY(-5px);
        box-shadow: 0 15px 30px rgba(99, 102, 241, 0.4);
      }
      
      /* 特殊样式用于SVG图片 */
      .image-container img.svg-image {
        background-color: rgba(255, 255, 255, 0.05);
        padding: 10px;
        border: 1px solid rgba(99, 102, 241, 0.3);
      }
      
      .image-container img.error {
        border: 1px dashed var(--danger);
        background-color: rgba(239, 68, 68, 0.1);
      }
      
      /* 顶部导航 */
      .top-nav {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
        background: rgba(15, 15, 35, 0.8);
        backdrop-filter: blur(10px);
        z-index: 100;
        border-bottom: 1px solid var(--glass-border);
      }
      
      .nav-left {
        display: flex;
        align-items: center;
        gap: 15px;
      }
      
      .back-btn {
        color: var(--text);
        text-decoration: none;
        font-size: 1.5rem;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        background: rgba(99, 102, 241, 0.2);
        border: 1px solid rgba(99, 102, 241, 0.3);
        transition: all 0.3s;
      }
      
      .back-btn:hover {
        background: rgba(99, 102, 241, 0.4);
        transform: scale(1.1);
      }
      
      .site-title {
        font-size: 1.2rem;
        margin: 0;
        background: linear-gradient(135deg, var(--primary) 0%, var(--accent) 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }
      
      .nav-right {
        display: flex;
        gap: 10px;
      }
      
      .nav-btn {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid var(--glass-border);
        border-radius: 8px;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s;
        font-size: 1.2rem;
      }
      
      .nav-btn:hover {
        background: rgba(99, 102, 241, 0.2);
        transform: translateY(-2px);
      }
      
      /* 用户区域样式 */
      .user-area-container {
        display: flex;
        align-items: center;
        margin-right: 15px;
      }
      
      .user-area-guest {
        display: flex;
        gap: 10px;
      }
      
      .login-btn, .register-btn {
        padding: 8px 15px;
        border-radius: 6px;
        border: none;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.3s;
      }
      
      .login-btn {
        background: transparent;
        color: var(--text);
        border: 1px solid var(--glass-border);
      }
      
      .login-btn:hover {
        background: rgba(255, 255, 255, 0.1);
        transform: translateY(-2px);
      }
      
      .register-btn {
        background: linear-gradient(135deg, var(--primary), var(--primary-dark));
        color: white;
        box-shadow: 0 4px 10px rgba(99, 102, 241, 0.3);
      }
      
      .register-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 15px rgba(99, 102, 241, 0.4);
      }
      
      .user-area-user {
        position: relative;
      }
      
      .hidden {
        display: none !important;
      }
      
      .user-dropdown {
        position: relative;
      }
      
      .user-info {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 5px 10px;
        border-radius: 20px;
        background: rgba(99, 102, 241, 0.1);
        border: 1px solid rgba(99, 102, 241, 0.2);
        cursor: pointer;
        transition: all 0.3s;
      }
      
      .user-info:hover {
        background: rgba(99, 102, 241, 0.2);
        transform: translateY(-2px);
      }
      
      .avatar-placeholder {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background: linear-gradient(135deg, var(--primary), var(--secondary));
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 1rem;
      }
      
      .user-avatar {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        object-fit: cover;
      }
      
      .username {
        font-size: 0.9rem;
        color: var(--text);
      }
      
      .dropdown-menu {
        position: absolute;
        top: 100%;
        right: 0;
        width: 200px;
        background: rgba(15, 15, 35, 0.9);
        backdrop-filter: blur(10px);
        border-radius: 8px;
        border: 1px solid var(--glass-border);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        margin-top: 10px;
        opacity: 0;
        visibility: hidden;
        transform: translateY(-10px);
        transition: all 0.3s;
        z-index: 100;
      }
      
      .dropdown-menu.show {
        opacity: 1;
        visibility: visible;
        transform: translateY(0);
      }
      
      .dropdown-arrow {
        position: absolute;
        top: -8px;
        right: 20px;
        width: 16px;
        height: 16px;
        background: rgba(15, 15, 35, 0.9);
        transform: rotate(45deg);
        border-top: 1px solid var(--glass-border);
        border-left: 1px solid var(--glass-border);
      }
      
      .dropdown-list {
        list-style: none;
        padding: 10px 0;
      }
      
      .dropdown-item {
        padding: 0;
      }
      
      .dropdown-link {
        display: block;
        padding: 10px 15px;
        color: var(--text);
        text-decoration: none;
        transition: all 0.2s;
      }
      
      .dropdown-link:hover {
        background: rgba(99, 102, 241, 0.1);
        color: var(--primary);
      }
      
      .divider {
        border-top: 1px solid var(--glass-border);
        margin: 5px 0;
      }
      
      .logout-btn {
        width: 100%;
        text-align: left;
        padding: 10px 15px;
        background: transparent;
        border: none;
        color: var(--danger);
        cursor: pointer;
        transition: all 0.2s;
      }
      
      .logout-btn:hover {
        background: rgba(239, 68, 68, 0.1);
      }
      
      /* 图标样式 */
      .icon {
        font-family: 'Material Icons';
        font-weight: normal;
        font-style: normal;
        font-size: 24px;
        line-height: 1;
        letter-spacing: normal;
        text-transform: none;
        display: inline-block;
        white-space: nowrap;
        word-wrap: normal;
        direction: ltr;
        -webkit-font-feature-settings: 'liga';
        -webkit-font-smoothing: antialiased;
      }
      
      .icon-user:before {
        content: '👤';
      }
      
      /* 文章头部 */
      .article-header {
        position: relative;
        padding: 120px 40px 60px;
        overflow: hidden;
        background: linear-gradient(to bottom, rgba(15, 15, 35, 0) 0%, var(--dark) 100%);
      }
      
      .header-bg {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: -1;
        opacity: 0.4;
      }
      
      .header-content {
        position: relative;
        z-index: 1;
        max-width: 900px;
        margin: 0 auto;
      }
      
      .article-title {
        font-size: 2.5rem;
        margin-bottom: 20px;
        color: var(--text);
        font-weight: 800;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
        animation: glow 2s ease-in-out infinite alternate;
      }
      
      @keyframes glow {
        from { text-shadow: 0 0 5px rgba(99, 102, 241, 0.5); }
        to { text-shadow: 0 0 15px rgba(99, 102, 241, 0.8), 0 0 25px rgba(236, 72, 153, 0.6); }
      }
      
      .article-meta {
        display: flex;
        gap: 20px;
        flex-wrap: wrap;
        color: var(--text-muted);
        margin-bottom: 20px;
      }
      
      .meta-item {
        display: flex;
        align-items: center;
        gap: 5px;
        font-size: 0.9rem;
      }
      
      .meta-icon {
        font-size: 1rem;
      }
      
      /* 文章容器 */
      .article-container {
        max-width: 900px;
        margin: 0 auto;
        padding: 30px 40px;
        background: rgba(15, 15, 35, 0.5);
        backdrop-filter: blur(10px);
        border: 1px solid var(--glass-border);
        border-radius: 16px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      }
      
      .article-content {
        color: var(--text);
        font-size: 1.1rem;
        line-height: 1.8;
      }
      
      /* 文章内容风格 */
      .article-content h1,
      .article-content h2,
      .article-content h3,
      .article-content h4,
      .article-content h5,
      .article-content h6 {
        margin-top: 1.5em;
        margin-bottom: 0.8em;
        color: #fff;
      }
      
      .article-content h2 {
        font-size: 1.8rem;
        border-bottom: 2px solid rgba(99, 102, 241, 0.3);
        padding-bottom: 10px;
      }
      
      .article-content h3 {
        font-size: 1.5rem;
        color: var(--primary);
      }
      
      .article-content p {
        margin: 1.2em 0;
      }
      
      .article-content a {
        color: var(--secondary);
        text-decoration: none;
        border-bottom: 1px dashed rgba(139, 92, 246, 0.5);
        transition: all 0.2s;
      }
      
      .article-content a:hover {
        color: var(--accent);
        border-color: var(--accent);
      }
      
      .article-content blockquote {
        border-left: 4px solid var(--secondary);
        padding-left: 20px;
        margin-left: 0;
        color: var(--text-muted);
        font-style: italic;
      }
      
      .article-content code {
        font-family: Monaco, Consolas, 'Courier New', monospace;
        background: rgba(15, 15, 35, 0.6);
        padding: 3px 6px;
        border-radius: 4px;
        font-size: 0.9em;
        border: 1px solid rgba(99, 102, 241, 0.2);
        color: var(--accent);
      }
      
      .article-content pre {
        background: rgba(15, 15, 35, 0.8);
        padding: 20px;
        border-radius: 8px;
        overflow-x: auto;
        border: 1px solid var(--primary-dark);
        box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.5);
      }
      
      .article-content pre code {
        background: none;
        padding: 0;
        border: none;
        color: var(--text);
      }
      
      /* 文章标签 */
      .article-tags {
        margin-top: 40px;
        padding-top: 20px;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }
      
      .tag {
        padding: 6px 16px;
        background: rgba(99, 102, 241, 0.2);
        border: 1px solid var(--primary);
        border-radius: 20px;
        font-size: 13px;
        color: var(--primary);
        transition: all 0.3s;
        text-decoration: none;
        display: flex;
        align-items: center;
        position: relative;
        overflow: hidden;
      }
      
      .tag:hover {
        background: var(--primary);
        color: #fff;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(99, 102, 241, 0.4);
      }
      
      /* 作者信息 */
      .author-info {
        margin-top: 40px;
        padding: 20px;
        background: rgba(99, 102, 241, 0.1);
        border: 1px solid rgba(99, 102, 241, 0.2);
        border-radius: 16px;
        display: flex;
        align-items: center;
        gap: 20px;
      }
      
      .author-avatar {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        overflow: hidden;
        border: 2px solid var(--primary);
        box-shadow: 0 0 15px rgba(99, 102, 241, 0.5);
      }
      
      .author-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      
      .author-details h4 {
        margin: 0 0 5px;
        font-size: 1.2rem;
        color: #fff;
      }
      
      .author-bio {
        color: var(--text-muted);
        margin: 0;
        font-size: 0.9rem;
      }
      
      
      
      /* 移动端优化样式 */
      @media (max-width: 768px) {
        .article-header {
          padding: 80px 15px 30px;
        }
        
        .article-title {
          font-size: 1.8rem;
          line-height: 1.3;
        }
        
        .article-meta {
          flex-wrap: wrap;
          gap: 8px;
        }
        
        .article-container {
          padding: 20px 15px;
          margin: 0 10px;
          border-radius: 12px;
        }
        
        .author-info {
          flex-direction: column;
          text-align: center;
          padding: 15px;
        }
      }
      
      /* 底部操作栏 */
      .article-actions {
        position: fixed;
        bottom: 30px;
        left: 50%;
        transform: translateX(-50%);
        display: flex;
        align-items: center;
        gap: 15px;
        background: rgba(15, 15, 35, 0.8);
        border: 1px solid var(--glass-border);
        backdrop-filter: blur(10px);
        padding: 12px 25px;
        border-radius: 50px;
        box-shadow: 0 5px 25px rgba(0, 0, 0, 0.3);
        z-index: 90;
      }
      
      .action-btn {
        background: none;
        border: none;
        color: var(--text);
        font-size: 1.2rem;
        cursor: pointer;
        width: 40px;
        height: 40px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        transition: all 0.2s;
      }
      
      .action-btn:hover {
        background: rgba(99, 102, 241, 0.2);
        transform: translateY(-3px);
      }
      
      .action-divider {
        width: 1px;
        height: 25px;
        background: var(--glass-border);
      }
      
      /* 目录导航已删除 */
      
      /* 评论区样式 */
      .comments-section {
        margin-top: 50px;
        padding: 30px 0;
        border-top: 1px solid rgba(255, 255, 255, 0.1);
        display: none; /* 默认隐藏 */
      }
      
      .comments-section.active {
        display: block;
      }
      
      .comments-container {
        max-width: 800px;
        margin: 0 auto;
      }
      
      .comments-title {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 20px;
        font-size: 1.5rem;
        color: #fff;
      }
      
      .comment-count {
        font-size: 1rem;
        color: var(--text-muted);
      }
      
      .comment-form-container {
        display: flex;
        gap: 15px;
        margin-bottom: 30px;
      }
      
      .comment-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        overflow: hidden;
        flex-shrink: 0;
        border: 1px solid var(--glass-border);
      }
      
      .comment-avatar img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }
      
      .comment-form {
        flex: 1;
        display: flex;
        flex-direction: column;
      }
      
      .comment-input {
        width: 100%;
        padding: 12px 15px;
        border-radius: 8px;
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid var(--glass-border);
        color: var(--text);
        resize: vertical;
        font-family: inherit;
        font-size: 0.95rem;
        margin-bottom: 10px;
        transition: border-color 0.3s;
      }
      
      .comment-input:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.2);
      }
      
      .comment-form-actions {
        display: flex;
        justify-content: flex-end;
        gap: 10px;
      }
      
      .comment-cancel-btn,
      .comment-submit-btn {
        padding: 8px 16px;
        border-radius: 6px;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.2s;
      }
      
      .comment-cancel-btn {
        background: transparent;
        border: 1px solid var(--glass-border);
        color: var(--text-muted);
      }
      
      .comment-cancel-btn:hover {
        background: rgba(255, 255, 255, 0.05);
      }
      
      .comment-submit-btn {
        background: var(--primary);
        border: none;
        color: white;
      }
      
      .comment-submit-btn:hover {
        background: var(--primary-dark);
        transform: translateY(-2px);
      }
      
      .comment-submit-btn:disabled {
        background: rgba(99, 102, 241, 0.5);
        cursor: not-allowed;
        transform: none;
      }
      
      .comments-list {
        margin-bottom: 20px;
      }
      
      .comment-item {
        display: flex;
        gap: 15px;
        margin-bottom: 25px;
        position: relative;
      }
      
      .comment-content {
        flex: 1;
      }
      
      .comment-header {
        display: flex;
        justify-content: space-between;
        margin-bottom: 5px;
      }
      
      .comment-author {
        font-weight: 600;
        color: #fff;
      }
      
      .comment-date {
        font-size: 0.85rem;
        color: var(--text-muted);
      }
      
      .comment-text {
        color: var(--text);
        line-height: 1.6;
        margin-bottom: 8px;
      }
      
      .comment-actions {
        display: flex;
        gap: 15px;
      }
      
      .comment-action {
        font-size: 0.85rem;
        color: var(--text-muted);
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 5px;
        transition: color 0.2s;
      }
      
      .comment-action:hover {
        color: var(--primary);
      }
      
      .load-more-comments {
        text-align: center;
      }
      
      .load-more-btn {
        background: rgba(99, 102, 241, 0.1);
        border: 1px solid rgba(99, 102, 241, 0.3);
        color: var(--primary);
        padding: 8px 20px;
        border-radius: 20px;
        font-size: 0.9rem;
        cursor: pointer;
        transition: all 0.2s;
      }
      
      .load-more-btn:hover {
        background: rgba(99, 102, 241, 0.2);
        transform: translateY(-2px);
      }
      
      /* 评论回复样式 */
      .comment-replies {
        margin-left: 55px;
        margin-top: 15px;
      }
      
      .reply-form {
        margin-left: 55px;
        margin-top: 10px;
        display: none;
      }
      
      .reply-form.active {
        display: flex;
      }
      
      /* 移动端适配 */
      @media (max-width: 768px) {
        .comment-form-container {
          flex-direction: column;
          gap: 10px;
        }
        
        .comment-avatar {
          align-self: flex-start;
        }
        
        .comment-replies {
          margin-left: 20px;
        }
        
        .reply-form {
          margin-left: 20px;
        }
      }
      
      @media (max-width: 768px) {
        .article-actions {
          padding: 8px 15px;
          bottom: 15px;
        }
        
        .action-btn {
          width: 36px;
          height: 36px;
        }
      }
      
      /* 隐藏语言切换器 */
      .language-switcher {
        display: none !important;
      }
    </style>
  </head>
  <body>
    <div class="dynamic-bg"></div>
    <div class="grid-bg"></div>
    <div class="cursor-glow" id="cursorGlow"></div>
    <div class="progress-bar" id="progressBar"></div>
    <header class="top-nav" role="banner">
      <div class="nav-left"><a class="back-btn" href="/blog/" title="返回首页" aria-label="返回博客首页">←</a>
        <h3 class="site-title">JiangKing</h3>
      </div>
      <div class="nav-right">
        <!-- 用户区域-->
        <div class="user-area-container">
          <!-- 未登录状态-->
          <div class="user-area-guest" id="guestArea">
            <button class="login-btn" id="loginBtn" type="button">登录</button>
            <button class="register-btn" id="registerBtn" type="button">注册</button>
          </div>
          <!-- 已登录状态-->
          <div class="user-area-user hidden" id="userArea">
            <div class="user-dropdown">
              <div class="user-info">
                <div class="avatar-placeholder"><i class="icon icon-user"></i></div><span class="username" id="usernameDisplay">用户名</span>
              </div>
              <div class="dropdown-menu hidden" id="userDropdown">
                <div class="dropdown-arrow"></div>
                <ul class="dropdown-list">
                  <li class="dropdown-item"><a class="dropdown-link" href="/user/profile">个人中心</a></li>
                  <li class="dropdown-item"><a class="dropdown-link" href="/user/favorites">我的收藏</a></li>
                  <li class="dropdown-item"><a class="dropdown-link" href="/user/settings">账号设置</a></li>
                  <li class="dropdown-item divider"></li>
                  <li class="dropdown-item">
                    <button class="logout-btn" id="logoutBtn" type="button">退出登录</button>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
        <button class="nav-btn" title="暗色模式" aria-label="切换暗色模式">🌙</button>
      </div>
    </header>
    <section class="article-header">
      <div class="header-bg">
        <canvas id="headerCanvas"></canvas>
      </div>
      <div class="header-content">
        <h1 class="article-title" itemprop="headline">公告</h1>
        <div class="article-meta"><span class="meta-item"><span class="meta-icon">👤</span><span itemprop="author">JiangKing</span></span><span class="meta-item"><span class="meta-icon">📅</span>
            <time itemprop="datePublished" datetime="2021-07-02">2021-07-02</time></span><span class="meta-item"><span class="meta-icon">⏱️</span><span>1 min read</span></span><span class="meta-item"><span class="meta-icon">👁️</span><span>1.2k</span></span></div>
      </div>
    </section>
    <article class="article-container" itemscope itemtype="https://schema.org/BlogPosting">
      <meta itemprop="headline" content="公告">
      <meta itemprop="author" content="JiangKing">
      <meta itemprop="datePublished" content="2021-07-02">
      <div class="article-content" itemprop="articleBody"><p><strong>🎉欢迎你的到来，你的阅读就是对我最大的支持🎉</strong></p><p></p><p></p></div>
      <section class="article-tags" role="contentinfo" aria-label="文章标签">
      </section>
      <section class="author-info" itemscope itemtype="https://schema.org/Person">
        <div class="author-avatar"><img src="/assets/avatar.jpg" alt="JiangKing" itemprop="image" loading="lazy"></div>
        <div class="author-details">
          <h4 itemprop="name">JiangKing</h4>
          <p class="author-bio" itemprop="description">STDIN | Think >> /dev/Mind✨ - 专注于技术分享与思考</p>
        </div>
      </section>
    </article>
    <div class="article-actions" role="toolbar" aria-label="文章操作">
      <button class="action-btn" id="likeBtn" title="点赞" aria-label="点赞文章">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"></path>
        </svg><span class="action-counter">0</span>
      </button>
      <button class="action-btn" id="commentBtn" title="评论" aria-label="查看或发表评论">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
          <path d="M21 6h-2v9H6v2c0 .55.45 1 1 1h11l4 4V7c0-.55-.45-1-1-1zm-4 6V3c0-.55-.45-1-1-1H3c-.55 0-1 .45-1 1v14l4-4h10c.55 0 1-.45 1-1z"></path>
        </svg><span class="action-counter">0</span>
      </button>
      <div class="action-divider"></div>
      <button class="action-btn" id="shareBtn" title="分享" aria-label="分享文章">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
          <path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9c-1.66 0-3 1.34-3 3s1.34 3 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.16c-.05.21-.08.43-.08.65 0 1.61 1.31 2.92 2.92 2.92s2.92-1.31 2.92-2.92-1.31-2.92-2.92-2.92z"></path>
        </svg>
      </button>
      <button class="action-btn" id="topBtn" title="回到顶部" aria-label="回到页面顶部">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor">
          <path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6 1.41 1.41z"></path>
        </svg>
      </button>
    </div>
    <section class="comments-section" id="commentsSection" role="region" aria-label="评论区">
      <div class="comments-container">
        <h3 class="comments-title"> <span>评论</span><span class="comment-count">(0)</span></h3>
        <div class="comment-form-container">
          <div class="comment-avatar"><img id="commentUserAvatar" src="/assets/placeholder-image.svg" alt="用户头像"></div>
          <form class="comment-form" id="commentForm">
            <textarea class="comment-input" id="commentInput" placeholder="写下你的评论..." rows="3" required></textarea>
            <div class="comment-form-actions">
              <button class="comment-cancel-btn" id="commentCancelBtn" type="button">取消</button>
              <button class="comment-submit-btn" id="commentSubmitBtn" type="submit">发布评论</button>
            </div>
          </form>
        </div>
        <div class="comments-list" id="commentsList"></div>
        <div class="load-more-comments">
          <button class="load-more-btn" id="loadMoreCommentsBtn" type="button">加载更多评论</button>
        </div>
      </div>
    </section>
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "BlogPosting",
        "headline": "公告",
        "datePublished": "2021-07-02",
        "dateModified": "2021-07-02",
        "author": {
          "@type": "Person",
          "name": "JiangKing"
        },
        "publisher": {
          "@type": "Organization",
          "name": "JiangKing博客",
          "logo": {
            "@type": "ImageObject",
            "url": "https://jiangking.com/assets/avatar.jpg"
          }
        },
        "description": "类型为Notice的文章将被显示为公告",
        "mainEntityOfPage": {
          "@type": "WebPage",
          "@id": "https://jiangking.com/blog/9b67d175-990e-4f9c-994d-ed159d9f0ae7.html"
        }
      }
      
    </script>
    <script>
      // 页面加载完成后执行
      document.addEventListener('DOMContentLoaded', function() {
        // 初始化用户界面
        initUserInterface();
        
        // 获取文章统计信息和评论数
        getArticleStats();
        
        // 初始化用户界面
        function initUserInterface() {
          // 检查用户是否登录
          if (window.ApiConfig && window.ApiConfig.user) {
            const isLoggedIn = window.ApiConfig.user.isLoggedIn();
            const guestArea = document.getElementById('guestArea');
            const userArea = document.getElementById('userArea');
            const usernameDisplay = document.getElementById('usernameDisplay');
            const userDropdown = document.getElementById('userDropdown');
            const userInfo = document.querySelector('.user-info');
            const loginBtn = document.getElementById('loginBtn');
            const registerBtn = document.getElementById('registerBtn');
            const logoutBtn = document.getElementById('logoutBtn');
            
            if (isLoggedIn) {
              // 已登录状态
              if (guestArea) guestArea.classList.add('hidden');
              if (userArea) userArea.classList.remove('hidden');
              
              // 显示用户名
              const user = window.ApiConfig.user.getCurrentUserFromStorage();
              if (user && usernameDisplay) {
                usernameDisplay.textContent = user.username;
              }
              
              // 绑定用户下拉菜单事件
              if (userInfo) {
                userInfo.addEventListener('click', function() {
                  if (userDropdown) {
                    userDropdown.classList.toggle('show');
                  }
                });
              }
              
              // 绑定登出事件
              if (logoutBtn) {
                logoutBtn.addEventListener('click', function() {
                  window.ApiConfig.user.logout().then(() => {
                    window.location.reload();
                  });
                });
              }
            } else {
              // 未登录状态
              if (guestArea) guestArea.classList.remove('hidden');
              if (userArea) userArea.classList.add('hidden');
              
              // 绑定登录按钮事件
              if (loginBtn) {
                loginBtn.addEventListener('click', function() {
                  showLoginModal();
                });
              }
              
              // 绑定注册按钮事件
              if (registerBtn) {
                registerBtn.addEventListener('click', function() {
                  showLoginModal();
                  // 切换到注册表单
                  const authModal = document.getElementById('inline-auth-modal');
                  if (authModal) {
                    const loginForm = authModal.querySelector('#inline-login-form');
                    const registerForm = authModal.querySelector('#inline-register-form');
                    const loginTitle = authModal.querySelector('#inline-login-title');
                    const registerTitle = authModal.querySelector('#inline-register-title');
                    
                    if (loginForm) loginForm.style.display = 'none';
                    if (registerForm) registerForm.style.display = 'block';
                    if (loginTitle) loginTitle.style.display = 'none';
                    if (registerTitle) registerTitle.style.display = 'block';
                  }
                });
              }
            }
            
            // 点击外部关闭用户下拉菜单
            document.addEventListener('click', function(e) {
              if (userDropdown && userDropdown.classList.contains('show')) {
                if (!e.target.closest('.user-dropdown')) {
                  userDropdown.classList.remove('show');
                }
              }
            });
          }
        }
        console.log('开始处理图片显示问题');
        
        // 检测浏览器是否支持webp格式
        function checkWebpSupport() {
          const canvas = document.createElement('canvas');
          if (!canvas.getContext || !canvas.getContext('2d')) {
            return false;
          }
          
          return canvas.toDataURL('image/webp').indexOf('data:image/webp') === 0;
        }
        
        const supportsWebp = checkWebpSupport();
        console.log('浏览器支持webp格式:', supportsWebp);
      
        // 1. 处理直接显示为文本的图片URL (657bf33bfbf478066fd24f11b0eb95f7.webp)
        const allElements = document.querySelectorAll('.article-content *');
        allElements.forEach(el => {
          // 检查是否为纯文本元素且文本内容像图片URL
          const content = el.textContent ? el.textContent.trim() : '';
          if (content && (
              content.match(/[a-f0-9]{32}\.webp$/i) ||
              content.match(/\.(webp|jpg|png|gif|jpeg)$/i)
            ) &&
            el.childNodes.length === 1 &&
            el.childNodes[0].nodeType === Node.TEXT_NODE) {
            
            console.log('找到可能是图片URL的文本:', content);
            
            // 创建图片容器和图片元素
            const imgContainer = document.createElement('div');
            imgContainer.className = 'image-container';
            
            const img = document.createElement('img');
            
            // 尝试构造正确的图片路径
            if (content.startsWith('/')) {
              // 已经是相对路径
              img.src = content;
            } else if (content.match(/[a-f0-9]{32}\.webp$/i) || content.endsWith('.webp')) {
              // 看起来像是在当前文章目录下的webp图片
              const articleId = window.location.pathname.split('/').pop().replace('.html', '');
              img.src = `/blog/images/${articleId}/${content}`;
            } else {
              // 默认使用占位图
              img.src = '/assets/placeholder-image.svg';
            }
            
            // 添加错误处理
            img.alt = '文章图片';
            img.setAttribute('data-original-text', content);
            img.onerror = function() {
              this.onerror = null;
              this.src = '/assets/placeholder-image.svg';
              this.classList.add('error');
            };
            
            imgContainer.appendChild(img);
            
            // 替换元素
            el.parentNode.replaceChild(imgContainer, el);
          }
        });
        
        // 2. 检查图片容器内容
        const imageContainers = document.querySelectorAll('.image-container');
        console.log('找到图片容器:', imageContainers.length);
        
        imageContainers.forEach((container) => {
          // 检查容器是否只有文本内容
          if (!container.querySelector('img') && container.textContent.trim()) {
            const content = container.textContent.trim();
            console.log('图片容器内只有文本:', content);
            
            // 清空容器
            container.innerHTML = '';
            
            // 创建图片元素
            const img = document.createElement('img');
            
            // 尝试构造正确的图片路径
            if (content.match(/[a-f0-9]{32}\.webp$/i) || content.endsWith('.webp')) {
              // webp图片
              const articleId = window.location.pathname.split('/').pop().replace('.html', '');
              img.src = `/blog/images/${articleId}/${content}`;
            } else {
              // 使用占位图
              img.src = '/assets/placeholder-image.svg';
            }
            
            // 添加错误处理
            img.alt = '文章图片';
            img.setAttribute('data-text-content', content);
            img.onerror = function() {
              this.onerror = null;
              this.src = '/assets/placeholder-image.svg';
              this.classList.add('error');
            };
            
            // 添加到容器
            container.appendChild(img);
          }
        });
        
        // 3. 处理所有图片加载错误
        const images = document.querySelectorAll('img');
        console.log('找到图片元素:', images.length);
        
        images.forEach((img) => {
          // 检查是否为SVG图片
          if (img.src.toLowerCase().endsWith('.svg')) {
            console.log('检测到SVG图片:', img.src);
            img.classList.add('svg-image');
            // SVG图片不需要错误处理
            return;
          }
          
          if (img.complete && img.naturalHeight === 0) {
            // 已经加载失败的图片
            console.log('图片已加载失败:', img.src);
            img.classList.add('error');
            
            // 如果不是占位图，则替换为占位图
            if (!img.src.includes('placeholder-image')) {
              img.setAttribute('data-failed-src', img.src);
              img.src = '/assets/placeholder-image.svg';
              img.classList.add('svg-image'); // 添加SVG类
            }
          } else {
            // 添加加载错误处理
            img.addEventListener('error', function() {
              console.log('图片加载失败:', this.src);
              this.classList.add('error');
              
              // 如果不是占位图，则替换为占位图
              if (!this.src.includes('placeholder-image')) {
                this.setAttribute('data-failed-src', this.src);
                this.src = '/assets/placeholder-image.svg';
                this.classList.add('svg-image'); // 添加SVG类
              }
            });
          }
        });
        
        // 鼠标跟随光效
        setupCursorGlow();
        
        // 目录功能已删除
        
        // 添加阅读进度条
        setupProgressBar();
        
        // 设置文章头部效果
        setupHeaderEffect();
        
        // 添加代码高亮
        highlightCodeBlocks();
        
        // 目录按钮已删除
        
        // 初始化右上角导航按钮功能
        const darkModeBtn = document.querySelector('.nav-btn[title="暗色模式"]');
        if (darkModeBtn) {
          darkModeBtn.addEventListener('click', function() {
            document.body.classList.toggle('light-mode');
            const isDarkMode = !document.body.classList.contains('light-mode');
            localStorage.setItem('darkMode', isDarkMode ? 'true' : 'false');
            this.innerHTML = isDarkMode ? '🌙' : '☀️';
          });
          
          // 从localStorage恢复暗色模式状态
          const isDarkMode = localStorage.getItem('darkMode') !== 'false';
          if (!isDarkMode) {
            document.body.classList.add('light-mode');
            darkModeBtn.innerHTML = '☀️';
          }
        }
        
        // 右上角分享按钮
        const navShareBtn = document.querySelector('.nav-btn[title="分享"]');
        if (navShareBtn) {
          navShareBtn.addEventListener('click', function() {
            if (navigator.share) {
              navigator.share({
                title: document.title,
                url: window.location.href,
                text: document.querySelector('meta[name="description"]')?.content || document.title
              }).catch(error => {
                console.log('分享失败:', error);
                showShareDialog();
              });
            } else {
              showShareDialog();
            }
          });
        }
        
        // 底部操作按钮功能
        setupActionButtons();
      });
      
      // 滚动到顶部
      function scrollToTop() {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      }
      
      // 设置鼠标跟随光效
      function setupCursorGlow() {
        const cursorGlow = document.getElementById('cursorGlow');
        if (!cursorGlow) return;
        
        let mouseX = 0, mouseY = 0;
        let currentX = 0, currentY = 0;
      
        document.addEventListener('mousemove', (e) => {
          mouseX = e.clientX;
          mouseY = e.clientY;
        });
      
        function animateCursor() {
          currentX += (mouseX - currentX) * 0.1;
          currentY += (mouseY - currentY) * 0.1;
          
          cursorGlow.style.left = currentX + 'px';
          cursorGlow.style.top = currentY + 'px';
          
          requestAnimationFrame(animateCursor);
        }
        animateCursor();
      }
      
      // 设置阅读进度条
      function setupProgressBar() {
        const progressBar = document.getElementById('progressBar');
        
        window.addEventListener('scroll', () => {
          const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
          const scrollHeight = document.documentElement.scrollHeight || document.body.scrollHeight;
          const clientHeight = document.documentElement.clientHeight || window.innerHeight;
          
          const scrollPercentage = (scrollTop / (scrollHeight - clientHeight)) * 100;
          progressBar.style.width = scrollPercentage + '%';
        });
      }
      
      // 目录功能已删除
      
      // 设置文章头部效果
      function setupHeaderEffect() {
        const canvas = document.getElementById('headerCanvas');
        if (!canvas) return;
        
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = 300;
        
        const particlesArray = [];
        
        // 创建粒子
        class Particle {
          constructor() {
            this.x = Math.random() * canvas.width;
            this.y = Math.random() * canvas.height;
            this.size = Math.random() * 2 + 0.5;
            this.speedX = Math.random() * 2 - 1;
            this.speedY = Math.random() * 2 - 1;
            this.color = `rgba(${99 + Math.random() * 30}, ${102 + Math.random() * 20}, ${241 + Math.random() * 14}, ${Math.random() * 0.5 + 0.2})`;
          }
          
          update() {
            this.x += this.speedX * 0.5;
            this.y += this.speedY * 0.5;
            
            if (this.size > 0.1) this.size -= 0.01;
            
            if (this.x < 0 || this.x > canvas.width) this.speedX *= -1;
            if (this.y < 0 || this.y > canvas.height) this.speedY *= -1;
          }
          
          draw() {
            ctx.fillStyle = this.color;
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
            ctx.fill();
          }
        }
        
        // 初始化粒子
        function init() {
          for (let i = 0; i < 100; i++) {
            particlesArray.push(new Particle());
          }
        }
        
        // 动画循环
        function animate() {
          ctx.clearRect(0, 0, canvas.width, canvas.height);
          
          for (let i = 0; i < particlesArray.length; i++) {
            particlesArray[i].update();
            particlesArray[i].draw();
          }
          
          requestAnimationFrame(animate);
        }
        
        init();
        animate();
      }
      
      // 代码高亮（简易版）
      function highlightCodeBlocks() {
        const codeBlocks = document.querySelectorAll('pre code');
        
        codeBlocks.forEach(block => {
          // 简单的语法高亮
          const text = block.innerHTML;
          
          // 高亮关键字
          const keywordsList = ['function', 'return', 'if', 'else', 'for', 'while', 'var', 'let', 'const', 'class', 'import', 'export', 'from', 'await', 'async', 'try', 'catch'];
          const keywords = new RegExp(`\\b(${keywordsList.join('|')})\\b`, 'g');
          
          // 高亮字符串
          const strings = /(".*?"|'.*?'|`.*?`)/g;
          
          // 高亮注释
          const comments = /(\/\/.*|\/\*[\s\S]*?\*\/)/g;
          
          // 应用高亮
          let highlighted = text
            .replace(comments, '<span style="color: #6b7280;">$1</span>')
            .replace(strings, '<span style="color: #ec4899;">$1</span>')
            .replace(keywords, '<span style="color: #8b5cf6;">$1</span>');
            
          block.innerHTML = highlighted;
        });
      }
      
      // 显示分享对话框
      function showShareDialog() {
        alert('已复制链接到剪贴板，快去分享吧！');
        // 复制链接
        const textArea = document.createElement('textarea');
        textArea.value = window.location.href;
        textArea.style.position = 'fixed';
        textArea.style.opacity = '0';
        document.body.appendChild(textArea);
        textArea.focus();
        textArea.select();
        
        try {
          document.execCommand('copy');
        } catch (err) {
          console.error('复制失败:', err);
        }
        
        document.body.removeChild(textArea);
      }
      
      // 在当前页面内实现功能按钮
      function setupActionButtons() {
        // 初始化评论功能
        initComments();
        
        // 显示消息提示
        function showToast(message) {
          let toast = document.getElementById('toast');
          if (!toast) {
            toast = document.createElement('div');
            toast.id = 'toast';
            toast.className = 'toast';
            toast.style.position = 'fixed';
            toast.style.bottom = '30px';
            toast.style.left = '50%';
            toast.style.transform = 'translateX(-50%)';
            toast.style.background = 'rgba(99, 102, 241, 0.9)';
            toast.style.color = 'white';
            toast.style.padding = '12px 20px';
            toast.style.borderRadius = '8px';
            toast.style.boxShadow = '0 4px 12px rgba(0, 0, 0, 0.2)';
            toast.style.transition = 'all 0.3s ease-in-out';
            toast.style.zIndex = '9999';
            toast.style.opacity = '0';
            document.body.appendChild(toast);
          }
          
          toast.textContent = message;
          toast.style.opacity = '1';
          
          setTimeout(() => {
            toast.style.opacity = '0';
          }, 3000);
        }
        
        // 从localStorage读取用户互动记录
        const userInteractions = JSON.parse(localStorage.getItem('blogInteractions') || '{}');
        const articleInteractions = userInteractions[articleId] || {
          liked: false,
          commentCount: 0,
          likeCount: 0
        };
        
        // 点赞功能
        const likeBtn = document.getElementById('likeBtn');
        if (likeBtn) {
          const likeCounter = likeBtn.querySelector('.action-counter');
          
          // 从服务器获取文章统计信息
          async function loadArticleStats() {
            try {
              // 使用ApiConfig获取文章统计信息
              if (!window.ApiConfig || !window.ApiConfig.article) {
                likeCounter.textContent = '0';
                return;
              }
              
              const data = await window.ApiConfig.article.getArticleStats(articleId);
              
              // 更新UI
              likeCounter.textContent = data.likeCount || 0;
              
              // 设置用户的点赞状态
              if (data.hasLiked) {
                likeBtn.classList.add('active');
                articleInteractions.liked = true;
              } else {
                likeBtn.classList.remove('active');
                articleInteractions.liked = false;
              }
              
              // 更新用户交互记录
              userInteractions[articleId] = articleInteractions;
              localStorage.setItem('blogInteractions', JSON.stringify(userInteractions));
            } catch (error) {
              console.error('加载文章统计信息失败:', error);
              likeCounter.textContent = '0';
            }
          }
          
          // 加载统计信息
          loadArticleStats();
          
          likeBtn.addEventListener('click', async function() {
            console.log('点赞按钮被点击');
            
            // 防止重复点击
            if (this.disabled) return;
            this.disabled = true;
            
            try {
              // 检查ApiConfig是否可用
              if (!window.ApiConfig || !window.ApiConfig.article) {
                console.error('ApiConfig未初始化或不可用');
                showToast('系统错误，请刷新页面重试');
                return;
              }
              
              // 检查用户是否已登录
              if (!window.ApiConfig.user.isLoggedIn()) {
                console.log('用户未登录，显示登录模态框');
                showToast('请先登录后再点赞');
                
                // 尝试显示登录模态框
                showLoginModal();
                return;
              }
              
              console.log('调用ApiConfig点赞接口, 文章ID:', articleId);
              
              // 调用ApiConfig的点赞方法
              const data = await window.ApiConfig.article.likeArticle(articleId);
              console.log('点赞接口返回数据:', data);
              
              // 根据服务器返回更新UI
              if (data.action === 'liked') {
                this.classList.add('active');
                articleInteractions.liked = true;
                showToast('感谢点赞 ❤️');
                
                // 点赞动画
                const heart = document.createElement('span');
                heart.innerHTML = '❤️';
                heart.style.position = 'absolute';
                heart.style.top = '50%';
                heart.style.left = '50%';
                heart.style.fontSize = '18px';
                heart.style.transform = 'translate(-50%, -50%)';
                heart.style.pointerEvents = 'none';
                heart.style.opacity = '1';
                heart.style.transition = 'all 0.5s';
                this.appendChild(heart);
                
                setTimeout(() => {
                  heart.style.opacity = '0';
                  heart.style.transform = 'translate(-50%, -100px)';
                  setTimeout(() => heart.remove(), 500);
                }, 50);
              } else if (data.action === 'unliked') {
                this.classList.remove('active');
                articleInteractions.liked = false;
                showToast('已取消点赞');
              }
              
              // 更新点赞数
              likeCounter.textContent = data.likeCount || 0;
              
              // 更新用户交互记录
              userInteractions[articleId] = articleInteractions;
              localStorage.setItem('blogInteractions', JSON.stringify(userInteractions));
              
            } catch (error) {
              console.error('点赞请求失败:', error);
              
              // 处理错误
              if (error.status === 401) {
                console.log('认证失败(401)，需要登录');
                showToast('请先登录后再点赞');
                
                // 尝试显示登录模态框
                showLoginModal();
              } else {
                showToast('操作失败，请稍后重试');
              }
            } finally {
              // 恢复按钮状态
              this.disabled = false;
            }
          });
        }
        
        // 收藏功能已移除
        
        // 评论功能
        const commentBtn = document.getElementById('commentBtn');
        if (commentBtn) {
          commentBtn.addEventListener('click', function() {
            toggleCommentSection();
          });
        }
        
        // 分享功能
        const shareBtn = document.getElementById('shareBtn');
        if (shareBtn) {
          console.log('找到分享按钮');
          shareBtn.addEventListener('click', function() {
            console.log('分享按钮被点击');
            if (navigator.share) {
              // 使用原生分享API
              navigator.share({
                title: document.title,
                url: window.location.href,
                text: document.querySelector('meta[name="description"]')?.content || document.title
              }).catch(error => {
                console.log('分享失败:', error);
                showShareDialog();
              });
            } else {
              // 降级为弹出式分享对话框
              showShareDialog();
            }
          });
        }
        
        // 回到顶部功能
        const topBtn = document.getElementById('topBtn');
        if (topBtn) {
          console.log('找到回到顶部按钮');
          topBtn.addEventListener('click', function() {
            console.log('回到顶部按钮被点击');
            window.scrollTo({ top: 0, behavior: 'smooth' });
          });
        }
      }
      
      // 获取当前文章ID（全局变量）
      const articleId = window.location.pathname.split('/').pop().replace('.html', '');
      
      // 评论区功能
      function toggleCommentSection() {
        const commentsSection = document.getElementById('commentsSection');
        if (!commentsSection) return;
        
        commentsSection.classList.toggle('active');
        
        // 如果评论区被打开，则加载评论
        if (commentsSection.classList.contains('active')) {
          loadComments();
          
          // 滚动到评论区
          setTimeout(() => {
            commentsSection.scrollIntoView({ behavior: 'smooth' });
          }, 100);
        }
      }
      
      // 加载评论
      async function loadComments() {
        const commentsList = document.getElementById('commentsList');
        const commentCounter = document.querySelector('.comment-count');
        const loadMoreBtn = document.getElementById('loadMoreCommentsBtn');
        
        if (!commentsList) return;
        
        try {
          // 显示加载中状态
          commentsList.innerHTML = '<div class="loading-comments">加载评论中...</div>';
          
          // 检查API是否可用
          if (!window.ApiConfig || !window.ApiConfig.article) {
            commentsList.innerHTML = '<div class="no-comments">评论加载失败，请刷新页面重试</div>';
            return;
          }
          
          // 调用API获取评论
          const comments = await window.ApiConfig.article.getComments(articleId, { page: 1, limit: 10 });
          
          // 更新评论计数（只有在没有已显示的评论数时才更新）
          if (commentCounter && (!commentCounter.textContent || commentCounter.textContent === '(0)')) {
            commentCounter.textContent = `(${comments.total || 0})`;
          }
          
          // 如果没有更多评论，隐藏加载更多按钮
          if (loadMoreBtn) {
            loadMoreBtn.style.display = comments.hasMore ? 'inline-block' : 'none';
          }
          
          // 如果没有评论
          if (!comments.data || comments.data.length === 0) {
            commentsList.innerHTML = '<div class="no-comments">暂无评论，快来发表第一条评论吧！</div>';
            return;
          }
          
          // 渲染评论
          commentsList.innerHTML = '';
          comments.data.forEach(comment => {
            const commentElement = createCommentElement(comment);
            commentsList.appendChild(commentElement);
          });
        } catch (error) {
          console.error('加载评论失败:', error);
          commentsList.innerHTML = '<div class="no-comments">评论加载失败，请稍后重试</div>';
        }
      }
      
      // 创建评论元素
      function createCommentElement(comment) {
        const commentItem = document.createElement('div');
        commentItem.className = 'comment-item';
        commentItem.dataset.commentId = comment.id;
        
        // 格式化日期
        const commentDate = new Date(comment.createdAt);
        const formattedDate = commentDate.toLocaleDateString('zh-CN', {
          year: 'numeric',
          month: 'long',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });
        
        commentItem.innerHTML = `
          <div class="comment-avatar">
            <img src="${comment.user.avatar || '/assets/placeholder-image.svg'}" alt="${comment.user.username}" loading="lazy">
          </div>
          <div class="comment-content">
            <div class="comment-header">
              <span class="comment-author">${comment.user.username}</span>
              <span class="comment-date">${formattedDate}</span>
            </div>
            <div class="comment-text">${comment.content}</div>
            <div class="comment-actions">
              <button class="comment-action comment-like" data-comment-id="${comment.id}">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"></path>
                </svg>
                <span>${comment.likeCount || 0}</span>
              </button>
              <button class="comment-action comment-reply" data-comment-id="${comment.id}">
                <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M20 2H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h14l4 4V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"></path>
                </svg>
                回复
              </button>
            </div>
            ${comment.replies && comment.replies.length > 0 ? 
              `<div class="comment-replies">
                ${comment.replies.map(reply => `
                  <div class="comment-item reply-item" data-reply-id="${reply.id}">
                    <div class="comment-avatar">
                      <img src="${reply.user.avatar || '/assets/placeholder-image.svg'}" alt="${reply.user.username}" loading="lazy">
                    </div>
                    <div class="comment-content">
                      <div class="comment-header">
                        <span class="comment-author">${reply.user.username}</span>
                        <span class="comment-date">${new Date(reply.createdAt).toLocaleDateString('zh-CN', {
                          year: 'numeric',
                          month: 'long',
                          day: 'numeric',
                          hour: '2-digit',
                          minute: '2-digit'
                        })}</span>
                      </div>
                      <div class="comment-text">${reply.content}</div>
                      <div class="comment-actions">
                        <button class="comment-action comment-like" data-reply-id="${reply.id}">
                          <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"></path>
                          </svg>
                          <span>${reply.likeCount || 0}</span>
                        </button>
                      </div>
                    </div>
                  </div>
                `).join('')}
              </div>` : ''
            }
          </div>
        `;
        
        // 绑定评论点赞事件
        const likeBtn = commentItem.querySelector('.comment-like');
        if (likeBtn) {
          likeBtn.addEventListener('click', function() {
            likeComment(comment.id);
          });
        }
        
        // 绑定评论回复事件
        const replyBtn = commentItem.querySelector('.comment-reply');
        if (replyBtn) {
          replyBtn.addEventListener('click', function() {
            showReplyForm(comment.id);
          });
        }
        
        return commentItem;
      }
      
      // 初始化评论表单
      function initCommentForm() {
        const commentForm = document.getElementById('commentForm');
        const commentInput = document.getElementById('commentInput');
        const commentSubmitBtn = document.getElementById('commentSubmitBtn');
        const commentCancelBtn = document.getElementById('commentCancelBtn');
        const commentUserAvatar = document.getElementById('commentUserAvatar');
        
        if (!commentForm || !commentInput || !commentSubmitBtn || !commentCancelBtn) return;
        
        // 设置用户头像
        if (commentUserAvatar && window.ApiConfig && window.ApiConfig.user) {
          const user = window.ApiConfig.user.getCurrentUserFromStorage();
          if (user && user.avatar) {
            commentUserAvatar.src = user.avatar;
          }
        }
        
        // 监听输入变化，禁用/启用提交按钮
        commentInput.addEventListener('input', function() {
          commentSubmitBtn.disabled = !this.value.trim();
        });
        
        // 取消按钮点击事件
        commentCancelBtn.addEventListener('click', function() {
          commentInput.value = '';
          commentSubmitBtn.disabled = true;
        });
        
        // 提交评论
        commentForm.addEventListener('submit', async function(e) {
          e.preventDefault();
          
          const content = commentInput.value.trim();
          if (!content) return;
          
          // 禁用提交按钮
          commentSubmitBtn.disabled = true;
          commentSubmitBtn.textContent = '发布中...';
          
          try {
            // 检查用户是否已登录
            if (!window.ApiConfig || !window.ApiConfig.user || !window.ApiConfig.user.isLoggedIn()) {
              showToast('请先登录后再发表评论');
              showLoginModal();
              return;
            }
            
            // 调用API发表评论
            const response = await window.ApiConfig.article.addComment(articleId, { content });
            
            // 清空输入框
            commentInput.value = '';
            
            // 重新加载评论
            loadComments();
            
            // 显示成功提示
            showToast('评论发布成功');
          } catch (error) {
            console.error('发表评论失败:', error);
            
            // 处理错误
            if (error.status === 401) {
              showToast('请先登录后再发表评论');
              showLoginModal();
            } else {
              showToast('评论发布失败，请稍后重试');
            }
          } finally {
            // 恢复按钮状态
            commentSubmitBtn.disabled = false;
            commentSubmitBtn.textContent = '发布评论';
          }
        });
      }
      
      // 点赞评论
      async function likeComment(commentId) {
        try {
          // 检查用户是否已登录
          if (!window.ApiConfig || !window.ApiConfig.user || !window.ApiConfig.user.isLoggedIn()) {
            showToast('请先登录后再点赞');
            showLoginModal();
            return;
          }
          
          // 调用API点赞评论
          const response = await window.ApiConfig.article.likeComment(commentId);
          
          // 更新UI
          const likeBtn = document.querySelector(`.comment-like[data-comment-id="${commentId}"]`);
          if (likeBtn) {
            const likeCount = likeBtn.querySelector('span');
            if (likeCount) {
              likeCount.textContent = response.likeCount || 0;
            }
            
            // 根据点赞状态更新样式
            if (response.action === 'liked') {
              likeBtn.classList.add('active');
              showToast('点赞成功');
            } else {
              likeBtn.classList.remove('active');
              showToast('已取消点赞');
            }
          }
        } catch (error) {
          console.error('点赞评论失败:', error);
          
          // 处理错误
          if (error.status === 401) {
            showToast('请先登录后再点赞');
            showLoginModal();
          } else {
            showToast('操作失败，请稍后重试');
          }
        }
      }
      
      // 显示回复表单
      function showReplyForm(commentId) {
        // 检查用户是否已登录
        if (!window.ApiConfig || !window.ApiConfig.user || !window.ApiConfig.user.isLoggedIn()) {
          showToast('请先登录后再回复');
          showLoginModal();
          return;
        }
        
        const commentItem = document.querySelector(`.comment-item[data-comment-id="${commentId}"]`);
        if (!commentItem) return;
        
        // 检查是否已有回复表单
        let replyForm = commentItem.querySelector('.reply-form');
        
        // 如果没有回复表单，创建一个
        if (!replyForm) {
          const user = window.ApiConfig.user.getCurrentUserFromStorage();
          
          replyForm = document.createElement('div');
          replyForm.className = 'reply-form';
          replyForm.innerHTML = `
            <div class="comment-avatar">
              <img src="${user && user.avatar ? user.avatar : '/assets/placeholder-image.svg'}" alt="用户头像">
            </div>
            <form class="comment-form reply-comment-form">
              <textarea class="comment-input reply-input" placeholder="回复评论..." rows="2" required></textarea>
              <div class="comment-form-actions">
                <button type="button" class="comment-cancel-btn reply-cancel-btn">取消</button>
                <button type="submit" class="comment-submit-btn reply-submit-btn">回复</button>
              </div>
            </form>
          `;
          
          // 添加到评论项
          commentItem.appendChild(replyForm);
          
          // 绑定取消按钮事件
          const cancelBtn = replyForm.querySelector('.reply-cancel-btn');
          if (cancelBtn) {
            cancelBtn.addEventListener('click', function() {
              replyForm.classList.remove('active');
            });
          }
          
          // 绑定提交事件
          const form = replyForm.querySelector('form');
          if (form) {
            form.addEventListener('submit', async function(e) {
              e.preventDefault();
              
              const input = this.querySelector('.reply-input');
              const submitBtn = this.querySelector('.reply-submit-btn');
              
              if (!input || !submitBtn) return;
              
              const content = input.value.trim();
              if (!content) return;
              
              // 禁用提交按钮
              submitBtn.disabled = true;
              submitBtn.textContent = '回复中...';
              
              try {
                // 调用API回复评论
                const response = await window.ApiConfig.article.replyComment(commentId, { content });
                
                // 清空输入框
                input.value = '';
                
                // 隐藏回复表单
                replyForm.classList.remove('active');
                
                // 重新加载评论
                loadComments();
                
                // 显示成功提示
                showToast('回复成功');
              } catch (error) {
                console.error('回复评论失败:', error);
                showToast('回复失败，请稍后重试');
              } finally {
                // 恢复按钮状态
                submitBtn.disabled = false;
                submitBtn.textContent = '回复';
              }
            });
          }
        }
        
        // 显示回复表单
        replyForm.classList.toggle('active');
        
        // 聚焦输入框
        if (replyForm.classList.contains('active')) {
          const input = replyForm.querySelector('.reply-input');
          if (input) {
            setTimeout(() => input.focus(), 100);
          }
        }
      }
      
      // 初始化加载更多评论按钮
      function initLoadMoreComments() {
        const loadMoreBtn = document.getElementById('loadMoreCommentsBtn');
        if (!loadMoreBtn) return;
        
        let currentPage = 1;
        
        loadMoreBtn.addEventListener('click', async function() {
          // 禁用按钮
          this.disabled = true;
          this.textContent = '加载中...';
          
          try {
            // 加载下一页评论
            currentPage++;
            
            // 调用API获取更多评论
            const comments = await window.ApiConfig.article.getComments(articleId, { 
              page: currentPage, 
              limit: 10 
            });
            
            // 如果没有更多评论，隐藏加载更多按钮
            if (!comments.hasMore) {
              this.style.display = 'none';
            }
            
            // 添加评论到列表
            const commentsList = document.getElementById('commentsList');
            if (commentsList && comments.data && comments.data.length > 0) {
              comments.data.forEach(comment => {
                const commentElement = createCommentElement(comment);
                commentsList.appendChild(commentElement);
              });
            }
          } catch (error) {
            console.error('加载更多评论失败:', error);
            showToast('加载更多评论失败，请稍后重试');
          } finally {
            // 恢复按钮状态
            this.disabled = false;
            this.textContent = '加载更多评论';
          }
        });
      }
      
      // 初始化评论功能
      function initComments() {
        // 初始化评论表单
        initCommentForm();
        
        // 初始化加载更多评论按钮
        initLoadMoreComments();
      }
      
      // 登录模态框功能
      function showLoginModal() {
        console.log('显示登录模态框');
        
        // 检查是否已存在模态框
        let authModal = document.getElementById('inline-auth-modal');
        
        // 如果不存在，创建一个
        if (!authModal) {
          // 创建基础模态框结构
          authModal = document.createElement('div');
          authModal.id = 'inline-auth-modal';
          authModal.className = 'modal';
          authModal.style.display = 'flex';
          authModal.style.position = 'fixed';
          authModal.style.top = '0';
          authModal.style.left = '0';
          authModal.style.width = '100%';
          authModal.style.height = '100%';
          authModal.style.backgroundColor = 'rgba(0, 0, 0, 0.7)';
          authModal.style.zIndex = '1000';
          authModal.style.overflow = 'auto';
          authModal.style.backdropFilter = 'blur(5px)';
          authModal.style.justifyContent = 'center';
          authModal.style.alignItems = 'center';
          
          // 创建模态框容器
          const modalContainer = document.createElement('div');
          modalContainer.className = 'modal-container';
          modalContainer.style.width = '90%';
          modalContainer.style.maxWidth = '450px';
          modalContainer.style.background = 'linear-gradient(135deg, rgba(15, 15, 35, 0.95), rgba(30, 30, 60, 0.95))';
          modalContainer.style.borderRadius = '10px';
          modalContainer.style.boxShadow = '0 15px 25px rgba(0, 0, 0, 0.6)';
          modalContainer.style.border = '1px solid rgba(99, 102, 241, 0.3)';
          modalContainer.style.padding = '20px';
          modalContainer.style.margin = '20px';
          modalContainer.style.position = 'relative';
          modalContainer.style.overflow = 'hidden';
          
          // 添加顶部渐变边框效果
          modalContainer.innerHTML = `<div style="
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            height: 3px;
            background: linear-gradient(90deg, #6366f1, #8b5cf6);
            z-index: 1;
          "></div>`;
          
          // 创建模态框头部
          const modalHeader = document.createElement('div');
          modalHeader.className = 'modal-header';
          modalHeader.style.display = 'flex';
          modalHeader.style.justifyContent = 'space-between';
          modalHeader.style.alignItems = 'center';
          modalHeader.style.marginBottom = '20px';
          modalHeader.style.paddingBottom = '10px';
          modalHeader.style.borderBottom = '1px solid rgba(255, 255, 255, 0.1)';
          
          // 创建标题容器
          const loginTitle = document.createElement('h3');
          loginTitle.id = 'inline-login-title';
          loginTitle.textContent = '用户登录';
          loginTitle.style.margin = '0';
          loginTitle.style.fontSize = '1.5rem';
          loginTitle.style.fontWeight = '600';
          loginTitle.style.background = 'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)';
          loginTitle.style.webkitBackgroundClip = 'text';
          loginTitle.style.webkitTextFillColor = 'transparent';
          loginTitle.style.backgroundClip = 'text';
          
          const registerTitle = document.createElement('h3');
          registerTitle.id = 'inline-register-title';
          registerTitle.textContent = '用户注册';
          registerTitle.style.display = 'none';
          registerTitle.style.margin = '0';
          registerTitle.style.fontSize = '1.5rem';
          registerTitle.style.fontWeight = '600';
          registerTitle.style.background = 'linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)';
          registerTitle.style.webkitBackgroundClip = 'text';
          registerTitle.style.webkitTextFillColor = 'transparent';
          registerTitle.style.backgroundClip = 'text';
          
          // 创建关闭按钮
          const closeBtn = document.createElement('button');
          closeBtn.textContent = '×';
          closeBtn.style.background = 'none';
          closeBtn.style.border = 'none';
          closeBtn.style.color = 'rgba(255, 255, 255, 0.6)';
          closeBtn.style.fontSize = '1.5rem';
          closeBtn.style.cursor = 'pointer';
          closeBtn.style.transition = 'color 0.3s';
          closeBtn.addEventListener('mouseenter', () => {
            closeBtn.style.color = 'rgba(239, 68, 68, 1)';
          });
          closeBtn.addEventListener('mouseleave', () => {
            closeBtn.style.color = 'rgba(255, 255, 255, 0.6)';
          });
          closeBtn.addEventListener('click', () => {
            authModal.remove();
            document.body.style.overflow = ''; // 恢复页面滚动
          });
          
          modalHeader.appendChild(loginTitle);
          modalHeader.appendChild(registerTitle);
          modalHeader.appendChild(closeBtn);
          
          // 创建模态框主体
          const modalBody = document.createElement('div');
          modalBody.className = 'modal-body';
          
          // 创建登录表单
          const loginForm = document.createElement('form');
          loginForm.id = 'inline-login-form';
          
          // 邮箱输入组
          const loginEmailGroup = document.createElement('div');
          loginEmailGroup.style.marginBottom = '15px';
          
          const loginEmailLabel = document.createElement('label');
          loginEmailLabel.textContent = '邮箱';
          loginEmailLabel.htmlFor = 'inline-login-email';
          loginEmailLabel.style.display = 'block';
          loginEmailLabel.style.marginBottom = '8px';
          loginEmailLabel.style.fontSize = '0.9rem';
          loginEmailLabel.style.color = 'rgba(255, 255, 255, 0.9)';
          loginEmailLabel.style.opacity = '0.8';
          
          const loginEmailInput = document.createElement('input');
          loginEmailInput.type = 'email';
          loginEmailInput.id = 'inline-login-email';
          loginEmailInput.placeholder = '请输入邮箱';
          loginEmailInput.required = true;
          loginEmailInput.style.width = '100%';
          loginEmailInput.style.padding = '12px 15px';
          loginEmailInput.style.background = 'rgba(255, 255, 255, 0.05)';
          loginEmailInput.style.border = '1px solid rgba(255, 255, 255, 0.1)';
          loginEmailInput.style.borderRadius = '5px';
          loginEmailInput.style.color = 'rgba(255, 255, 255, 0.9)';
          loginEmailInput.style.fontSize = '1rem';
          loginEmailInput.style.transition = 'all 0.3s';
          
          loginEmailGroup.appendChild(loginEmailLabel);
          loginEmailGroup.appendChild(loginEmailInput);
          
          // 密码输入组
          const loginPasswordGroup = document.createElement('div');
          loginPasswordGroup.style.marginBottom = '15px';
          
          const loginPasswordLabel = document.createElement('label');
          loginPasswordLabel.textContent = '密码';
          loginPasswordLabel.htmlFor = 'inline-login-password';
          loginPasswordLabel.style.display = 'block';
          loginPasswordLabel.style.marginBottom = '8px';
          loginPasswordLabel.style.fontSize = '0.9rem';
          loginPasswordLabel.style.color = 'rgba(255, 255, 255, 0.9)';
          loginPasswordLabel.style.opacity = '0.8';
          
          const loginPasswordInput = document.createElement('input');
          loginPasswordInput.type = 'password';
          loginPasswordInput.id = 'inline-login-password';
          loginPasswordInput.placeholder = '请输入密码';
          loginPasswordInput.required = true;
          loginPasswordInput.style.width = '100%';
          loginPasswordInput.style.padding = '12px 15px';
          loginPasswordInput.style.background = 'rgba(255, 255, 255, 0.05)';
          loginPasswordInput.style.border = '1px solid rgba(255, 255, 255, 0.1)';
          loginPasswordInput.style.borderRadius = '5px';
          loginPasswordInput.style.color = 'rgba(255, 255, 255, 0.9)';
          loginPasswordInput.style.fontSize = '1rem';
          loginPasswordInput.style.transition = 'all 0.3s';
          
          loginPasswordGroup.appendChild(loginPasswordLabel);
          loginPasswordGroup.appendChild(loginPasswordInput);
          
          // 操作按钮组
          const loginActionsGroup = document.createElement('div');
          loginActionsGroup.style.display = 'flex';
          loginActionsGroup.style.justifyContent = 'space-between';
          loginActionsGroup.style.alignItems = 'center';
          loginActionsGroup.style.marginTop = '25px';
          
          const loginBtn = document.createElement('button');
          loginBtn.type = 'submit';
          loginBtn.textContent = '登录';
          loginBtn.style.padding = '10px 20px';
          loginBtn.style.border = 'none';
          loginBtn.style.borderRadius = '5px';
          loginBtn.style.background = 'linear-gradient(135deg, #6366f1, #4f46e5)';
          loginBtn.style.color = 'white';
          loginBtn.style.fontWeight = '500';
          loginBtn.style.cursor = 'pointer';
          loginBtn.style.boxShadow = '0 4px 10px rgba(99, 102, 241, 0.3)';
          loginBtn.style.transition = 'all 0.3s';
          loginBtn.addEventListener('mouseenter', () => {
            loginBtn.style.transform = 'translateY(-2px)';
            loginBtn.style.boxShadow = '0 6px 15px rgba(99, 102, 241, 0.4)';
          });
          loginBtn.addEventListener('mouseleave', () => {
            loginBtn.style.transform = 'translateY(0)';
            loginBtn.style.boxShadow = '0 4px 10px rgba(99, 102, 241, 0.3)';
          });
          
          const switchToRegisterBtn = document.createElement('button');
          switchToRegisterBtn.type = 'button';
          switchToRegisterBtn.textContent = '没有账号？注册';
          switchToRegisterBtn.style.background = 'transparent';
          switchToRegisterBtn.style.border = 'none';
          switchToRegisterBtn.style.color = '#6366f1';
          switchToRegisterBtn.style.padding = '10px 0';
          switchToRegisterBtn.style.cursor = 'pointer';
          switchToRegisterBtn.addEventListener('mouseenter', () => {
            switchToRegisterBtn.style.textDecoration = 'underline';
          });
          switchToRegisterBtn.addEventListener('mouseleave', () => {
            switchToRegisterBtn.style.textDecoration = 'none';
          });
          switchToRegisterBtn.addEventListener('click', () => {
            // 切换到注册表单
            loginForm.style.display = 'none';
            registerForm.style.display = 'block';
            loginTitle.style.display = 'none';
            registerTitle.style.display = 'block';
            errorContainer.style.display = 'none';
            errorMessage.textContent = '';
          });
          
          loginActionsGroup.appendChild(loginBtn);
          loginActionsGroup.appendChild(switchToRegisterBtn);
          
          loginForm.appendChild(loginEmailGroup);
          loginForm.appendChild(loginPasswordGroup);
          loginForm.appendChild(loginActionsGroup);
          
          // 创建注册表单
          const registerForm = document.createElement('form');
          registerForm.id = 'inline-register-form';
          registerForm.style.display = 'none';
          
          // 用户名输入组
          const regUsernameGroup = document.createElement('div');
          regUsernameGroup.style.marginBottom = '15px';
          
          const regUsernameLabel = document.createElement('label');
          regUsernameLabel.textContent = '用户名';
          regUsernameLabel.htmlFor = 'inline-reg-username';
          regUsernameLabel.style.display = 'block';
          regUsernameLabel.style.marginBottom = '8px';
          regUsernameLabel.style.fontSize = '0.9rem';
          regUsernameLabel.style.color = 'rgba(255, 255, 255, 0.9)';
          regUsernameLabel.style.opacity = '0.8';
          
          const regUsernameInput = document.createElement('input');
          regUsernameInput.type = 'text';
          regUsernameInput.id = 'inline-reg-username';
          regUsernameInput.placeholder = '请设置用户名';
          regUsernameInput.required = true;
          regUsernameInput.style.width = '100%';
          regUsernameInput.style.padding = '12px 15px';
          regUsernameInput.style.background = 'rgba(255, 255, 255, 0.05)';
          regUsernameInput.style.border = '1px solid rgba(255, 255, 255, 0.1)';
          regUsernameInput.style.borderRadius = '5px';
          regUsernameInput.style.color = 'rgba(255, 255, 255, 0.9)';
          regUsernameInput.style.fontSize = '1rem';
          regUsernameInput.style.transition = 'all 0.3s';
          
          regUsernameGroup.appendChild(regUsernameLabel);
          regUsernameGroup.appendChild(regUsernameInput);
          
          // 邮箱输入组
          const regEmailGroup = document.createElement('div');
          regEmailGroup.style.marginBottom = '15px';
          
          const regEmailLabel = document.createElement('label');
          regEmailLabel.textContent = '邮箱';
          regEmailLabel.htmlFor = 'inline-reg-email';
          regEmailLabel.style.display = 'block';
          regEmailLabel.style.marginBottom = '8px';
          regEmailLabel.style.fontSize = '0.9rem';
          regEmailLabel.style.color = 'rgba(255, 255, 255, 0.9)';
          regEmailLabel.style.opacity = '0.8';
          
          const regEmailInput = document.createElement('input');
          regEmailInput.type = 'email';
          regEmailInput.id = 'inline-reg-email';
          regEmailInput.placeholder = '请输入邮箱';
          regEmailInput.required = true;
          regEmailInput.style.width = '100%';
          regEmailInput.style.padding = '12px 15px';
          regEmailInput.style.background = 'rgba(255, 255, 255, 0.05)';
          regEmailInput.style.border = '1px solid rgba(255, 255, 255, 0.1)';
          regEmailInput.style.borderRadius = '5px';
          regEmailInput.style.color = 'rgba(255, 255, 255, 0.9)';
          regEmailInput.style.fontSize = '1rem';
          regEmailInput.style.transition = 'all 0.3s';
          
          regEmailGroup.appendChild(regEmailLabel);
          regEmailGroup.appendChild(regEmailInput);
          
          // 密码输入组
          const regPasswordGroup = document.createElement('div');
          regPasswordGroup.style.marginBottom = '15px';
          
          const regPasswordLabel = document.createElement('label');
          regPasswordLabel.textContent = '密码';
          regPasswordLabel.htmlFor = 'inline-reg-password';
          regPasswordLabel.style.display = 'block';
          regPasswordLabel.style.marginBottom = '8px';
          regPasswordLabel.style.fontSize = '0.9rem';
          regPasswordLabel.style.color = 'rgba(255, 255, 255, 0.9)';
          regPasswordLabel.style.opacity = '0.8';
          
          const regPasswordInput = document.createElement('input');
          regPasswordInput.type = 'password';
          regPasswordInput.id = 'inline-reg-password';
          regPasswordInput.placeholder = '请设置密码';
          regPasswordInput.required = true;
          regPasswordInput.style.width = '100%';
          regPasswordInput.style.padding = '12px 15px';
          regPasswordInput.style.background = 'rgba(255, 255, 255, 0.05)';
          regPasswordInput.style.border = '1px solid rgba(255, 255, 255, 0.1)';
          regPasswordInput.style.borderRadius = '5px';
          regPasswordInput.style.color = 'rgba(255, 255, 255, 0.9)';
          regPasswordInput.style.fontSize = '1rem';
          regPasswordInput.style.transition = 'all 0.3s';
          
          regPasswordGroup.appendChild(regPasswordLabel);
          regPasswordGroup.appendChild(regPasswordInput);
          
          // 确认密码输入组
          const regConfirmPasswordGroup = document.createElement('div');
          regConfirmPasswordGroup.style.marginBottom = '15px';
          
          const regConfirmPasswordLabel = document.createElement('label');
          regConfirmPasswordLabel.textContent = '确认密码';
          regConfirmPasswordLabel.htmlFor = 'inline-reg-confirm-password';
          regConfirmPasswordLabel.style.display = 'block';
          regConfirmPasswordLabel.style.marginBottom = '8px';
          regConfirmPasswordLabel.style.fontSize = '0.9rem';
          regConfirmPasswordLabel.style.color = 'rgba(255, 255, 255, 0.9)';
          regConfirmPasswordLabel.style.opacity = '0.8';
          
          const regConfirmPasswordInput = document.createElement('input');
          regConfirmPasswordInput.type = 'password';
          regConfirmPasswordInput.id = 'inline-reg-confirm-password';
          regConfirmPasswordInput.placeholder = '请再次输入密码';
          regConfirmPasswordInput.required = true;
          regConfirmPasswordInput.style.width = '100%';
          regConfirmPasswordInput.style.padding = '12px 15px';
          regConfirmPasswordInput.style.background = 'rgba(255, 255, 255, 0.05)';
          regConfirmPasswordInput.style.border = '1px solid rgba(255, 255, 255, 0.1)';
          regConfirmPasswordInput.style.borderRadius = '5px';
          regConfirmPasswordInput.style.color = 'rgba(255, 255, 255, 0.9)';
          regConfirmPasswordInput.style.fontSize = '1rem';
          regConfirmPasswordInput.style.transition = 'all 0.3s';
          
          regConfirmPasswordGroup.appendChild(regConfirmPasswordLabel);
          regConfirmPasswordGroup.appendChild(regConfirmPasswordInput);
          
          // 操作按钮组
          const regActionsGroup = document.createElement('div');
          regActionsGroup.style.display = 'flex';
          regActionsGroup.style.justifyContent = 'space-between';
          regActionsGroup.style.alignItems = 'center';
          regActionsGroup.style.marginTop = '25px';
          
          const registerBtn = document.createElement('button');
          registerBtn.type = 'submit';
          registerBtn.textContent = '注册';
          registerBtn.style.padding = '10px 20px';
          registerBtn.style.border = 'none';
          registerBtn.style.borderRadius = '5px';
          registerBtn.style.background = 'linear-gradient(135deg, #6366f1, #4f46e5)';
          registerBtn.style.color = 'white';
          registerBtn.style.fontWeight = '500';
          registerBtn.style.cursor = 'pointer';
          registerBtn.style.boxShadow = '0 4px 10px rgba(99, 102, 241, 0.3)';
          registerBtn.style.transition = 'all 0.3s';
          registerBtn.addEventListener('mouseenter', () => {
            registerBtn.style.transform = 'translateY(-2px)';
            registerBtn.style.boxShadow = '0 6px 15px rgba(99, 102, 241, 0.4)';
          });
          registerBtn.addEventListener('mouseleave', () => {
            registerBtn.style.transform = 'translateY(0)';
            registerBtn.style.boxShadow = '0 4px 10px rgba(99, 102, 241, 0.3)';
          });
          
          const switchToLoginBtn = document.createElement('button');
          switchToLoginBtn.type = 'button';
          switchToLoginBtn.textContent = '已有账号？登录';
          switchToLoginBtn.style.background = 'transparent';
          switchToLoginBtn.style.border = 'none';
          switchToLoginBtn.style.color = '#6366f1';
          switchToLoginBtn.style.padding = '10px 0';
          switchToLoginBtn.style.cursor = 'pointer';
          switchToLoginBtn.addEventListener('mouseenter', () => {
            switchToLoginBtn.style.textDecoration = 'underline';
          });
          switchToLoginBtn.addEventListener('mouseleave', () => {
            switchToLoginBtn.style.textDecoration = 'none';
          });
          switchToLoginBtn.addEventListener('click', () => {
            // 切换到登录表单
            registerForm.style.display = 'none';
            loginForm.style.display = 'block';
            registerTitle.style.display = 'none';
            loginTitle.style.display = 'block';
            errorContainer.style.display = 'none';
            errorMessage.textContent = '';
          });
          
          regActionsGroup.appendChild(registerBtn);
          regActionsGroup.appendChild(switchToLoginBtn);
          
          registerForm.appendChild(regUsernameGroup);
          registerForm.appendChild(regEmailGroup);
          registerForm.appendChild(regPasswordGroup);
          registerForm.appendChild(regConfirmPasswordGroup);
          registerForm.appendChild(regActionsGroup);
          
          // 创建错误信息容器
          const errorContainer = document.createElement('div');
          errorContainer.style.marginTop = '15px';
          errorContainer.style.padding = '10px';
          errorContainer.style.borderRadius = '5px';
          errorContainer.style.background = 'rgba(239, 68, 68, 0.2)';
          errorContainer.style.border = '1px solid rgba(239, 68, 68, 0.3)';
          errorContainer.style.display = 'none';
          
          const errorMessage = document.createElement('p');
          errorMessage.style.color = 'rgb(252, 165, 165)';
          errorMessage.style.margin = '0';
          errorContainer.appendChild(errorMessage);
          
          // 创建成功信息容器
          const successContainer = document.createElement('div');
          successContainer.style.marginTop = '15px';
          successContainer.style.padding = '10px';
          successContainer.style.borderRadius = '5px';
          successContainer.style.background = 'rgba(16, 185, 129, 0.2)';
          successContainer.style.border = '1px solid rgba(16, 185, 129, 0.3)';
          successContainer.style.display = 'none';
          
          const successMessage = document.createElement('p');
          successMessage.style.color = 'rgb(110, 231, 183)';
          successMessage.style.margin = '0';
          successContainer.appendChild(successMessage);
          
          modalBody.appendChild(loginForm);
          modalBody.appendChild(registerForm);
          modalBody.appendChild(errorContainer);
          modalBody.appendChild(successContainer);
          
          // 创建模态框底部
          const modalFooter = document.createElement('div');
          modalFooter.style.marginTop = '20px';
          modalFooter.style.paddingTop = '15px';
          modalFooter.style.borderTop = '1px solid rgba(255, 255, 255, 0.1)';
          modalFooter.style.textAlign = 'center';
          
          const copyright = document.createElement('p');
          copyright.textContent = '© 江景博客. 保护您的账号信息安全';
          copyright.style.fontSize = '0.8rem';
          copyright.style.color = 'rgba(255, 255, 255, 0.5)';
          modalFooter.appendChild(copyright);
          
          // 组装模态框
          modalContainer.appendChild(modalHeader);
          modalContainer.appendChild(modalBody);
          modalContainer.appendChild(modalFooter);
          authModal.appendChild(modalContainer);
          document.body.appendChild(authModal);
          document.body.style.overflow = 'hidden'; // 防止页面滚动
          
          // 绑定登录表单提交事件
          loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = loginEmailInput.value.trim();
            const password = loginPasswordInput.value.trim();
            
            // 表单验证
            if (!email || !password) {
              errorMessage.textContent = '邮箱和密码不能为空';
              errorContainer.style.display = 'block';
              return;
            }
            
            // 隐藏错误信息
            errorContainer.style.display = 'none';
            
            try {
              // 禁用登录按钮
              loginBtn.disabled = true;
              loginBtn.style.opacity = '0.7';
              loginBtn.textContent = '登录中...';
              
              // 调用登录API
              if (window.ApiConfig && window.ApiConfig.user) {
                const response = await window.ApiConfig.user.login(email, password);
                
                // 显示成功信息
                successMessage.textContent = '登录成功，正在跳转...';
                successContainer.style.display = 'block';
                
                // 延迟关闭模态框
                setTimeout(() => {
                  document.body.removeChild(authModal);
                  document.body.style.overflow = ''; // 恢复页面滚动
                  
                  // 刷新当前页面或返回上一页
                  window.location.reload();
                }, 1000);
              } else {
                throw new Error('ApiConfig未初始化');
              }
            } catch (error) {
              // 启用登录按钮
              loginBtn.disabled = false;
              loginBtn.style.opacity = '1';
              loginBtn.textContent = '登录';
              
              // 显示错误信息
              errorMessage.textContent = error.message || '登录失败，请稍后重试';
              errorContainer.style.display = 'block';
            }
          });
          
          // 绑定注册表单提交事件
          registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const username = regUsernameInput.value.trim();
            const email = regEmailInput.value.trim();
            const password = regPasswordInput.value.trim();
            const confirmPassword = regConfirmPasswordInput.value.trim();
            
            // 表单验证
            if (!username || !email || !password || !confirmPassword) {
              errorMessage.textContent = '所有字段都是必填的';
              errorContainer.style.display = 'block';
              return;
            }
            
            if (password !== confirmPassword) {
              errorMessage.textContent = '两次输入的密码不一致';
              errorContainer.style.display = 'block';
              return;
            }
            
            // 邮箱格式验证
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
              errorMessage.textContent = '请输入有效的邮箱地址';
              errorContainer.style.display = 'block';
              return;
            }
            
            // 隐藏错误信息
            errorContainer.style.display = 'none';
            
            try {
              // 禁用注册按钮
              registerBtn.disabled = true;
              registerBtn.style.opacity = '0.7';
              registerBtn.textContent = '注册中...';
              
              // 调用注册API
              if (window.ApiConfig && window.ApiConfig.user) {
                const response = await window.ApiConfig.user.register({
                  username,
                  email,
                  password
                });
                
                // 显示成功信息
                successMessage.textContent = '注册成功，请登录';
                successContainer.style.display = 'block';
                
                // 延迟切换到登录表单
                setTimeout(() => {
                  registerForm.style.display = 'none';
                  loginForm.style.display = 'block';
                  registerTitle.style.display = 'none';
                  loginTitle.style.display = 'block';
                  successContainer.style.display = 'none';
                  
                  // 预填充邮箱
                  loginEmailInput.value = email;
                }, 1500);
              } else {
                throw new Error('ApiConfig未初始化');
              }
            } catch (error) {
              // 启用注册按钮
              registerBtn.disabled = false;
              registerBtn.style.opacity = '1';
              registerBtn.textContent = '注册';
              
              // 显示错误信息
              errorMessage.textContent = error.message || '注册失败，请稍后重试';
              errorContainer.style.display = 'block';
            }
          });
          
          // 点击模态框外部关闭
          authModal.addEventListener('click', (e) => {
            if (e.target === authModal) {
              document.body.removeChild(authModal);
              document.body.style.overflow = ''; // 恢复页面滚动
            }
          });
          
          // 按ESC键关闭
          document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && document.body.contains(authModal)) {
              document.body.removeChild(authModal);
              document.body.style.overflow = ''; // 恢复页面滚动
            }
          });
        } else {
          // 如果已存在，显示它
          authModal.style.display = 'flex';
          document.body.style.overflow = 'hidden'; // 防止页面滚动
        }
      }
      
      // 获取文章统计信息和评论数
      async function getArticleStats() {
        try {
          // 检查API是否可用
          if (!window.ApiConfig || !window.ApiConfig.article) {
            console.error('API配置不可用');
            return;
          }
          
          // 获取评论数
          getCommentCount();
          
          // 获取文章统计信息
          const stats = await window.ApiConfig.article.getArticleStats(articleId);
          
          // 更新点赞数
          const likeCounter = document.querySelector('#likeBtn .action-counter');
          if (likeCounter && stats && stats.likes) {
            likeCounter.textContent = stats.likes;
          }
        } catch (error) {
          console.error('获取文章统计信息失败:', error);
        }
      }
      
      // 获取评论数
      async function getCommentCount() {
        try {
          // 检查API是否可用
          if (!window.ApiConfig || !window.ApiConfig.article) {
            console.error('API配置不可用');
            return;
          }
          
          // 调用API获取评论（只获取第一页，主要是为了拿到总数）
          const comments = await window.ApiConfig.article.getComments(articleId, { page: 1, limit: 1 });
          
          // 更新评论计数
          const commentCounter = document.querySelector('#commentBtn .action-counter');
          const commentSectionCounter = document.querySelector('.comment-count');
          
          if (comments && typeof comments.total !== 'undefined') {
            // 更新底部操作栏的评论计数
            if (commentCounter) {
              commentCounter.textContent = comments.total;
            }
            
            // 更新评论区的评论计数
            if (commentSectionCounter) {
              commentSectionCounter.textContent = `(${comments.total})`;
            }
          }
        } catch (error) {
          console.error('获取评论数失败:', error);
        }
      }
    </script>
  </body>
</html>