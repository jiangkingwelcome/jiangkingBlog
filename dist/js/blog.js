function detectBrowser(){var e=navigator.userAgent.toLowerCase(),t=-1<e.indexOf("qqbrowser")||-1<e.indexOf("mqqbrowser"),e=-1<e.indexOf("chrome")&&!t;return document.documentElement.classList.add("browser-chrome"),{isQQBrowser:t,isChrome:e}}var _animateCursor,mouseX,mouseY,currentX,currentY,browserInfo=detectBrowser(),cursorGlow=(console.log("Browser detection:",browserInfo),window.addEventListener("load",function(){setTimeout(function(){var e=document.getElementById("loader");e&&(e.style.display="none")},1e3)}),document.getElementById("cursorGlow"));function createStars(){var e=document.getElementById("stars");if(e)for(var t=0;t<100;t++){var o=document.createElement("div");o.className="star",o.style.width=3*Math.random()+"px",o.style.height=o.style.width,o.style.left=100*Math.random()+"%",o.style.top=100*Math.random()+"%",o.style.animationDelay=3*Math.random()+"s",e.appendChild(o)}}function toggleSidebar(){var e=document.getElementById("sidebar"),t=document.getElementById("overlay");e&&t&&(e.classList.toggle("active"),t.classList.toggle("active"))}cursorGlow&&(_animateCursor=function(){currentX+=.1*(mouseX-currentX),currentY+=.1*(mouseY-currentY),cursorGlow.style.left=currentX+"px",cursorGlow.style.top=currentY+"px",requestAnimationFrame(_animateCursor)},currentY=currentX=mouseY=mouseX=0,document.addEventListener("mousemove",function(e){mouseX=e.clientX,mouseY=e.clientY}),_animateCursor()),createStars();var lastScrollTop=0,navItems=(window.addEventListener("scroll",function(){var e=window.pageYOffset||document.documentElement.scrollTop,t=document.getElementById("topNav");t&&(t.style.transform=lastScrollTop<e&&100<e?"translateY(-100%)":"translateY(0)"),lastScrollTop=e<=0?0:e}),document.querySelectorAll(".nav-item")),toolBtns=(navItems.forEach(function(t){t.addEventListener("click",function(e){navItems.forEach(function(e){return e.classList.remove("active")}),t.classList.add("active")})}),document.querySelectorAll(".tool-btn")),postCards=(toolBtns.forEach(function(e){e.addEventListener("click",function(){var e=this;this.style.transform="scale(0.95)",setTimeout(function(){e.style.transform=""},100)})}),document.querySelectorAll(".post-card")),tags=(postCards.forEach(function(n){n.addEventListener("mousemove",function(e){var t=n.getBoundingClientRect(),o=e.clientX-t.left,o=(t.width/2-o)/20;n.style.transform="perspective(1000px) rotateX(".concat((e.clientY-t.top-t.height/2)/20,"deg) rotateY(").concat(o,"deg) scale(1.02) translateZ(10px)")}),n.addEventListener("mouseleave",function(){n.style.transform=""})}),document.querySelectorAll(".tag"));tags.forEach(function(e){e.addEventListener("click",function(e){e.preventDefault();var t=document.createElement("span"),o=(t.style.position="absolute",t.style.width="0px",t.style.height="0px",t.style.background="rgba(255, 255, 255, 0.3)",t.style.borderRadius="50%",t.style.transform="translate(-50%, -50%) scale(0)",t.style.animation="rippleEffect 0.6s ease-out",this.getBoundingClientRect());t.style.left=e.clientX-o.left+"px",t.style.top=e.clientY-o.top+"px",this.appendChild(t),setTimeout(function(){return t.remove()},600)})}),document.querySelectorAll('a[href^="#"]').forEach(function(e){e.addEventListener("click",function(e){var t=this.getAttribute("href");if("#"===t)e.preventDefault();else try{var o=document.querySelector(t);o&&(e.preventDefault(),o.scrollIntoView({behavior:"smooth"}))}catch(e){console.warn("Smooth scroll target not found or invalid selector:",t)}})}),(()=>{var e,o,t=(t=window.performance.timing).loadEventEnd-t.navigationStart;function d(){var e=document.getElementById("sidebar"),t=document.getElementById("overlay");e&&t&&(e.classList.toggle("active"),t.classList.toggle("active"))}function n(){navigator.connection&&navigator.connection.effectiveType.includes("4g")&&[{href:"/assets/font/main-font.woff2",as:"font",type:"font/woff2",crossorigin:"anonymous"},{href:"/assets/images/blog/hero-bg.jpg",as:"image"}].forEach(function(e){var t=document.createElement("link");t.rel="preload",t.href=e.href,t.as=e.as,e.type&&(t.type=e.type),e.crossorigin&&(t.crossOrigin=e.crossorigin),document.head.appendChild(t)})}function m(){var o,n,e,t=document.getElementById("shareDialog");t||((t=document.createElement("div")).id="shareDialog",t.classList.add("share-dialog"),o=window.location.href,n=[{name:"复制链接",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>',action:function(){var t;t=o,navigator.clipboard?navigator.clipboard.writeText(t).then(function(){u("链接已复制到剪贴板")}).catch(function(e){console.error("无法复制:",e),a(t)}):a(t)}},{name:"微信",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M8.5 13.5c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm7 0c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.5 2.5c0-1.93-.55-3.73-1.5-5.25-.34.02-.68.03-1.03.03s-.68-.01-1.02-.03c1.21 1.75 1.87 3.93 1.5 6.25h-13C3.71 14.07 5.31 8.5 10 8.5c-.45-1.21-1.5-2.19-2.86-2.43C7.32 6.02 7.66 6 8 6c4.42 0 8 3.58 8 8 0 .71-.11 1.39-.28 2.05.82-.03 1.55-.44 2.06-1.05.15.32.22.67.22 1z"/><path d="M16.65 14.54a3.566 3.566 0 0 0-.79-3.43c-.79-.79-1.96-1.05-3.04-.68l-4.37-4.37c.74-2.5-.56-5.15-3.07-5.93-.32-.1-.65-.14-.99-.14-.68 0-1.35.21-1.9.6-.86.61-1.41 1.55-1.48 2.58-.07 1.03.37 2.08 1.17 2.77L5.86 9.7c-.35 1.09-.09 2.27.7 3.05.54.54 1.3.86 2.12.86.69 0 1.37-.21 1.95-.61l4.31 4.37c-.26.51-.4 1.1-.36 1.73.04.61.27 1.18.64 1.64.37.45.85.8 1.4.98.55.18 1.13.19 1.69.02.56-.17 1.05-.51 1.43-.96.38-.45.61-1.01.66-1.62.05-.59-.1-1.22-.41-1.75l-3.34-3.87z"/></svg>',action:function(){u("微信分享功能即将上线")}},{name:"微博",icon:'<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M9 8.5h4.95a4.5 4.5 0 1 0 0-9H9v9zm11 3v1.5c0 1.93-.55 3.73-1.5 5.25v.25c0 1.66-1.34 3-3 3h-7a3 3 0 0 1-3-3v-.17c-2.06-1.6-3.5-4.14-3.5-7.08v-1.5a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1v1.5c0 1.93.78 3.68 2 4.88v.12a1 1 0 0 0 1 1h2v-1a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1v1h2a1 1 0 0 0 1-1V22h-7a5 5 0 0 1-5-5v-.12A7.95 7.95 0 0 1 2 11.5v-1.5c0-1.66 1.34-3 3-3h1a3 3 0 0 1 3 3v3a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-3c0-1.66 1.34-3 3-3h1a3 3 0 0 1 3 3v1.5h-1.5L20 11.5z"/></svg>',action:function(){var e=document.title,t=o;t="http://service.weibo.com/share/share.php?url=".concat(encodeURIComponent(t),"&title=").concat(encodeURIComponent(e)),window.open(t,"_blank")}}],e='\n      <div class="share-dialog-content">\n        <h3>分享文章</h3>\n        <div class="share-options">\n          '.concat(n.map(function(e){return'\n            <button class="share-option" data-action="'.concat(n.indexOf(e),'">\n              <div class="share-icon">').concat(e.icon,"</div>\n              <span>").concat(e.name,"</span>\n            </button>\n          ")}).join(""),'\n        </div>\n        <button class="share-close-btn">关闭</button>\n      </div>\n    '),t.innerHTML=e,document.body.appendChild(t),t.querySelector(".share-close-btn").addEventListener("click",function(){t.style.display="none"}),t.querySelectorAll(".share-option").forEach(function(t){t.addEventListener("click",function(){var e=t.dataset.action;n[e].action()})}),t.addEventListener("click",function(e){e.target===t&&(t.style.display="none")})),t.style.display="flex"}function a(e){var t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.opacity="0",document.body.appendChild(t),t.focus(),t.select();try{u(document.execCommand("copy")?"链接已复制到剪贴板":"复制失败，请手动复制")}catch(e){console.error("fallbackCopy 错误:",e),u("复制失败，请手动复制")}document.body.removeChild(t)}function u(e){var t=document.getElementById("toast");t||((t=document.createElement("div")).id="toast",t.className="toast",document.body.appendChild(t)),t.textContent=e,t.classList.add("show"),setTimeout(function(){t.classList.remove("show")},3e3)}console.log("页面加载时间:",t+"ms"),"loading"in HTMLImageElement.prototype?(e=document.querySelectorAll('img[loading="lazy"]'),console.log("使用原生懒加载支持:",e.length,"张图片")):(e=document.querySelectorAll("img[data-src]"),o=new IntersectionObserver(function(e,t){e.forEach(function(e){e.isIntersecting&&((e=e.target).src=e.dataset.src,e.dataset.srcset&&(e.srcset=e.dataset.srcset),e.classList.add("loaded"),o.unobserve(e))})}),e.forEach(function(e){o.observe(e)})),document.addEventListener("DOMContentLoaded",function(){console.log("DOM加载完成，初始化博客功能"),"serviceWorker"in navigator&&fetch("/service-worker.js",{method:"HEAD"}).then(function(e){e.ok?window.addEventListener("load",function(){navigator.serviceWorker.register("/service-worker.js").then(function(e){console.log("ServiceWorker 注册成功，作用域：",e.scope)}).catch(function(e){console.log("ServiceWorker 注册失败：",e)})}):console.log("ServiceWorker 文件不存在，跳过注册")}).catch(function(e){console.log("ServiceWorker 检查失败，跳过注册:",e)});var e=document.querySelector(".menu-btn"),t=(document.getElementById("sidebar"),document.getElementById("overlay")),o=(e&&e.addEventListener("click",d),t&&t.addEventListener("click",d),document.getElementById("cursorGlow"));o&&document.addEventListener("mousemove",function(e){requestAnimationFrame(function(){o.style.left=e.clientX+"px",o.style.top=e.clientY+"px"})}),document.querySelectorAll("img:not([loading])").forEach(function(e){e.hasAttribute("loading")||e.setAttribute("loading","lazy"),e.addEventListener("error",function(){this.classList.add("error")})});t=!(!(e=document.createElement("canvas")).getContext||!e.getContext("2d"))&&0===e.toDataURL("image/webp").indexOf("data:image/webp"),console.log("浏览器支持webp格式:",t),console.log("开始处理图片显示问题"),document.querySelectorAll(".article-content *").forEach(function(e){var t,o,n,a=e.textContent?e.textContent.trim():"";a&&(a.match(/[a-f0-9]{32}\.(webp|jpg|png)$/i)||a.match(/\.(webp|jpg|png|gif|jpeg)$/i))&&1===e.childNodes.length&&e.childNodes[0].nodeType===Node.TEXT_NODE&&(console.log("找到可能是图片URL的文本:",a),(t=document.createElement("div")).className="image-container",o=document.createElement("img"),a.startsWith("/")?o.src=a:a.match(/[a-f0-9]{32}\.(webp|jpg|png)$/i)?(n=window.location.pathname.split("/").pop().replace(".html",""),o.src="/blog/images/".concat(n,"/").concat(a)):o.src="/assets/placeholder-image.svg",o.alt="文章图片",o.setAttribute("data-original-text",a),o.onerror=function(){this.onerror=null,this.src="/assets/placeholder-image.svg",this.classList.add("error")},t.appendChild(o),e.parentNode.replaceChild(t,e))}),e=document.querySelectorAll(".image-container"),console.log("找到图片容器:",e.length),e.forEach(function(e){var t,o,n;!e.querySelector("img")&&e.textContent.trim()&&(t=e.textContent.trim(),console.log("图片容器内只有文本:",t),e.innerHTML="",o=document.createElement("img"),t.match(/[a-f0-9]{32}\.(webp|jpg|png)$/i)?(n=window.location.pathname.split("/").pop().replace(".html",""),o.src="/blog/images/".concat(n,"/").concat(t)):o.src="/assets/placeholder-image.svg",o.alt="文章图片",o.setAttribute("data-text-content",t),o.onerror=function(){this.onerror=null,this.src="/assets/placeholder-image.svg",this.classList.add("error")},e.appendChild(o))}),e=document.querySelectorAll("img");console.log("找到图片元素:",e.length),e.forEach(function(e){e.src.toLowerCase().endsWith(".svg")?(console.log("检测到SVG图片:",e.src),e.classList.add("svg-image")):e.complete&&0===e.naturalHeight?(console.log("图片已加载失败:",e.src),e.classList.add("error"),e.src.includes("placeholder-image")||(e.setAttribute("data-failed-src",e.src),e.src="/assets/placeholder-image.svg",e.classList.add("svg-image"))):e.addEventListener("error",function(){console.log("图片加载失败:",this.src),this.classList.add("error"),this.src.includes("placeholder-image")||(this.setAttribute("data-failed-src",this.src),this.src="/assets/placeholder-image.svg",this.classList.add("svg-image"))})}),console.log("初始化底部操作按钮");var n,a,c,s,r=window.location.pathname.split("/").pop().replace(".html",""),i=(console.log("当前文章ID:",r),JSON.parse(localStorage.getItem("blogInteractions")||"{}")),l=i[r]||{liked:!1,bookmarked:!1,commentCount:0,likeCount:0},t=document.getElementById("likeBtn");t?(console.log("找到点赞按钮"),n=t.querySelector(".action-counter"),a=parseInt(localStorage.getItem("like_count_".concat(r))||"0"),n.textContent=a,l.liked&&t.classList.add("active"),t.addEventListener("click",function(){var e;console.log("点赞按钮被点击"),this.classList.contains("active")?(a=Math.max(0,a-1),this.classList.remove("active"),l.liked=!1,u("已取消点赞")):(a++,this.classList.add("active"),l.liked=!0,u("感谢点赞 ❤️"),(e=document.createElement("span")).innerHTML="❤️",e.style.position="absolute",e.style.top="50%",e.style.left="50%",e.style.fontSize="18px",e.style.transform="translate(-50%, -50%)",e.style.pointerEvents="none",e.style.opacity="1",e.style.transition="all 0.5s",this.appendChild(e),setTimeout(function(){e.style.opacity="0",e.style.transform="translate(-50%, -100px)",setTimeout(function(){return e.remove()},500)},50)),n.textContent=a,localStorage.setItem("like_count_".concat(r),a),i[r]=l,localStorage.setItem("blogInteractions",JSON.stringify(i))})):console.log("未找到点赞按钮"),(t=document.getElementById("bookmarkBtn"))?(console.log("找到收藏按钮"),c=t.querySelector(".action-counter"),s=parseInt(localStorage.getItem("bookmark_count_".concat(r))||"0"),c.textContent=s,l.bookmarked&&t.classList.add("active"),t.addEventListener("click",function(){var e=this,t=(console.log("收藏按钮被点击"),this.classList.contains("active")?(s=Math.max(0,s-1),this.classList.remove("active"),l.bookmarked=!1,u("已取消收藏")):(s++,this.classList.add("active"),l.bookmarked=!0,u("已添加到收藏"),this.classList.add("bookmark-animation"),setTimeout(function(){return e.classList.remove("bookmark-animation")},500)),c.textContent=s,localStorage.setItem("bookmark_count_".concat(r),s),i[r]=l,localStorage.setItem("blogInteractions",JSON.stringify(i)),r),o=document.title,n=l.bookmarked,a=JSON.parse(localStorage.getItem("bookmarks")||"[]");n?a.find(function(e){return e.id===t})||a.push({id:t,title:o,url:window.location.pathname,date:(new Date).toISOString()}):a=a.filter(function(e){return e.id!==t}),localStorage.setItem("bookmarks",JSON.stringify(a))})):console.log("未找到收藏按钮"),(t=document.getElementById("commentBtn"))?(console.log("找到评论按钮"),t.addEventListener("click",function(){console.log("评论按钮被点击");var e=document.querySelector("#comments")||document.querySelector(".comment-section");e?e.scrollIntoView({behavior:"smooth"}):u("评论功能即将上线，敬请期待！")})):console.log("未找到评论按钮"),(t=document.getElementById("shareBtn"))?(console.log("找到分享按钮"),t.addEventListener("click",function(){var e;console.log("分享按钮被点击"),navigator.share?navigator.share({title:document.title,url:window.location.href,text:(null==(e=document.querySelector('meta[name="description"]'))?void 0:e.content)||document.title}).catch(function(e){console.log("分享失败:",e),m()}):m()})):console.log("未找到分享按钮")}),window.toggleSidebar=d,"requestIdleCallback"in window?requestIdleCallback(function(){n()}):setTimeout(n,1e3),window.scrollToTop=function(){window.scrollTo({top:0,behavior:"smooth"})}})();