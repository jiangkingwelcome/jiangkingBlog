doctype html
html(lang="zh-CN")
  head
    meta(charset="utf-8")
    meta(name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1,maximum-scale=2,viewport-fit=cover")
    meta(http-equiv="X-UA-Compatible" content="IE=edge,chrome=1")
    meta(name="renderer" content="webkit")
    
    //- SEOä¼˜åŒ–ï¼šå®Œå–„Metaæ ‡ç­¾
    title #{title} - JiangKingåšå®¢
    meta(name="description" content=`${summary || 'é˜…è¯»JiangKingåšå®¢ä¸Šçš„ã€Š'+title+'ã€‹ï¼Œæ¢ç´¢æ›´å¤šæŠ€æœ¯å†…å®¹'}`)
    meta(name="keywords" content=`${tags ? tags.join(',') : ''}, ${title}, åšå®¢, JiangKing`)
    meta(name="author" content=`${author || 'JiangKing'}`)
    
    //- ç¤¾äº¤åˆ†äº«Metaæ ‡ç­¾
    meta(property="og:title" content=`${title} - JiangKingåšå®¢`)
    meta(property="og:description" content=`${summary || 'é˜…è¯»JiangKingåšå®¢ä¸Šçš„ã€Š'+title+'ã€‹ï¼Œæ¢ç´¢æ›´å¤šæŠ€æœ¯å†…å®¹'}`)
    meta(property="og:type" content="article")
    meta(property="og:url" content=`${config && config.url ? config.url : 'https://jiangking.com'}/blog/${id}.html`)
    meta(property="article:published_time" content=`${date}`)
    meta(property="article:author" content=`${author || 'JiangKing'}`)
    if tags && tags.length
      each tag in tags
        meta(property="article:tag" content=tag)
    
    //- ç§»åŠ¨å‹å¥½ä¼˜åŒ–
    meta(name="theme-color" content="#0f0f23")
    meta(name="apple-mobile-web-app-capable" content="yes")
    meta(name="apple-mobile-web-app-status-bar-style" content="black-translucent")
    
    //- é¢„åŠ è½½å…³é”®èµ„æº
    link(rel="preload" href="/css/blog.css" as="style")
    
    link(rel="stylesheet" href="/css/blog.css")
    link(rel="stylesheet" href="/css/style.css")

  body
    //- åŠ¨æ€èƒŒæ™¯
    .dynamic-bg
    .grid-bg
    #cursorGlow.cursor-glow
    
    //- è¿›åº¦æ¡
    .progress-bar#progressBar
    
    //- é¡¶éƒ¨å¯¼èˆªæ 
    .top-nav#topNav
      .nav-left
        a.back-btn(href="/blog/index.html") 
          i.icon.icon-arrow-left
        h1.site-title JiangKingåšå®¢
      
      .nav-right
        button.nav-btn(title="ç›®å½•" aria-label="æŸ¥çœ‹æ–‡ç« ç›®å½•") ğŸ“‘
        button.nav-btn(title="åˆ†äº«" aria-label="åˆ†äº«æ–‡ç« ") 
          i.icon.icon-share
        button.nav-btn(title="æš—è‰²æ¨¡å¼" aria-label="åˆ‡æ¢æš—è‰²/äº®è‰²æ¨¡å¼") ğŸŒ™
        
        //- ç”¨æˆ·åŒºåŸŸç»„ä»¶
        include ../components/user-area
    
    //- æ–‡ç« å¤´éƒ¨
    header.article-header
      .header-bg
      .header-content
        h1.article-title #{title}
        .article-meta
          .meta-item
            i.icon.icon-calendar
            span #{date || 'æœªçŸ¥æ—¥æœŸ'}
          .meta-item
            i.icon.icon-user
            span #{author || 'JiangKing'}
          if tags && tags.length
            .meta-item
              i.icon.icon-tag
              span #{tags.join(', ')}
        
        if summary
          p.article-summary #{summary}
    
    //- ä¸»è¦å†…å®¹åŒºåŸŸ
    main.article-container
      //- æ–‡ç« å†…å®¹
      article.article-content
        != content
      
      //- æ–‡ç« æ“ä½œç»„ä»¶
      include ../components/article-actions
    
    //- ç›®å½•å¯¼èˆª
    .toc-container#toc
      .toc-header
        h3.toc-title ç›®å½•
        button.close-toc-btn &times;
      .toc-content#tocContent
    
    //- è®¤è¯æ¨¡æ€æ¡†ç»„ä»¶
    include ../components/auth/auth-modal
    
    //- è„šæœ¬å¼•ç”¨
    script(src="/js/blog.js")
    script(src="/js/api-config.js")
    script(src="/js/auth.js")
    script.
      // é¡µé¢åŠ è½½æ—¶è®°å½•æ–‡ç« æµè§ˆ
      document.addEventListener('DOMContentLoaded', () => {
        const articleActions = document.querySelector('.article-actions');
        if (articleActions) {
          const articleId = articleActions.dataset.articleId;
          
          if (articleId) {
            // è®°å½•æ–‡ç« æµè§ˆé‡
            ApiConfig.article.incrementViewCount(articleId)
              .catch(error => {
                console.error('è®°å½•æ–‡ç« æµè§ˆå¤±è´¥:', error);
              });
          }
        }
      }); 