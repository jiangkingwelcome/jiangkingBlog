doctype html
html(lang="zh-CN")
  head
    meta(charset="utf-8")
    meta(name="viewport", content="width=device-width,minimum-scale=1,initial-scale=1,maximum-scale=2,viewport-fit=cover")
    meta(http-equiv="X-UA-Compatible", content="IE=edge,chrome=1")
    meta(name="renderer", content="webkit")
    title JiangKing/Blog
    
    //- æµè§ˆå™¨å…¼å®¹æ€§ä¿®å¤è„šæœ¬ - ç»Ÿä¸€è“ç´«è‰²ä¸»é¢˜
    script.
      (function() {
        // ä¸ºæ‰€æœ‰æµè§ˆå™¨åº”ç”¨ç»Ÿä¸€çš„è“ç´«è‰²ä¸»é¢˜
        document.documentElement.className += ' unified-theme';
        
        // åˆ›å»ºç»Ÿä¸€çš„ä¸»é¢˜æ ·å¼
        var unifiedStyles = '.unified-theme{--primary:#6366f1;--primary-dark:#4f46e5;--secondary:#8b5cf6;--accent:#ec4899;}.unified-theme .dynamic-bg{background:#0f0f23;background:-webkit-linear-gradient(45deg,#0f0f23 0%,#1a1a3e 50%,#0f0f23 100%);background:linear-gradient(45deg,#0f0f23 0%,#1a1a3e 50%,#0f0f23 100%);}.unified-theme .grid-bg{background-image:-webkit-linear-gradient(top,rgba(99,102,241,0.1) 1px,transparent 1px),-webkit-linear-gradient(left,rgba(99,102,241,0.1) 1px,transparent 1px);background-image:linear-gradient(to bottom,rgba(99,102,241,0.1) 1px,transparent 1px),linear-gradient(to right,rgba(99,102,241,0.1) 1px,transparent 1px);}.unified-theme .sidebar{background:rgba(15,15,35,0.95);border-right:1px solid rgba(99,102,241,0.3);}.unified-theme .avatar-ring{background:#6366f1;background:-webkit-linear-gradient(45deg,#6366f1,#8b5cf6,#ec4899,#6366f1);background:linear-gradient(45deg,#6366f1,#8b5cf6,#ec4899,#6366f1);}.unified-theme .social-link{background:rgba(99,102,241,0.15);border:1px solid rgba(99,102,241,0.3);}.unified-theme .social-link:hover{background:rgba(99,102,241,0.3);border-color:#6366f1;box-shadow:0 0 20px rgba(99,102,241,0.5);}.unified-theme .stat-card{background:rgba(99,102,241,0.1);border:1px solid rgba(99,102,241,0.3);}.unified-theme .stat-value{color:#6366f1;}.unified-theme .post-card{background:rgba(99,102,241,0.08);background:-webkit-linear-gradient(135deg,rgba(99,102,241,0.1),rgba(139,92,246,0.1));background:linear-gradient(135deg,rgba(99,102,241,0.1),rgba(139,92,246,0.1));border:1px solid rgba(99,102,241,0.2);}.unified-theme .post-card:hover{box-shadow:0 20px 40px rgba(99,102,241,0.3);border-color:#6366f1;}.unified-theme .tag{background:rgba(99,102,241,0.2);border:1px solid #6366f1;color:#6366f1;}.unified-theme .tag:hover{background:#6366f1;color:#fff;}.unified-theme .tool-btn{background:#6366f1;background:-webkit-linear-gradient(135deg,#6366f1,#8b5cf6);background:linear-gradient(135deg,#6366f1,#8b5cf6);}.unified-theme .loader-ring{border-top-color:#6366f1;}.unified-theme .loader-ring:nth-child(2){border-top-color:#8b5cf6;}.unified-theme .loader-ring:nth-child(3){border-top-color:#ec4899;}';
        
        var styleEl = document.createElement('style');
        styleEl.innerHTML = unifiedStyles;
        document.head.appendChild(styleEl);
        console.log('å·²åº”ç”¨ç»Ÿä¸€è“ç´«è‰²ä¸»é¢˜');
      })();
    
    //- åŸæœ‰çš„CSSæ–‡ä»¶
    link(rel="stylesheet", href="/css/blog.css")
  body
    //- åŠ¨æ€èƒŒæ™¯
    .dynamic-bg
    .grid-bg

    //- é¼ æ ‡è·Ÿéšå…‰æ•ˆ
    #cursorGlow.cursor-glow

    //- åŠ è½½åŠ¨ç”»
    #loader.loader
      .loader-ring
      .loader-ring
      .loader-ring

    //- ä¾§è¾¹æ 
    aside#sidebar.sidebar
      .profile-section
        .avatar-container
          .avatar-ring
          .avatar
            
        h2.nickname JiangKing
        .social-links
          a.social-link(href="#", title="å¾®ä¿¡: jiangking86")
            span(style="position: relative; z-index: 1;") ğŸ’¬
          a.social-link(href="mailto:jiangkingwelcome@vip.qq.com", title="é‚®ç®±: jiangkingwelcome@vip.qq.com")
            span(style="position: relative; z-index: 1;") ğŸ“§
          a.social-link(href="#", title="QQ: 33855846")
            span(style="position: relative; z-index: 1;") ğŸ§
          a.social-link(href="#", title="ç”µè¯")
            span(style="position: relative; z-index: 1;") ğŸ“±
        
        .stats
          .stat-card
            .stat-value
              | #{articles.filter(a => a.status === 'Published' && a.type === 'Post').length}
            .stat-label æ–‡ç« 
      
      nav.nav-menu
        ul
          li.nav-item.active
            a.nav-link(href="/")
              span.nav-icon ğŸ 
              span ä¸»é¡µ
          li.nav-item#tag-btn
            a.nav-link(href="javascript:void(0);")
              span.nav-icon ğŸ·ï¸
              span æ ‡ç­¾
          li.nav-item#category-btn
            a.nav-link(href="javascript:void(0);")
              span.nav-icon ğŸ“
              span åˆ†ç±»
          li.nav-item
            a.nav-link(href="/about.html")
              span.nav-icon âœˆï¸
              span About

    //- ä¸»å†…å®¹åŒº
    main.main-content
      //- Hero åŒºåŸŸ
      section.hero
        .hero-bg
          #stars.stars
        .hero-content
          h1.hero-title JiangKing
          p.hero-subtitle #{config.main.signature}

      //- æ–‡ç« å†…å®¹
      .content-wrapper
        .posts-grid
          if !articles || articles.length === 0
            p.no-article æš‚æ— æ–‡ç« ï¼Œè¯·å…ˆåŒæ­¥ Notion æ•°æ®ã€‚
          else
            each article in articles
              if article.type === 'Post'
                article.post-card(data-category=article.category)
                  h3.post-title
                    a(href=`/blog/${article.id}.html`) #{article.title}
                  .post-meta
                    span.meta-item
                      span.meta-icon ğŸ“…
                      | #{article.date}
                    //- å¯æ‰©å±•æ›´å¤šå…ƒæ•°æ®
                  p.post-excerpt #{article.summary}
                  a.read-more(href=`/blog/${article.id}.html`) é˜…è¯»å…¨æ–‡
                  if article.tags && Array.isArray(article.tags) && article.tags.length
                    .post-tags
                      each tag in article.tags
                        span.tag= tag

      //- é¡µè„š
      footer.footer
        p Â© 2025 JiangKing â¤ï¸ 
          a(href="#") RSS Feed

    //- é®ç½©å±‚
    #overlay.overlay(onclick="toggleSidebar()")

    //- åˆ†ç±»å¼¹çª—æµ®å±‚ï¼Œæ”¾åœ¨bodyæœ«å°¾
    div#category-popup.category-popup
      div.category-title æ–‡ç« åˆ†ç±»
      ul.category-list
        li.category-item.active(data-category="all")
          span å…¨éƒ¨æ–‡ç« 
          span.category-count 32
        li.category-item(data-category="æŠ€æœ¯åˆ†äº«")
          span æŠ€æœ¯åˆ†äº«
          span.category-count 14
        li.category-item(data-category="å¿ƒæƒ…éšç¬”")
          span å¿ƒæƒ…éšç¬”
          span.category-count 3
        li.category-item(data-category="æœ€æ–°ç”µå½±")
          span æœ€æ–°ç”µå½±
          span.category-count 2
        li.category-item(data-category="ç ´è§£ä¸‹è½½")
          span ç ´è§£ä¸‹è½½
          span.category-count 2
          
    //- æ ‡ç­¾å¼¹çª—æµ®å±‚ï¼Œæ”¾åœ¨bodyæœ«å°¾
    div#tag-popup.tag-popup
      div.tag-title æ–‡ç« æ ‡ç­¾
      ul.tag-list
        li.tag-item.active(data-tag="all")
          span å…¨éƒ¨æ ‡ç­¾
          span.tag-count 32
        //- è¿™é‡Œçš„æ ‡ç­¾åˆ—è¡¨å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ

    style.
      .category-popup {
        width: 220px;
        background: var(--glass);
        border-radius: 16px;
        box-shadow: 0 8px 32px rgba(99,102,241,0.18);
        z-index: 9999;
        border: 1px solid var(--glass-border);
        color: #fff;
        display: none;
        padding: 0;
        backdrop-filter: blur(16px);
      }
      .category-popup.show {
        display: block;
      }
      .category-title {
        padding: 16px 20px 8px 20px;
        font-size: 15px;
        font-weight: bold;
        border-bottom: 1px solid var(--glass-border);
        color: #fff;
        letter-spacing: 1px;
      }
      .category-list {
        list-style: none;
        margin: 0;
        padding: 0;
      }
      .category-item {
        padding: 12px 20px;
        font-size: 14px;
        color: #c7d0f7;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        transition: background 0.2s, color 0.2s;
        border-radius: 8px;
      }
      .category-item:hover,
      .category-item.active {
        /* å…¼å®¹æ€§æ¸å˜å†™æ³• */
        background: #8080ff; /* å›é€€çº¯è‰² */
        background: -webkit-linear-gradient(90deg, #8080ff, #a0a0ff, #c0c0ff); /* æ—§ç‰ˆWebKit */
        background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent)); /* æ ‡å‡†è¯­æ³• */
        color: #fff;
        box-shadow: 0 0 8px rgba(128, 128, 255, 0.8);
        box-shadow: 0 0 8px var(--primary);
      }
      .category-count {
        background: rgba(99,102,241,0.12);
        color: #b3bff7;
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 12px;
        margin-left: 8px;
      }
      
      /* æ ‡ç­¾å¼¹çª—æ ·å¼ */
      .tag-popup {
        width: 220px;
        background: var(--glass);
        border-radius: 16px;
        box-shadow: 0 8px 32px rgba(99,102,241,0.18);
        z-index: 9999;
        border: 1px solid var(--glass-border);
        color: #fff;
        display: none;
        padding: 0;
        backdrop-filter: blur(16px);
      }
      .tag-popup.show {
        display: block;
      }
      .tag-title {
        padding: 16px 20px 8px 20px;
        font-size: 15px;
        font-weight: bold;
        border-bottom: 1px solid var(--glass-border);
        color: #fff;
        letter-spacing: 1px;
      }
      .tag-list {
        list-style: none;
        margin: 0;
        padding: 0;
        max-height: 300px;
        overflow-y: auto;
      }
      .tag-list::-webkit-scrollbar {
        width: 6px;
      }
      .tag-list::-webkit-scrollbar-track {
        background: rgba(99,102,241,0.05);
        border-radius: 10px;
      }
      .tag-list::-webkit-scrollbar-thumb {
        background: rgba(99,102,241,0.3);
        border-radius: 10px;
      }
      .tag-item {
        padding: 12px 20px;
        font-size: 14px;
        color: #c7d0f7;
        cursor: pointer;
        display: flex;
        justify-content: space-between;
        transition: background 0.2s, color 0.2s;
        border-radius: 8px;
      }
      .tag-item:hover,
      .tag-item.active {
        /* å…¼å®¹æ€§æ¸å˜å†™æ³• */
        background: #8080ff; /* å›é€€çº¯è‰² */
        background: -webkit-linear-gradient(90deg, #8080ff, #a0a0ff, #c0c0ff); /* æ—§ç‰ˆWebKit */
        background: linear-gradient(90deg, var(--primary), var(--secondary), var(--accent)); /* æ ‡å‡†è¯­æ³• */
        color: #fff;
        box-shadow: 0 0 8px rgba(128, 128, 255, 0.8);
        box-shadow: 0 0 8px var(--primary);
      }
      .tag-count {
        background: rgba(99,102,241,0.12);
        color: #b3bff7;
        padding: 2px 8px;
        border-radius: 10px;
        font-size: 12px;
        margin-left: 8px;
      }

    //- JavaScript æ–‡ä»¶å°†åœ¨è¿™é‡Œå¼•å…¥ï¼Œä¾‹å¦‚ï¼š
    script(src="/js/blog.js")
    script.
      document.addEventListener('DOMContentLoaded', function() {
        // åˆ†ç±»åŠŸèƒ½
        const categoryBtn = document.getElementById('category-btn');
        const categoryPopup = document.getElementById('category-popup');
        const categoryItems = document.querySelectorAll('.category-item');
        const cards = document.querySelectorAll('.post-card');
        
        categoryBtn.addEventListener('click', function(e) {
          e.stopPropagation();
          
          // è·å–åˆ†ç±»æŒ‰é’®çš„ä½ç½®
          const btnRect = categoryBtn.getBoundingClientRect();
          
          // è®¾ç½®å¼¹å‡ºæ¡†çš„ä½ç½®
          categoryPopup.style.position = 'fixed';
          categoryPopup.style.left = (btnRect.right + 10) + 'px';
          categoryPopup.style.top = btnRect.top + 'px';
          
          categoryPopup.classList.toggle('show');
          
          // éšè—æ ‡ç­¾å¼¹çª—
          if (tagPopup.classList.contains('show')) {
            tagPopup.classList.remove('show');
          }
        });
        
        document.addEventListener('click', function(e) {
          if (!categoryPopup.contains(e.target) && !categoryBtn.contains(e.target)) {
            categoryPopup.classList.remove('show');
          }
        });
        
        categoryItems.forEach(item => {
          item.addEventListener('click', function() {
            categoryItems.forEach(i => i.classList.remove('active'));
            this.classList.add('active');
            const selectedCategory = this.getAttribute('data-category');
            cards.forEach(card => {
              const cardCategories = card.getAttribute('data-category');
              if (selectedCategory === 'all' || (cardCategories && cardCategories.includes(selectedCategory))) {
                card.style.display = 'block';
              } else {
                card.style.display = 'none';
              }
            });
            categoryPopup.classList.remove('show');
          });
        });
        
        // æ ‡ç­¾åŠŸèƒ½
        const tagBtn = document.getElementById('tag-btn');
        const tagPopup = document.getElementById('tag-popup');
        const tagList = document.querySelector('.tag-list');
        
        // æ”¶é›†æ‰€æœ‰æ–‡ç« çš„æ ‡ç­¾
        const allTags = new Map();
        cards.forEach(card => {
          const tagElements = card.querySelectorAll('.tag');
          tagElements.forEach(tagElement => {
            const tagText = tagElement.textContent.trim();
            if (allTags.has(tagText)) {
              allTags.set(tagText, allTags.get(tagText) + 1);
            } else {
              allTags.set(tagText, 1);
            }
          });
        });
        
        // åŠ¨æ€ç”Ÿæˆæ ‡ç­¾åˆ—è¡¨
        allTags.forEach((count, tag) => {
          const li = document.createElement('li');
          li.className = 'tag-item';
          li.setAttribute('data-tag', tag);
          
          const spanTag = document.createElement('span');
          spanTag.textContent = tag;
          
          const spanCount = document.createElement('span');
          spanCount.className = 'tag-count';
          spanCount.textContent = count;
          
          li.appendChild(spanTag);
          li.appendChild(spanCount);
          
          li.addEventListener('click', function() {
            document.querySelectorAll('.tag-item').forEach(i => i.classList.remove('active'));
            this.classList.add('active');
            const selectedTag = this.getAttribute('data-tag');
            
            cards.forEach(card => {
              const cardTags = Array.from(card.querySelectorAll('.tag')).map(t => t.textContent.trim());
              if (selectedTag === 'all' || cardTags.includes(selectedTag)) {
                card.style.display = 'block';
              } else {
                card.style.display = 'none';
              }
            });
            
            tagPopup.classList.remove('show');
          });
          
          tagList.appendChild(li);
        });
        
        tagBtn && tagBtn.addEventListener('click', function(e) {
          e.stopPropagation();
          
          // è·å–æ ‡ç­¾æŒ‰é’®çš„ä½ç½®
          const btnRect = tagBtn.getBoundingClientRect();
          
          // è®¾ç½®å¼¹å‡ºæ¡†çš„ä½ç½®
          tagPopup.style.position = 'fixed';
          tagPopup.style.left = (btnRect.right + 10) + 'px';
          tagPopup.style.top = btnRect.top + 'px';
          
          tagPopup.classList.toggle('show');
          
          // éšè—åˆ†ç±»å¼¹çª—
          if (categoryPopup.classList.contains('show')) {
            categoryPopup.classList.remove('show');
          }
        });
        
        document.addEventListener('click', function(e) {
          if (!tagPopup.contains(e.target) && !tagBtn.contains(e.target)) {
            tagPopup.classList.remove('show');
          }
        });
      });